/*
Copyright (C) 2013 Crowd Favorite, Ltd. All rights reserved.

This file is part of Textorum.

Licensed under the MIT license:

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

textorum | 0.1.0 | 2014-08-27
*/
"use strict";!function(a){var b={vertical:{x:!1,y:!0},horizontal:{x:!0,y:!1},both:{x:!0,y:!0},x:{x:!0,y:!1},y:{x:!1,y:!0}},c={duration:"fast",direction:"both"},d=/^(?:html)$/i,e=function(b,c){c=c||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(b,null):b.currentStyle);var d=document.defaultView&&document.defaultView.getComputedStyle?!0:!1,e={top:parseFloat(d?c.borderTopWidth:a.css(b,"borderTopWidth"))||0,left:parseFloat(d?c.borderLeftWidth:a.css(b,"borderLeftWidth"))||0,bottom:parseFloat(d?c.borderBottomWidth:a.css(b,"borderBottomWidth"))||0,right:parseFloat(d?c.borderRightWidth:a.css(b,"borderRightWidth"))||0};return{top:e.top,left:e.left,bottom:e.bottom,right:e.right,vertical:e.top+e.bottom,horizontal:e.left+e.right}},f=function(b){var c=a(window),f=d.test(b[0].nodeName);return{border:f?{top:0,left:0,bottom:0,right:0}:e(b[0]),scroll:{top:(f?c:b).scrollTop(),left:(f?c:b).scrollLeft()},scrollbar:{right:f?0:b.innerWidth()-b[0].clientWidth,bottom:f?0:b.innerHeight()-b[0].clientHeight},rect:function(){var a=b[0].getBoundingClientRect();return{top:f?0:a.top,left:f?0:a.left,bottom:f?b[0].clientHeight:a.bottom,right:f?b[0].clientWidth:a.right}}()}};a.fn.extend({scrollintoview:function(e){e=a.extend({},c,e),e.direction=b["string"==typeof e.direction&&e.direction.toLowerCase()]||b.both;var g="";e.direction.x===!0&&(g="horizontal"),e.direction.y===!0&&(g=g?"both":"vertical");var h=this.eq(0),i=h.closest(":scrollable("+g+")");if(i.length>0){i=i.eq(0);var j={e:f(h),s:f(i)},k={top:j.e.rect.top-(j.s.rect.top+j.s.border.top),bottom:j.s.rect.bottom-j.s.border.bottom-j.s.scrollbar.bottom-j.e.rect.bottom,left:j.e.rect.left-(j.s.rect.left+j.s.border.left),right:j.s.rect.right-j.s.border.right-j.s.scrollbar.right-j.e.rect.right},l={};e.direction.y===!0&&(k.top<0?l.scrollTop=j.s.scroll.top+k.top:k.top>0&&k.bottom<0&&(l.scrollTop=j.s.scroll.top+Math.min(k.top,-k.bottom))),e.direction.x===!0&&(k.left<0?l.scrollLeft=j.s.scroll.left+k.left:k.left>0&&k.right<0&&(l.scrollLeft=j.s.scroll.left+Math.min(k.left,-k.right))),a.isEmptyObject(l)?a.isFunction(e.complete)&&e.complete.call(i[0]):(d.test(i[0].nodeName)&&(i=a("html,body")),i.animate(l,e.duration).eq(0).queue(function(b){a.isFunction(e.complete)&&e.complete.call(i[0]),b()}))}return this}});var g={auto:!0,scroll:!0,visible:!1,hidden:!1};a.extend(a.expr[":"],{scrollable:function(a,c,e){var f=b["string"==typeof e[3]&&e[3].toLowerCase()]||b.both,h=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(a,null):a.currentStyle,i={x:g[h.overflowX.toLowerCase()]||!1,y:g[h.overflowY.toLowerCase()]||!1,isRoot:d.test(a.nodeName)};if(!i.x&&!i.y&&!i.isRoot)return!1;var j={height:{scroll:a.scrollHeight,client:a.clientHeight},width:{scroll:a.scrollWidth,client:a.clientWidth},scrollableX:function(){return(i.x||i.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(i.y||i.isRoot)&&this.height.scroll>this.height.client}};return f.y&&j.scrollableY()||f.x&&j.scrollableX()}})}(jQuery),function(){if(!jQuery||!jQuery.jstree){var a=!1,b=!1,c=!1;!function(d){d.vakata={},d.vakata.css={get_css:function(a,b,c){a=a.toLowerCase();var d=c.cssRules||c.rules,e=0;do{if(d.length&&e>d.length+5)return!1;if(d[e].selectorText&&d[e].selectorText.toLowerCase()==a)return b===!0?(c.removeRule&&c.removeRule(e),c.deleteRule&&c.deleteRule(e),!0):d[e]}while(d[++e]);return!1},add_css:function(a,b){return d.jstree.css.get_css(a,!1,b)?!1:(b.insertRule?b.insertRule(a+" { }",0):b.addRule(a,null,0),d.vakata.css.get_css(a))},remove_css:function(a,b){return d.vakata.css.get_css(a,!0,b)},add_sheet:function(a){var b=!1,c=!0;if(a.str)return a.title&&(b=d("style[id='"+a.title+"-stylesheet']")[0]),b?c=!1:(b=document.createElement("style"),b.setAttribute("type","text/css"),a.title&&b.setAttribute("id",a.title+"-stylesheet")),b.styleSheet?c?(document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet.cssText=a.str):b.styleSheet.cssText=b.styleSheet.cssText+" "+a.str:(b.appendChild(document.createTextNode(a.str)),document.getElementsByTagName("head")[0].appendChild(b)),b.sheet||b.styleSheet;if(a.url){if(!document.createStyleSheet)return b=document.createElement("link"),b.rel="stylesheet",b.type="text/css",b.media="all",b.href=a.url,document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet;try{b=document.createStyleSheet(a.url)}catch(e){}}}};var e=[],f=-1,g={},h={};d.fn.jstree=function(a){var b="string"==typeof a,c=Array.prototype.slice.call(arguments,1),f=this;if(b){if("_"==a.substring(0,1))return f;this.each(function(){var b=e[d.data(this,"jstree_instance_id")],g=b&&d.isFunction(b[a])?b[a].apply(b,c):b;return"undefined"!=typeof g&&(0===a.indexOf("is_")||g!==!0&&g!==!1)?(f=g,!1):void 0})}else this.each(function(){var b=d.data(this,"jstree_instance_id"),f=[],h=a?d.extend({},!0,a):{},i=d(this),j=!1,k=[];f=f.concat(c),i.data("jstree")&&f.push(i.data("jstree")),h=f.length?d.extend.apply(null,[!0,h].concat(f)):h,"undefined"!=typeof b&&e[b]&&e[b].destroy(),b=parseInt(e.push({}),10)-1,d.data(this,"jstree_instance_id",b),h.plugins=d.isArray(h.plugins)?h.plugins:d.jstree.defaults.plugins.slice(),h.plugins.unshift("core"),h.plugins=h.plugins.sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(","),j=d.extend(!0,{},d.jstree.defaults,h),j.plugins=h.plugins,d.each(g,function(a){-1===d.inArray(a,j.plugins)?(j[a]=null,delete j[a]):k.push(a)}),j.plugins=k,e[b]=new d.jstree._instance(b,d(this).addClass("jstree jstree-"+b),j),d.each(e[b]._get_settings().plugins,function(a,c){e[b].data[c]={}}),d.each(e[b]._get_settings().plugins,function(a,c){g[c]&&g[c].__init.apply(e[b])}),setTimeout(function(){e[b]&&e[b].init()},0)});return f},d.jstree={defaults:{plugins:[]},_focused:function(){return e[f]||null},_reference:function(a){if(e[a])return e[a];var b=d(a);return b.length||"string"!=typeof a||(b=d("#"+a)),b.length?e[b.closest(".jstree").data("jstree_instance_id")]||null:null},_instance:function(a,b,c){this.data={core:{}},this.get_settings=function(){return d.extend(!0,{},c)},this._get_settings=function(){return c},this.get_index=function(){return a},this.get_container=function(){return b},this.get_container_ul=function(){return b.children("ul:eq(0)")},this._set_settings=function(a){c=d.extend(!0,{},c,a)}},_fn:{},plugin:function(a,b){b=d.extend({},{__init:d.noop,__destroy:d.noop,_fn:{},defaults:!1},b),g[a]=b,d.jstree.defaults[a]=b.defaults,d.each(b._fn,function(b,c){c.plugin=a,c.old=d.jstree._fn[b],d.jstree._fn[b]=function(){var a,e=c,f=Array.prototype.slice.call(arguments),g=new d.Event("before.jstree"),h=!1;if(this.data.core.locked!==!0||"unlock"===b||"is_locked"===b){do{if(e&&e.plugin&&-1!==d.inArray(e.plugin,this._get_settings().plugins))break;e=e.old}while(e);if(e){if(0===b.indexOf("_"))a=e.apply(this,f);else{if(a=this.get_container().triggerHandler(g,{func:b,inst:this,args:f,plugin:e.plugin}),a===!1)return;"undefined"!=typeof a&&(f=a),a=e.apply(d.extend({},this,{__callback:function(a){this.get_container().triggerHandler(b+".jstree",{inst:this,args:f,rslt:a,rlbk:h})},__rollback:function(){return h=this.get_rollback()},__call_old:function(a){return e.old.apply(this,a?Array.prototype.slice.call(arguments,1):f)}}),f)}return a}}},d.jstree._fn[b].old=c.old,d.jstree._fn[b].plugin=a})},rollback:function(a){a&&(d.isArray(a)||(a=[a]),d.each(a,function(a,b){e[b.i].set_rollback(b.h,b.d)}))}},d.jstree._fn=d.jstree._instance.prototype={},d(function(){var e=navigator.userAgent.toLowerCase(),f=(e.match(/.+?(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],g=".jstree ul, .jstree li { display:block; margin:0 0 0 0; padding:0 0 0 0; list-style-type:none; } .jstree li { display:block; min-height:18px; line-height:18px; white-space:nowrap; margin-left:18px; min-width:18px; } .jstree-rtl li { margin-left:0; margin-right:18px; } .jstree > ul > li { margin-left:0px; } .jstree-rtl > ul > li { margin-right:0px; } .jstree ins { display:inline-block; text-decoration:none; width:18px; height:18px; margin:0 0 0 0; padding:0; } .jstree a { display:inline-block; line-height:16px; height:16px; color:black; white-space:nowrap; text-decoration:none; padding:1px 2px; margin:0; } .jstree a:focus { outline: none; } .jstree a > ins { height:16px; width:16px; } .jstree a > .jstree-icon { margin-right:3px; } .jstree-rtl a > .jstree-icon { margin-left:3px; margin-right:0; } li.jstree-open > ul { display:block; } li.jstree-closed > ul { display:none; } ";if(/msie/.test(e)&&6==parseInt(f,10)){a=!0;try{document.execCommand("BackgroundImageCache",!1,!0)}catch(h){}g+=".jstree li { height:18px; margin-left:0; margin-right:0; } .jstree li li { margin-left:18px; } .jstree-rtl li li { margin-left:0px; margin-right:18px; } li.jstree-open ul { display:block; } li.jstree-closed ul { display:none !important; } .jstree li a { display:inline; border-width:0 !important; padding:0px 2px !important; } .jstree li a ins { height:16px; width:16px; margin-right:3px; } .jstree-rtl li a ins { margin-right:0px; margin-left:3px; } "}/msie/.test(e)&&7==parseInt(f,10)&&(b=!0,g+=".jstree li a { border-width:0 !important; padding:0px 2px !important; } "),!/compatible/.test(e)&&/mozilla/.test(e)&&parseFloat(f,10)<1.9&&(c=!0,g+=".jstree ins { display:-moz-inline-box; } .jstree li { line-height:12px; } .jstree a { display:-moz-inline-box; } .jstree .jstree-no-icons .jstree-checkbox { display:-moz-inline-stack !important; } "),d.vakata.css.add_sheet({str:g,title:"jstree"})}),d.jstree.plugin("core",{__init:function(){this.data.core.locked=!1,this.data.core.to_open=this.get_settings().core.initially_open,this.data.core.to_load=this.get_settings().core.initially_load},defaults:{html_titles:!1,animation:500,initially_open:[],initially_load:[],open_parents:!0,notify_plugins:!0,rtl:!1,load_open:!1,strings:{loading:"Loading ...",new_node:"New node",multiple_selection:"Multiple selection"}},_fn:{init:function(){this.set_focus(),this._get_settings().core.rtl&&this.get_container().addClass("jstree-rtl").css("direction","rtl"),this.get_container().html("<ul><li class='jstree-last jstree-leaf'><ins>&#160;</ins><a class='jstree-loading' href='#'><ins class='jstree-icon'>&#160;</ins>"+this._get_string("loading")+"</a></li></ul>"),this.data.core.li_height=this.get_container_ul().find("li.jstree-closed, li.jstree-leaf").eq(0).height()||18,this.get_container().delegate("li > ins","click.jstree",d.proxy(function(a){var b=d(a.target);this.toggle_node(b)},this)).bind("mousedown.jstree",d.proxy(function(){this.set_focus()},this)).bind("dblclick.jstree",function(){var a;if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){a=window.getSelection();try{a.removeAllRanges(),a.collapse()}catch(b){}}}),this._get_settings().core.notify_plugins&&this.get_container().bind("load_node.jstree",d.proxy(function(a,b){var c=this._get_node(b.rslt.obj),e=this;-1===c&&(c=this.get_container_ul()),c.length&&c.find("li").each(function(){var a=d(this);a.data("jstree")&&d.each(a.data("jstree"),function(b,c){e.data[b]&&d.isFunction(e["_"+b+"_notify"])&&e["_"+b+"_notify"].call(e,a,c)})})},this)),this._get_settings().core.load_open&&this.get_container().bind("load_node.jstree",d.proxy(function(a,b){var c=this._get_node(b.rslt.obj),e=this;-1===c&&(c=this.get_container_ul()),c.length&&c.find("li.jstree-open:not(:has(ul))").each(function(){e.load_node(this,d.noop,d.noop)})},this)),this.__callback(),this.load_node(-1,function(){this.loaded(),this.reload_nodes()})},destroy:function(){var a,b=this.get_index(),c=this._get_settings(),h=this;if(d.each(c.plugins,function(a,b){try{g[b].__destroy.apply(h)}catch(c){}}),this.__callback(),this.is_focused())for(a in e)if(e.hasOwnProperty(a)&&a!=b){e[a].set_focus();break}b===f&&(f=-1),this.get_container().unbind(".jstree").undelegate(".jstree").removeData("jstree_instance_id").find("[class^='jstree']").andSelf().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),d(document).unbind(".jstree-"+b).undelegate(".jstree-"+b),e[b]=null,delete e[b]},_core_notify:function(a,b){b.opened&&this.open_node(a,!1,!0)},lock:function(){this.data.core.locked=!0,this.get_container().children("ul").addClass("jstree-locked").css("opacity","0.7"),this.__callback({})},unlock:function(){this.data.core.locked=!1,this.get_container().children("ul").removeClass("jstree-locked").css("opacity","1"),this.__callback({})},is_locked:function(){return this.data.core.locked},save_opened:function(){var a=this;this.data.core.to_open=[],this.get_container_ul().find("li.jstree-open").each(function(){this.id&&a.data.core.to_open.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"))}),this.__callback(a.data.core.to_open)},save_loaded:function(){},reload_nodes:function(a){var b=this,c=!0,e=[],f=[];a||(this.data.core.reopen=!1,this.data.core.refreshing=!0,this.data.core.to_open=d.map(d.makeArray(this.data.core.to_open),function(a){return"#"+a.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}),this.data.core.to_load=d.map(d.makeArray(this.data.core.to_load),function(a){return"#"+a.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}),this.data.core.to_open.length&&(this.data.core.to_load=this.data.core.to_load.concat(this.data.core.to_open))),this.data.core.to_load.length&&(d.each(this.data.core.to_load,function(a,b){return"#"==b?!0:void(d(b).length?e.push(b):f.push(b))}),e.length&&(this.data.core.to_load=f,d.each(e,function(a,d){b._is_loaded(d)||(b.load_node(d,function(){b.reload_nodes(!0)},function(){b.reload_nodes(!0)}),c=!1)}))),this.data.core.to_open.length&&d.each(this.data.core.to_open,function(a,c){b.open_node(c,!1,!0)}),c&&(this.data.core.reopen&&clearTimeout(this.data.core.reopen),this.data.core.reopen=setTimeout(function(){b.__callback({},b)},50),this.data.core.refreshing=!1,this.reopen())},reopen:function(){var a=this;this.data.core.to_open.length&&d.each(this.data.core.to_open,function(b,c){a.open_node(c,!1,!0)}),this.__callback({})},refresh:function(a){var b=this;this.save_opened(),a||(a=-1),a=this._get_node(a),a||(a=-1),-1!==a?a.children("UL").remove():this.get_container_ul().empty(),this.load_node(a,function(){b.__callback({obj:a}),b.reload_nodes()})},loaded:function(){this.__callback()},set_focus:function(){if(!this.is_focused()){var a=d.jstree._focused();a&&a.unset_focus(),this.get_container().addClass("jstree-focused"),f=this.get_index(),this.__callback()}},is_focused:function(){return f==this.get_index()},unset_focus:function(){this.is_focused()&&(this.get_container().removeClass("jstree-focused"),f=-1),this.__callback()},_get_node:function(a){var b=d(a,this.get_container());return b.is(".jstree")||-1==a?-1:(b=b.closest("li",this.get_container()),b.length?b:!1)},_get_next:function(a,b){return a=this._get_node(a),-1===a?this.get_container().find("> ul > li:first-child"):a.length?b?a.nextAll("li").size()>0?a.nextAll("li:eq(0)"):!1:a.hasClass("jstree-open")?a.find("li:eq(0)"):a.nextAll("li").size()>0?a.nextAll("li:eq(0)"):a.parentsUntil(".jstree","li").next("li").eq(0):!1},_get_prev:function(a,b){if(a=this._get_node(a),-1===a)return this.get_container().find("> ul > li:last-child");if(!a.length)return!1;if(b)return a.prevAll("li").length>0?a.prevAll("li:eq(0)"):!1;if(a.prev("li").length){for(a=a.prev("li").eq(0);a.hasClass("jstree-open");)a=a.children("ul:eq(0)").children("li:last");return a}var c=a.parentsUntil(".jstree","li:eq(0)");return c.length?c:!1},_get_parent:function(a){if(a=this._get_node(a),-1==a||!a.length)return!1;var b=a.parentsUntil(".jstree","li:eq(0)");return b.length?b:-1},_get_children:function(a){return a=this._get_node(a),-1===a?this.get_container().children("ul:eq(0)").children("li"):a.length?a.children("ul:eq(0)").children("li"):!1},get_path:function(a,b){var c=[],d=this;return a=this._get_node(a),-1!==a&&a&&a.length?(a.parentsUntil(".jstree","li").each(function(){c.push(b?this.id:d.get_text(this))}),c.reverse(),c.push(b?a.attr("id"):this.get_text(a)),c):!1},_get_string:function(a){return this._get_settings().core.strings[a]||a},is_open:function(a){return a=this._get_node(a),a&&-1!==a&&a.hasClass("jstree-open")},is_closed:function(a){return a=this._get_node(a),a&&-1!==a&&a.hasClass("jstree-closed")},is_leaf:function(a){return a=this._get_node(a),a&&-1!==a&&a.hasClass("jstree-leaf")},correct_state:function(a){return a=this._get_node(a),a&&-1!==a?(a.removeClass("jstree-closed jstree-open").addClass("jstree-leaf").children("ul").remove(),void this.__callback({obj:a})):!1},open_node:function(b,c,d){if(b=this._get_node(b),!b.length)return!1;if(!b.hasClass("jstree-closed"))return c&&c.call(),!1;var e=d||a?0:this._get_settings().core.animation,f=this;this._is_loaded(b)?(this._get_settings().core.open_parents&&b.parentsUntil(".jstree",".jstree-closed").each(function(){f.open_node(this,!1,!0)}),e&&b.children("ul").css("display","none"),b.removeClass("jstree-closed").addClass("jstree-open").children("a").removeClass("jstree-loading"),e?b.children("ul").stop(!0,!0).slideDown(e,function(){this.style.display="",f.after_open(b)}):f.after_open(b),this.__callback({obj:b}),c&&c.call()):(b.children("a").addClass("jstree-loading"),this.load_node(b,function(){f.open_node(b,c,d)},c))},after_open:function(a){this.__callback({obj:a})},close_node:function(b,c){b=this._get_node(b);var d=c||a?0:this._get_settings().core.animation,e=this;return b.length&&b.hasClass("jstree-open")?(d&&b.children("ul").attr("style","display:block !important"),b.removeClass("jstree-open").addClass("jstree-closed"),d?b.children("ul").stop(!0,!0).slideUp(d,function(){this.style.display="",e.after_close(b)}):e.after_close(b),void this.__callback({obj:b})):!1},after_close:function(a){this.__callback({obj:a})},toggle_node:function(a){return a=this._get_node(a),a.hasClass("jstree-closed")?this.open_node(a):a.hasClass("jstree-open")?this.close_node(a):void 0},open_all:function(a,b,c){a=a?this._get_node(a):-1,a&&-1!==a||(a=this.get_container_ul()),c?a=a.find("li.jstree-closed"):(c=a,a=a.is(".jstree-closed")?a.find("li.jstree-closed").andSelf():a.find("li.jstree-closed"));var d=this;a.each(function(){var a=this;d._is_loaded(this)?d.open_node(this,!1,!b):d.open_node(this,function(){d.open_all(a,b,c)},!b)}),0===c.find("li.jstree-closed").length&&this.__callback({obj:c})},close_all:function(a,b){var c=this;a=a?this._get_node(a):this.get_container(),a&&-1!==a||(a=this.get_container_ul()),a.find("li.jstree-open").andSelf().each(function(){c.close_node(this,!b)}),this.__callback({obj:a})},clean_node:function(a){a=a&&-1!=a?d(a):this.get_container_ul(),a=a.is("li")?a.find("li").andSelf():a.find("li"),a.removeClass("jstree-last").filter("li:last-child").addClass("jstree-last").end().filter(":has(li)").not(".jstree-open").removeClass("jstree-leaf").addClass("jstree-closed"),a.not(".jstree-open, .jstree-closed").addClass("jstree-leaf").children("ul").remove(),this.__callback({obj:a})},get_rollback:function(){return this.__callback(),{i:this.get_index(),h:this.get_container().children("ul").clone(!0),d:this.data}},set_rollback:function(a,b){this.get_container().empty().append(a),this.data=b,this.__callback()},load_node:function(a){this.__callback({obj:a})},_is_loaded:function(){return!0},create_node:function(a,b,c,e,f){a=this._get_node(a),b="undefined"==typeof b?"last":b;var g,h=d("<li />"),i=this._get_settings().core;if(-1!==a&&!a.length)return!1;if(!f&&!this._is_loaded(a))return this.load_node(a,function(){this.create_node(a,b,c,e,!0)}),!1;switch(this.__rollback(),"string"==typeof c&&(c={data:c}),c||(c={}),c.attr&&h.attr(c.attr),c.metadata&&h.data(c.metadata),c.state&&h.addClass("jstree-"+c.state),c.data||(c.data=this._get_string("new_node")),d.isArray(c.data)||(g=c.data,c.data=[],c.data.push(g)),d.each(c.data,function(a,b){g=d("<a />"),d.isFunction(b)&&(b=b.call(this,c)),"string"==typeof b?g.attr("href","#")[i.html_titles?"html":"text"](b):(b.attr||(b.attr={}),b.attr.href||(b.attr.href="#"),g.attr(b.attr)[i.html_titles?"html":"text"](b.title),b.language&&g.addClass(b.language)),g.prepend("<ins class='jstree-icon'>&#160;</ins>"),!b.icon&&c.icon&&(b.icon=c.icon),b.icon&&(-1===b.icon.indexOf("/")?g.children("ins").addClass(b.icon):g.children("ins").css("background","url('"+b.icon+"') center center no-repeat")),h.append(g)}),h.prepend("<ins class='jstree-icon'>&#160;</ins>"),-1===a&&(a=this.get_container(),"before"===b&&(b="first"),"after"===b&&(b="last")),b){case"before":a.before(h),g=this._get_parent(a);break;case"after":a.after(h),g=this._get_parent(a);break;case"inside":case"first":a.children("ul").length||a.append("<ul />"),a.children("ul").prepend(h),g=a;break;case"last":a.children("ul").length||a.append("<ul />"),a.children("ul").append(h),g=a;break;default:a.children("ul").length||a.append("<ul />"),b||(b=0),g=a.children("ul").children("li").eq(b),g.length?g.before(h):a.children("ul").append(h),g=a}return(-1===g||g.get(0)===this.get_container().get(0))&&(g=-1),this.clean_node(g),this.__callback({obj:h,parent:g}),e&&e.call(this,h),h},get_text:function(a){if(a=this._get_node(a),!a.length)return!1;var b=this._get_settings().core.html_titles;return a=a.children("a:eq(0)"),b?(a=a.clone(),a.children("INS").remove(),a.html()):(a=a.contents().filter(function(){return 3==this.nodeType})[0],a.nodeValue)},set_text:function(a,b){if(a=this._get_node(a),!a.length)return!1;if(a=a.children("a:eq(0)"),this._get_settings().core.html_titles){var c=a.children("INS").clone();return a.html(b).prepend(c),this.__callback({obj:a,name:b}),!0}return a=a.contents().filter(function(){return 3==this.nodeType})[0],this.__callback({obj:a,name:b}),a.nodeValue=b},rename_node:function(a,b){a=this._get_node(a),this.__rollback(),a&&a.length&&this.set_text.apply(this,Array.prototype.slice.call(arguments))&&this.__callback({obj:a,name:b})},delete_node:function(a){if(a=this._get_node(a),!a.length)return!1;this.__rollback();var b=this._get_parent(a),c=d([]),e=this;return a.each(function(){c=c.add(e._get_prev(this))}),a=a.detach(),-1!==b&&0===b.find("> ul > li").length&&b.removeClass("jstree-open jstree-closed").addClass("jstree-leaf"),this.clean_node(b),this.__callback({obj:a,prev:c,parent:b}),a},prepare_move:function(a,b,c,e,f){var g={};if(g.ot=d.jstree._reference(a)||this,g.o=g.ot._get_node(a),g.r=-1===b?-1:this._get_node(b),g.p="undefined"==typeof c||c===!1?"last":c,!f&&h.o&&h.o[0]===g.o[0]&&h.r[0]===g.r[0]&&h.p===g.p)return this.__callback(h),void(e&&e.call(this,h));if(g.ot=d.jstree._reference(g.o)||this,g.rt=d.jstree._reference(g.r)||this,-1!==g.r&&g.r){if(!/^(before|after)$/.test(g.p)&&!this._is_loaded(g.r))return this.load_node(g.r,function(){this.prepare_move(a,b,c,e,!0)});switch(g.p){case"before":g.cp=g.r.index(),g.cr=g.rt._get_parent(g.r);break;case"after":g.cp=g.r.index()+1,g.cr=g.rt._get_parent(g.r);break;case"inside":case"first":g.cp=0,g.cr=g.r;break;case"last":g.cp=g.r.find(" > ul > li").length,g.cr=g.r;break;default:g.cp=g.p,g.cr=g.r}}else switch(g.cr=-1,g.p){case"first":case"before":case"inside":g.cp=0;break;case"after":case"last":g.cp=g.rt.get_container().find(" > ul > li").length;break;default:g.cp=g.p}g.np=-1==g.cr?g.rt.get_container():g.cr,g.op=g.ot._get_parent(g.o),g.cop=g.o.index(),-1===g.op&&(g.op=g.ot?g.ot.get_container():this.get_container()),!/^(before|after)$/.test(g.p)&&g.op&&g.np&&g.op[0]===g.np[0]&&g.o.index()<g.cp&&g.cp++,g.or=g.np.find(" > ul > li:nth-child("+(g.cp+1)+")"),h=g,this.__callback(h),e&&e.call(this,h)},check_move:function(){var a=h,b=!0,c=-1===a.r?this.get_container():a.r;if(!a||!a.o||a.or[0]===a.o[0])return!1;if(!a.cy){if(a.op&&a.np&&a.op[0]===a.np[0]&&a.cp-1===a.o.index())return!1;a.o.each(function(){return-1!==c.parentsUntil(".jstree","li").andSelf().index(this)?(b=!1,!1):void 0})}return b},move_node:function(a,b,c,e,f,g){if(!f)return this.prepare_move(a,b,c,function(a){this.move_node(a,!1,!1,e,!0,g)});if(e&&(h.cy=!0),!g&&!this.check_move())return!1;this.__rollback();var i=!1;e?(i=a.o.clone(!0),i.find("*[id]").andSelf().each(function(){this.id&&(this.id="copy_"+this.id)})):i=a.o,a.or.length?a.or.before(i):(a.np.children("ul").length||d("<ul />").appendTo(a.np),a.np.children("ul:eq(0)").append(i));try{a.ot.clean_node(a.op),a.rt.clean_node(a.np),a.op.find("> ul > li").length||a.op.removeClass("jstree-open jstree-closed").addClass("jstree-leaf").children("ul").remove()}catch(j){}return e&&(h.cy=!0,h.oc=i),this.__callback(h),h},_get_move:function(){return h}}})}(jQuery),function(a){var b,c,d;a(function(){/msie/.test(navigator.userAgent.toLowerCase())?(c=a('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1e3,left:0}).appendTo("body"),d=a('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1e3,left:0}).appendTo("body"),b=c.width()-d.width(),c.add(d).remove()):(c=a("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1e3,left:0}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200}),b=100-c.width(),c.parent().remove())}),a.jstree.plugin("ui",{__init:function(){this.data.ui.selected=a(),this.data.ui.last_selected=!1,this.data.ui.hovered=null,this.data.ui.to_select=this.get_settings().ui.initially_select,this.get_container().delegate("a","click.jstree",a.proxy(function(b){b.preventDefault(),b.currentTarget.blur(),a(b.currentTarget).hasClass("jstree-loading")||this.select_node(b.currentTarget,!0,b)},this)).delegate("a","mouseenter.jstree",a.proxy(function(b){a(b.currentTarget).hasClass("jstree-loading")||this.hover_node(b.target)},this)).delegate("a","mouseleave.jstree",a.proxy(function(b){a(b.currentTarget).hasClass("jstree-loading")||this.dehover_node(b.target)},this)).bind("reopen.jstree",a.proxy(function(){this.reselect()},this)).bind("get_rollback.jstree",a.proxy(function(){this.dehover_node(),this.save_selected()},this)).bind("set_rollback.jstree",a.proxy(function(){this.reselect()},this)).bind("close_node.jstree",a.proxy(function(b,c){var d=this._get_settings().ui,e=this._get_node(c.rslt.obj),f=e&&e.length?e.children("ul").find("a.jstree-clicked"):a(),g=this;d.selected_parent_close!==!1&&f.length&&f.each(function(){g.deselect_node(this),"select_parent"===d.selected_parent_close&&g.select_node(e)})},this)).bind("delete_node.jstree",a.proxy(function(a,b){var c=this._get_settings().ui.select_prev_on_delete,d=this._get_node(b.rslt.obj),e=d&&d.length?d.find("a.jstree-clicked"):[],f=this;e.each(function(){f.deselect_node(this)}),c&&e.length&&b.rslt.prev.each(function(){return this.parentNode?(f.select_node(this),!1):void 0})},this)).bind("move_node.jstree",a.proxy(function(a,b){b.rslt.cy&&b.rslt.oc.find("a.jstree-clicked").removeClass("jstree-clicked")},this))},defaults:{select_limit:-1,select_multiple_modifier:"ctrl",select_range_modifier:"shift",selected_parent_close:"select_parent",selected_parent_open:!0,select_prev_on_delete:!0,disable_selecting_children:!1,initially_select:[]},_fn:{_get_node:function(b,c){if("undefined"==typeof b||null===b)return c?this.data.ui.selected:this.data.ui.last_selected;var d=a(b,this.get_container());return d.is(".jstree")||-1==b?-1:(d=d.closest("li",this.get_container()),d.length?d:!1)},_ui_notify:function(a,b){b.selected&&this.select_node(a,!1)},save_selected:function(){var a=this;this.data.ui.to_select=[],this.data.ui.selected.each(function(){this.id&&a.data.ui.to_select.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"))}),this.__callback(this.data.ui.to_select)},reselect:function(){var b=this,c=this.data.ui.to_select;c=a.map(a.makeArray(c),function(a){return"#"+a.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}),a.each(c,function(a,c){c&&"#"!==c&&b.select_node(c)}),this.data.ui.selected=this.data.ui.selected.filter(function(){return this.parentNode}),this.__callback()},refresh:function(){return this.save_selected(),this.__call_old()},hover_node:function(a){return a=this._get_node(a),a.length?(a.hasClass("jstree-hovered")||this.dehover_node(),this.data.ui.hovered=a.children("a").addClass("jstree-hovered").parent(),this._fix_scroll(a),void this.__callback({obj:a})):!1},dehover_node:function(){var a,b=this.data.ui.hovered;return b&&b.length?(a=b.children("a").removeClass("jstree-hovered").parent(),this.data.ui.hovered[0]===a[0]&&(this.data.ui.hovered=null),void this.__callback({obj:b})):!1},select_node:function(a,b,c){if(a=this._get_node(a),-1==a||!a||!a.length)return!1;var d=this._get_settings().ui,e="on"==d.select_multiple_modifier||d.select_multiple_modifier!==!1&&c&&c[d.select_multiple_modifier+"Key"],f=d.select_range_modifier!==!1&&c&&c[d.select_range_modifier+"Key"]&&this.data.ui.last_selected&&this.data.ui.last_selected[0]!==a[0]&&this.data.ui.last_selected.parent()[0]===a.parent()[0],g=this.is_selected(a),h=!0,i=this;if(b){if(d.disable_selecting_children&&e&&(a.parentsUntil(".jstree","li").children("a.jstree-clicked").length||a.children("ul").find("a.jstree-clicked:eq(0)").length))return!1;switch(h=!1,!0){case f:this.data.ui.last_selected.addClass("jstree-last-selected"),a=a[a.index()<this.data.ui.last_selected.index()?"nextUntil":"prevUntil"](".jstree-last-selected").andSelf(),-1==d.select_limit||a.length<d.select_limit?(this.data.ui.last_selected.removeClass("jstree-last-selected"),this.data.ui.selected.each(function(){this!==i.data.ui.last_selected[0]&&i.deselect_node(this)}),g=!1,h=!0):h=!1;break;case g&&!e:this.deselect_all(),g=!1,h=!0;break;case!g&&!e:(-1==d.select_limit||d.select_limit>0)&&(this.deselect_all(),h=!0);break;case g&&e:this.deselect_node(a);break;case!g&&e:(-1==d.select_limit||this.data.ui.selected.length+1<=d.select_limit)&&(h=!0)}}h&&!g&&(f||(this.data.ui.last_selected=a),a.children("a").addClass("jstree-clicked"),d.selected_parent_open&&a.parents(".jstree-closed").each(function(){i.open_node(this,!1,!0)}),this.data.ui.selected=this.data.ui.selected.add(a),this._fix_scroll(a.eq(0)),this.__callback({obj:a,e:c}))},_fix_scroll:function(a){var c,d=this.get_container()[0];if(d.scrollHeight>d.offsetHeight){if(a=this._get_node(a),!a||-1===a||!a.length||!a.is(":visible"))return;c=a.offset().top-this.get_container().offset().top,0>c&&(d.scrollTop=d.scrollTop+c-1),c+this.data.core.li_height+(d.scrollWidth>d.offsetWidth?b:0)>d.offsetHeight&&(d.scrollTop=d.scrollTop+(c-d.offsetHeight+this.data.core.li_height+1+(d.scrollWidth>d.offsetWidth?b:0)))}},deselect_node:function(a){return a=this._get_node(a),a.length?void(this.is_selected(a)&&(a.children("a").removeClass("jstree-clicked"),this.data.ui.selected=this.data.ui.selected.not(a),this.data.ui.last_selected.get(0)===a.get(0)&&(this.data.ui.last_selected=this.data.ui.selected.eq(0)),this.__callback({obj:a}))):!1},toggle_select:function(a){return a=this._get_node(a),a.length?void(this.is_selected(a)?this.deselect_node(a):this.select_node(a)):!1},is_selected:function(a){return this.data.ui.selected.index(this._get_node(a))>=0},get_selected:function(b){return b?a(b).find("a.jstree-clicked").parent():this.data.ui.selected},deselect_all:function(b){var c=b?a(b).find("a.jstree-clicked").parent():this.get_container().find("a.jstree-clicked").parent();c.children("a.jstree-clicked").removeClass("jstree-clicked"),this.data.ui.selected=a([]),this.data.ui.last_selected=!1,this.__callback({obj:c})}}}),a.jstree.defaults.plugins.push("ui")}(jQuery),function(a){a.jstree.plugin("crrm",{__init:function(){this.get_container().bind("move_node.jstree",a.proxy(function(a,b){if(this._get_settings().crrm.move.open_onmove){var c=this;b.rslt.np.parentsUntil(".jstree").andSelf().filter(".jstree-closed").each(function(){c.open_node(this,!1,!0)})}},this))},defaults:{input_width_limit:200,move:{always_copy:!1,open_onmove:!0,default_position:"last",check_move:function(){return!0
}}},_fn:{_show_input:function(b,c){b=this._get_node(b);var d=this._get_settings().core.rtl,e=this._get_settings().crrm.input_width_limit,f=b.children("ins").width(),g=b.find("> a:visible > ins").width()*b.find("> a:visible > ins").length,h=this.get_text(b),i=a("<div />",{css:{position:"absolute",top:"-200px",left:d?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),j=b.css("position","relative").append(a("<input />",{value:h,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver",position:"absolute",left:d?"auto":f+g+4+"px",right:d?f+g+4+"px":"auto",top:"0px",height:this.data.core.li_height-2+"px",lineHeight:this.data.core.li_height-2+"px",width:"150px"},blur:a.proxy(function(){var a=b.children(".jstree-rename-input"),d=a.val();""===d&&(d=h),i.remove(),a.remove(),this.set_text(b,h),this.rename_node(b,d),c.call(this,b,d,h),b.css("position","")},this),keyup:function(a){var b=a.keyCode||a.which;return 27==b?(this.value=h,void this.blur()):13==b?void this.blur():void j.width(Math.min(i.text("pW"+this.value).width(),e))},keypress:function(a){var b=a.keyCode||a.which;return 13==b?!1:void 0}})).children(".jstree-rename-input");this.set_text(b,""),i.css({fontFamily:j.css("fontFamily")||"",fontSize:j.css("fontSize")||"",fontWeight:j.css("fontWeight")||"",fontStyle:j.css("fontStyle")||"",fontStretch:j.css("fontStretch")||"",fontVariant:j.css("fontVariant")||"",letterSpacing:j.css("letterSpacing")||"",wordSpacing:j.css("wordSpacing")||""}),j.width(Math.min(i.text("pW"+j[0].value).width(),e))[0].select()},rename:function(a){a=this._get_node(a),this.__rollback();var b=this.__callback;this._show_input(a,function(a,c,d){b.call(this,{obj:a,new_name:c,old_name:d})})},create:function(b,c,d,e,f){var g,h=this;return b=this._get_node(b),b||(b=-1),this.__rollback(),g=this.create_node(b,c,d,function(b){var c=this._get_parent(b),d=a(b).index();e&&e.call(this,b),c.length&&c.hasClass("jstree-closed")&&this.open_node(c,!1,!0),f?h.__callback({obj:b,name:this.get_text(b),parent:c,position:d}):this._show_input(b,function(a,b){h.__callback({obj:a,name:b,parent:c,position:d})})})},remove:function(a){a=this._get_node(a,!0);var b=this._get_parent(a),c=this._get_prev(a);this.__rollback(),a=this.delete_node(a),a!==!1&&this.__callback({obj:a,prev:c,parent:b})},check_move:function(){if(!this.__call_old())return!1;var a=this._get_settings().crrm.move;return a.check_move.call(this,this._get_move())?!0:!1},move_node:function(a,b,c,d,e,f){var g=this._get_settings().crrm.move;return e?((g.always_copy===!0||"multitree"===g.always_copy&&a.rt.get_index()!==a.ot.get_index())&&(d=!0),void this.__call_old(!0,a,b,c,d,!0,f)):("undefined"==typeof c&&(c=g.default_position),"inside"!==c||g.default_position.match(/^(before|after)$/)||(c=g.default_position),this.__call_old(!0,a,b,c,d,!1,f))},cut:function(a){return a=this._get_node(a,!0),a&&a.length?(this.data.crrm.cp_nodes=!1,this.data.crrm.ct_nodes=a,void this.__callback({obj:a})):!1},copy:function(a){return a=this._get_node(a,!0),a&&a.length?(this.data.crrm.ct_nodes=!1,this.data.crrm.cp_nodes=a,void this.__callback({obj:a})):!1},paste:function(a){if(a=this._get_node(a),!a||!a.length)return!1;var b=this.data.crrm.ct_nodes?this.data.crrm.ct_nodes:this.data.crrm.cp_nodes;return this.data.crrm.ct_nodes||this.data.crrm.cp_nodes?(this.data.crrm.ct_nodes&&(this.move_node(this.data.crrm.ct_nodes,a),this.data.crrm.ct_nodes=!1),this.data.crrm.cp_nodes&&this.move_node(this.data.crrm.cp_nodes,a,!1,!0),void this.__callback({obj:a,nodes:b})):!1}}})}(jQuery),function(a){var b=["[dummy]"];a.jstree._themes=!1,a.jstree.plugin("themes",{__init:function(){this.get_container().bind("init.jstree",a.proxy(function(){var a=this._get_settings().themes;this.data.themes.dots=a.dots,this.data.themes.icons=a.icons,this.set_theme(a.theme,a.url)},this)).bind("loaded.jstree",a.proxy(function(){this.data.themes.dots?this.show_dots():this.hide_dots(),this.data.themes.icons?this.show_icons():this.hide_icons()},this))},defaults:{theme:"default",url:!1,dots:!0,icons:!0},_fn:{set_theme:function(c,d){return c?(d||(d=a.jstree._themes+c+"/style.css"),-1==a.inArray(d,b)&&(a.vakata.css.add_sheet({url:d}),b.push(d)),this.data.themes.theme!=c&&(this.get_container().removeClass("jstree-"+this.data.themes.theme),this.data.themes.theme=c),this.get_container().addClass("jstree-"+c),this.data.themes.dots?this.show_dots():this.hide_dots(),this.data.themes.icons?this.show_icons():this.hide_icons(),void this.__callback()):!1},get_theme:function(){return this.data.themes.theme},show_dots:function(){this.data.themes.dots=!0,this.get_container().children("ul").removeClass("jstree-no-dots")},hide_dots:function(){this.data.themes.dots=!1,this.get_container().children("ul").addClass("jstree-no-dots")},toggle_dots:function(){this.data.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this.data.themes.icons=!0,this.get_container().children("ul").removeClass("jstree-no-icons")},hide_icons:function(){this.data.themes.icons=!1,this.get_container().children("ul").addClass("jstree-no-icons")},toggle_icons:function(){this.data.themes.icons?this.hide_icons():this.show_icons()}}}),a(function(){a.jstree._themes===!1&&a("script").each(function(){return this.src.toString().match(/jquery\.jstree[^\/]*?\.js(\?.*)?$/)?(a.jstree._themes=this.src.toString().replace(/jquery\.jstree[^\/]*?\.js(\?.*)?$/,"")+"themes/",!1):void 0}),a.jstree._themes===!1&&(a.jstree._themes="themes/")}),a.jstree.defaults.plugins.push("themes")}(jQuery),function(a){function b(b,c){var d,e=a.jstree._focused();return e&&e.data&&e.data.hotkeys&&e.data.hotkeys.enabled&&(d=e._get_settings().hotkeys[b])?d.call(e,c):void 0}var c=[];a.jstree.plugin("hotkeys",{__init:function(){if("undefined"==typeof a.hotkeys)throw"jsTree hotkeys: jQuery hotkeys plugin not included.";if(!this.data.ui)throw"jsTree hotkeys: jsTree UI plugin not included.";a.each(this._get_settings().hotkeys,function(d,e){e!==!1&&-1==a.inArray(d,c)&&(a(document).bind("keydown",d,function(a){return b(d,a)}),c.push(d))}),this.get_container().bind("lock.jstree",a.proxy(function(){this.data.hotkeys.enabled&&(this.data.hotkeys.enabled=!1,this.data.hotkeys.revert=!0)},this)).bind("unlock.jstree",a.proxy(function(){this.data.hotkeys.revert&&(this.data.hotkeys.enabled=!0)},this)),this.enable_hotkeys()},defaults:{up:function(){var a=this.data.ui.hovered||this.data.ui.last_selected||-1;return this.hover_node(this._get_prev(a)),!1},"ctrl+up":function(){var a=this.data.ui.hovered||this.data.ui.last_selected||-1;return this.hover_node(this._get_prev(a)),!1},"shift+up":function(){var a=this.data.ui.hovered||this.data.ui.last_selected||-1;return this.hover_node(this._get_prev(a)),!1},down:function(){var a=this.data.ui.hovered||this.data.ui.last_selected||-1;return this.hover_node(this._get_next(a)),!1},"ctrl+down":function(){var a=this.data.ui.hovered||this.data.ui.last_selected||-1;return this.hover_node(this._get_next(a)),!1},"shift+down":function(){var a=this.data.ui.hovered||this.data.ui.last_selected||-1;return this.hover_node(this._get_next(a)),!1},left:function(){var a=this.data.ui.hovered||this.data.ui.last_selected;return a&&(a.hasClass("jstree-open")?this.close_node(a):this.hover_node(this._get_prev(a))),!1},"ctrl+left":function(){var a=this.data.ui.hovered||this.data.ui.last_selected;return a&&(a.hasClass("jstree-open")?this.close_node(a):this.hover_node(this._get_prev(a))),!1},"shift+left":function(){var a=this.data.ui.hovered||this.data.ui.last_selected;return a&&(a.hasClass("jstree-open")?this.close_node(a):this.hover_node(this._get_prev(a))),!1},right:function(){var a=this.data.ui.hovered||this.data.ui.last_selected;return a&&a.length&&(a.hasClass("jstree-closed")?this.open_node(a):this.hover_node(this._get_next(a))),!1},"ctrl+right":function(){var a=this.data.ui.hovered||this.data.ui.last_selected;return a&&a.length&&(a.hasClass("jstree-closed")?this.open_node(a):this.hover_node(this._get_next(a))),!1},"shift+right":function(){var a=this.data.ui.hovered||this.data.ui.last_selected;return a&&a.length&&(a.hasClass("jstree-closed")?this.open_node(a):this.hover_node(this._get_next(a))),!1},space:function(){return this.data.ui.hovered&&this.data.ui.hovered.children("a:eq(0)").click(),!1},"ctrl+space":function(a){return a.type="click",this.data.ui.hovered&&this.data.ui.hovered.children("a:eq(0)").trigger(a),!1},"shift+space":function(a){return a.type="click",this.data.ui.hovered&&this.data.ui.hovered.children("a:eq(0)").trigger(a),!1},f2:function(){this.rename(this.data.ui.hovered||this.data.ui.last_selected)},del:function(){this.remove(this.data.ui.hovered||this._get_node(null))}},_fn:{enable_hotkeys:function(){this.data.hotkeys.enabled=!0},disable_hotkeys:function(){this.data.hotkeys.enabled=!1}}})}(jQuery),function(a){a.jstree.plugin("json_data",{__init:function(){var a=this._get_settings().json_data;a.progressive_unload&&this.get_container().bind("after_close.jstree",function(a,b){b.rslt.obj.children("ul").remove()})},defaults:{data:!1,ajax:!1,correct_state:!0,progressive_render:!1,progressive_unload:!1},_fn:{load_node:function(a,b,c){var d=this;this.load_node_json(a,function(){d.__callback({obj:d._get_node(a)}),b.call(this)},c)},_is_loaded:function(b){var c=this._get_settings().json_data;return b=this._get_node(b),-1==b||!b||!c.ajax&&!c.progressive_render&&!a.isFunction(c.data)||b.is(".jstree-open, .jstree-leaf")||b.children("ul").children("li").length>0},refresh:function(b){b=this._get_node(b);var c=this._get_settings().json_data;return b&&-1!==b&&c.progressive_unload&&(a.isFunction(c.data)||c.ajax)&&b.removeData("jstree_children"),this.__call_old()},load_node_json:function(b,c,d){var e,f=this.get_settings().json_data,g=function(){},h=function(){};if(b=this._get_node(b),b&&-1!==b&&(f.progressive_render||f.progressive_unload)&&!b.is(".jstree-open, .jstree-leaf")&&0===b.children("ul").children("li").length&&b.data("jstree_children"))return e=this._parse_json(b.data("jstree_children"),b),e&&(b.append(e),f.progressive_unload||b.removeData("jstree_children")),this.clean_node(b),void(c&&c.call(this));if(b&&-1!==b){if(b.data("jstree_is_loading"))return;b.data("jstree_is_loading",!0)}switch(!0){case!f.data&&!f.ajax:throw"Neither data nor ajax settings supplied.";case a.isFunction(f.data):f.data.call(this,b,a.proxy(function(a){a=this._parse_json(a,b),a?(-1!==b&&b?(b.append(a).children("a.jstree-loading").removeClass("jstree-loading"),b.removeData("jstree_is_loading")):this.get_container().children("ul").empty().append(a.children()),this.clean_node(b),c&&c.call(this)):(-1!==b&&b?(b.children("a.jstree-loading").removeClass("jstree-loading"),b.removeData("jstree_is_loading"),f.correct_state&&this.correct_state(b)):f.correct_state&&this.get_container().children("ul").empty(),d&&d.call(this))},this));break;case!!f.data&&!f.ajax||!!f.data&&!!f.ajax&&(!b||-1===b):b&&-1!=b||(e=this._parse_json(f.data,b),e?(this.get_container().children("ul").empty().append(e.children()),this.clean_node()):f.correct_state&&this.get_container().children("ul").empty()),c&&c.call(this);break;case!f.data&&!!f.ajax||!!f.data&&!!f.ajax&&b&&-1!==b:g=function(a,c,e){var g=this.get_settings().json_data.ajax.error;g&&g.call(this,a,c,e),-1!=b&&b.length?(b.children("a.jstree-loading").removeClass("jstree-loading"),b.removeData("jstree_is_loading"),"success"===c&&f.correct_state&&this.correct_state(b)):"success"===c&&f.correct_state&&this.get_container().children("ul").empty(),d&&d.call(this)},h=function(d,e,h){var i=this.get_settings().json_data.ajax.success;return i&&(d=i.call(this,d,e,h)||d),""===d||d&&d.toString&&""===d.toString().replace(/^[\s\n]+$/,"")||!a.isArray(d)&&!a.isPlainObject(d)?g.call(this,h,e,""):(d=this._parse_json(d,b),void(d?(-1!==b&&b?(b.append(d).children("a.jstree-loading").removeClass("jstree-loading"),b.removeData("jstree_is_loading")):this.get_container().children("ul").empty().append(d.children()),this.clean_node(b),c&&c.call(this)):-1!==b&&b?(b.children("a.jstree-loading").removeClass("jstree-loading"),b.removeData("jstree_is_loading"),f.correct_state&&(this.correct_state(b),c&&c.call(this))):f.correct_state&&(this.get_container().children("ul").empty(),c&&c.call(this))))},f.ajax.context=this,f.ajax.error=g,f.ajax.success=h,f.ajax.dataType||(f.ajax.dataType="json"),a.isFunction(f.ajax.url)&&(f.ajax.url=f.ajax.url.call(this,b)),a.isFunction(f.ajax.data)&&(f.ajax.data=f.ajax.data.call(this,b)),a.ajax(f.ajax)}},_parse_json:function(b,c,d){var e,f,g,h,i,j=!1,k=this._get_settings(),l=k.json_data,m=k.core.html_titles;if(!b)return j;if(l.progressive_unload&&c&&-1!==c&&c.data("jstree_children",j),a.isArray(b)){if(j=a(),!b.length)return!1;for(f=0,g=b.length;g>f;f++)e=this._parse_json(b[f],c,!0),e.length&&(j=j.add(e))}else{if("string"==typeof b&&(b={data:b}),!b.data&&""!==b.data)return j;j=a("<li />"),b.attr&&j.attr(b.attr),b.metadata&&j.data(b.metadata),b.state&&j.addClass("jstree-"+b.state),a.isArray(b.data)||(e=b.data,b.data=[],b.data.push(e)),a.each(b.data,function(c,d){e=a("<a />"),a.isFunction(d)&&(d=d.call(this,b)),"string"==typeof d?e.attr("href","#")[m?"html":"text"](d):(d.attr||(d.attr={}),d.attr.href||(d.attr.href="#"),e.attr(d.attr)[m?"html":"text"](d.title),d.language&&e.addClass(d.language)),e.prepend("<ins class='jstree-icon'>&#160;</ins>"),!d.icon&&b.icon&&(d.icon=b.icon),d.icon&&(-1===d.icon.indexOf("/")?e.children("ins").addClass(d.icon):e.children("ins").css("background","url('"+d.icon+"') center center no-repeat")),j.append(e)}),j.prepend("<ins class='jstree-icon'>&#160;</ins>"),b.children&&(l.progressive_render&&"open"!==b.state?j.addClass("jstree-closed").data("jstree_children",b.children):(l.progressive_unload&&j.data("jstree_children",b.children),a.isArray(b.children)&&b.children.length&&(e=this._parse_json(b.children,c,!0),e.length&&(i=a("<ul />"),i.append(e),j.append(i)))))}return d||(h=a("<ul />"),h.append(j),j=h),j},get_json:function(b,c,d,e){var f,g,h,i,j,k,l=[],m=this._get_settings(),n=this;return b=this._get_node(b),b&&-1!==b||(b=this.get_container().find("> ul > li")),c=a.isArray(c)?c:["id","class"],!e&&this.data.types&&c.push(m.types.type_attr),d=a.isArray(d)?d:[],b.each(function(){h=a(this),f={data:[]},c.length&&(f.attr={}),a.each(c,function(a,b){g=h.attr(b),g&&g.length&&g.replace(/jstree[^ ]*/gi,"").length&&(f.attr[b]=(" "+g).replace(/ jstree[^ ]*/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,""))}),h.hasClass("jstree-open")&&(f.state="open"),h.hasClass("jstree-closed")&&(f.state="closed"),h.data()&&(f.metadata=h.data()),i=h.children("a"),i.each(function(){j=a(this),d.length||-1!==a.inArray("languages",m.plugins)||j.children("ins").get(0).style.backgroundImage.length||j.children("ins").get(0).className&&j.children("ins").get(0).className.replace(/jstree[^ ]*|$/gi,"").length?(k=!1,-1!==a.inArray("languages",m.plugins)&&a.isArray(m.languages)&&m.languages.length&&a.each(m.languages,function(a,b){return j.hasClass(b)?(k=b,!1):void 0}),g={attr:{},title:n.get_text(j,k)},a.each(d,function(a,b){g.attr[b]=(" "+(j.attr(b)||"")).replace(/ jstree[^ ]*/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,"")}),-1!==a.inArray("languages",m.plugins)&&a.isArray(m.languages)&&m.languages.length&&a.each(m.languages,function(a,b){return j.hasClass(b)?(g.language=b,!0):void 0}),j.children("ins").get(0).className.replace(/jstree[^ ]*|$/gi,"").replace(/^\s+$/gi,"").length&&(g.icon=j.children("ins").get(0).className.replace(/jstree[^ ]*|$/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,"")),j.children("ins").get(0).style.backgroundImage.length&&(g.icon=j.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")",""))):g=n.get_text(j),i.length>1?f.data.push(g):f.data=g}),h=h.find("> ul > li"),h.length&&(f.children=n.get_json(h,c,d,!0)),l.push(f)}),l}}})}(jQuery),function(a){var b=!1;a.jstree.plugin("languages",{__init:function(){this._load_css()},defaults:[],_fn:{set_lang:function(c){var d=this._get_settings().languages,e=!1,f=".jstree-"+this.get_index()+" a";if(!a.isArray(d)||0===d.length)return!1;if(-1==a.inArray(c,d)){if(!d[c])return!1;c=d[c]}return c==this.data.languages.current_language?!0:(e=a.vakata.css.get_css(f+"."+this.data.languages.current_language,!1,b),e!==!1&&(e.style.display="none"),e=a.vakata.css.get_css(f+"."+c,!1,b),e!==!1&&(e.style.display=""),this.data.languages.current_language=c,this.__callback(c),!0)},get_lang:function(){return this.data.languages.current_language},_get_string:function(b,c){var d=this._get_settings().languages,e=this._get_settings().core.strings;return a.isArray(d)&&d.length&&(c=c&&-1!=a.inArray(c,d)?c:this.data.languages.current_language),e[c]&&e[c][b]?e[c][b]:e[b]?e[b]:b},get_text:function(b,c){if(b=this._get_node(b)||this.data.ui.last_selected,!b.size())return!1;var d=this._get_settings().languages,e=this._get_settings().core.html_titles;return a.isArray(d)&&d.length?(c=c&&-1!=a.inArray(c,d)?c:this.data.languages.current_language,b=b.children("a."+c)):b=b.children("a:eq(0)"),e?(b=b.clone(),b.children("INS").remove(),b.html()):(b=b.contents().filter(function(){return 3==this.nodeType})[0],b.nodeValue)},set_text:function(b,c,d){if(b=this._get_node(b)||this.data.ui.last_selected,!b.size())return!1;var e,f=this._get_settings().languages,g=this._get_settings().core.html_titles;return a.isArray(f)&&f.length?(d=d&&-1!=a.inArray(d,f)?d:this.data.languages.current_language,b=b.children("a."+d)):b=b.children("a:eq(0)"),g?(e=b.children("INS").clone(),b.html(c).prepend(e),this.__callback({obj:b,name:c,lang:d}),!0):(b=b.contents().filter(function(){return 3==this.nodeType})[0],this.__callback({obj:b,name:c,lang:d}),b.nodeValue=c)},_load_css:function(){var c,d=this._get_settings().languages,e="/* languages css */",f=".jstree-"+this.get_index()+" a";if(a.isArray(d)&&d.length){for(this.data.languages.current_language=d[0],c=0;c<d.length;c++)e+=f+"."+d[c]+" {",d[c]!=this.data.languages.current_language&&(e+=" display:none; "),e+=" } ";b=a.vakata.css.add_sheet({str:e,title:"jstree-languages"})}},create_node:function(b,c,d,e){var f=this.__call_old(!0,b,c,d,function(b){var c,d=this._get_settings().languages,f=b.children("a");if(a.isArray(d)&&d.length){for(c=0;c<d.length;c++)f.is("."+d[c])||b.append(f.eq(0).clone().removeClass(d.join(" ")).addClass(d[c]));f.not("."+d.join(", .")).remove()}e&&e.call(this,b)});return f}}})}(jQuery),function(a){a.jstree.plugin("cookies",{__init:function(){if("undefined"==typeof a.cookie)throw"jsTree cookie: jQuery cookie plugin not included.";var b,c=this._get_settings().cookies;c.save_loaded&&(b=a.cookie(c.save_loaded),b&&b.length&&(this.data.core.to_load=b.split(","))),c.save_opened&&(b=a.cookie(c.save_opened),b&&b.length&&(this.data.core.to_open=b.split(","))),c.save_selected&&(b=a.cookie(c.save_selected),b&&b.length&&this.data.ui&&(this.data.ui.to_select=b.split(","))),this.get_container().one((this.data.ui?"reselect":"reopen")+".jstree",a.proxy(function(){this.get_container().bind("open_node.jstree close_node.jstree select_node.jstree deselect_node.jstree",a.proxy(function(a){this._get_settings().cookies.auto_save&&this.save_cookie((a.handleObj.namespace+a.handleObj.type).replace("jstree",""))},this))},this))},defaults:{save_loaded:"jstree_load",save_opened:"jstree_open",save_selected:"jstree_select",auto_save:!0,cookie_options:{}},_fn:{save_cookie:function(b){if(!this.data.core.refreshing){var c=this._get_settings().cookies;if(!b)return c.save_loaded&&(this.save_loaded(),a.cookie(c.save_loaded,this.data.core.to_load.join(","),c.cookie_options)),c.save_opened&&(this.save_opened(),a.cookie(c.save_opened,this.data.core.to_open.join(","),c.cookie_options)),void(c.save_selected&&this.data.ui&&(this.save_selected(),a.cookie(c.save_selected,this.data.ui.to_select.join(","),c.cookie_options)));switch(b){case"open_node":case"close_node":c.save_opened&&(this.save_opened(),a.cookie(c.save_opened,this.data.core.to_open.join(","),c.cookie_options)),c.save_loaded&&(this.save_loaded(),a.cookie(c.save_loaded,this.data.core.to_load.join(","),c.cookie_options));break;case"select_node":case"deselect_node":c.save_selected&&this.data.ui&&(this.save_selected(),a.cookie(c.save_selected,this.data.ui.to_select.join(","),c.cookie_options))}}}}})}(jQuery),function(a){a.jstree.plugin("sort",{__init:function(){this.get_container().bind("load_node.jstree",a.proxy(function(a,b){var c=this._get_node(b.rslt.obj);c=-1===c?this.get_container().children("ul"):c.children("ul"),this.sort(c)},this)).bind("rename_node.jstree create_node.jstree create.jstree",a.proxy(function(a,b){this.sort(b.rslt.obj.parent())},this)).bind("move_node.jstree",a.proxy(function(a,b){var c=-1==b.rslt.np?this.get_container():b.rslt.np;this.sort(c.children("ul"))},this))},defaults:function(a,b){return this.get_text(a)>this.get_text(b)?1:-1},_fn:{sort:function(b){var c=this._get_settings().sort,d=this;b.append(a.makeArray(b.children("li")).sort(a.proxy(c,d))),b.find("> li > ul").each(function(){d.sort(a(this))}),this.clean_node(b)}}})}(jQuery),function(a){var b=!1,c=!1,d=!1,e=!1,f=!1,g=!1,h=!1,i=!1,j=!1;a.vakata.dnd={is_down:!1,is_drag:!1,helper:!1,scroll_spd:10,init_x:0,init_y:0,threshold:5,helper_left:5,helper_top:10,user_data:{},drag_start:function(b,c,d){a.vakata.dnd.is_drag&&a.vakata.drag_stop({});try{b.currentTarget.unselectable="on",b.currentTarget.onselectstart=function(){return!1},b.currentTarget.style&&(b.currentTarget.style.MozUserSelect="none")}catch(e){}return a.vakata.dnd.init_x=b.pageX,a.vakata.dnd.init_y=b.pageY,a.vakata.dnd.user_data=c,a.vakata.dnd.is_down=!0,a.vakata.dnd.helper=a("<div id='vakata-dragged' />").html(d),a(document).bind("mousemove",a.vakata.dnd.drag),a(document).bind("mouseup",a.vakata.dnd.drag_stop),!1},drag:function(b){if(a.vakata.dnd.is_down){if(!a.vakata.dnd.is_drag){if(!(Math.abs(b.pageX-a.vakata.dnd.init_x)>5||Math.abs(b.pageY-a.vakata.dnd.init_y)>5))return;a.vakata.dnd.helper.appendTo("body"),a.vakata.dnd.is_drag=!0,a(document).triggerHandler("drag_start.vakata",{event:b,data:a.vakata.dnd.user_data})}if("mousemove"===b.type){var c=a(document),d=c.scrollTop(),e=c.scrollLeft();b.pageY-d<20?(g&&"down"===h&&(clearInterval(g),g=!1),g||(h="up",g=setInterval(function(){a(document).scrollTop(a(document).scrollTop()-a.vakata.dnd.scroll_spd)},150))):g&&"up"===h&&(clearInterval(g),g=!1),a(window).height()-(b.pageY-d)<20?(g&&"up"===h&&(clearInterval(g),g=!1),g||(h="down",g=setInterval(function(){a(document).scrollTop(a(document).scrollTop()+a.vakata.dnd.scroll_spd)},150))):g&&"down"===h&&(clearInterval(g),g=!1),b.pageX-e<20?(f&&"right"===i&&(clearInterval(f),f=!1),f||(i="left",f=setInterval(function(){a(document).scrollLeft(a(document).scrollLeft()-a.vakata.dnd.scroll_spd)},150))):f&&"left"===i&&(clearInterval(f),f=!1),a(window).width()-(b.pageX-e)<20?(f&&"left"===i&&(clearInterval(f),f=!1),f||(i="right",f=setInterval(function(){a(document).scrollLeft(a(document).scrollLeft()+a.vakata.dnd.scroll_spd)},150))):f&&"right"===i&&(clearInterval(f),f=!1)}a.vakata.dnd.helper.css({left:b.pageX+a.vakata.dnd.helper_left+"px",top:b.pageY+a.vakata.dnd.helper_top+"px"}),a(document).triggerHandler("drag.vakata",{event:b,data:a.vakata.dnd.user_data})}},drag_stop:function(b){f&&clearInterval(f),g&&clearInterval(g),a(document).unbind("mousemove",a.vakata.dnd.drag),a(document).unbind("mouseup",a.vakata.dnd.drag_stop),a(document).triggerHandler("drag_stop.vakata",{event:b,data:a.vakata.dnd.user_data}),a.vakata.dnd.helper.remove(),a.vakata.dnd.init_x=0,a.vakata.dnd.init_y=0,a.vakata.dnd.user_data={},a.vakata.dnd.is_down=!1,a.vakata.dnd.is_drag=!1}},a(function(){var b="#vakata-dragged { display:block; margin:0 0 0 0; padding:4px 4px 4px 24px; position:absolute; top:-2000px; line-height:16px; z-index:10000; } ";a.vakata.css.add_sheet({str:b,title:"vakata"})}),a.jstree.plugin("dnd",{__init:function(){this.data.dnd={active:!1,after:!1,inside:!1,before:!1,off:!1,prepared:!1,w:0,to1:!1,to2:!1,cof:!1,cw:!1,ch:!1,i1:!1,i2:!1,mto:!1},this.get_container().bind("mouseenter.jstree",a.proxy(function(c){if(a.vakata.dnd.is_drag&&a.vakata.dnd.user_data.jstree&&(this.data.themes&&(d.attr("class","jstree-"+this.data.themes.theme),e&&e.attr("class","jstree-"+this.data.themes.theme),a.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme)),c.currentTarget===c.target&&a.vakata.dnd.user_data.obj&&a(a.vakata.dnd.user_data.obj).length&&a(a.vakata.dnd.user_data.obj).parents(".jstree:eq(0)")[0]!==c.target)){var f,g=a.jstree._reference(c.target);g.data.dnd.foreign?(f=g._get_settings().dnd.drag_check.call(this,{o:b,r:g.get_container(),is_root:!0}),(f===!0||f.inside===!0||f.before===!0||f.after===!0)&&a.vakata.dnd.helper.children("ins").attr("class","jstree-ok")):(g.prepare_move(b,g.get_container(),"last"),g.check_move()&&a.vakata.dnd.helper.children("ins").attr("class","jstree-ok"))}},this)).bind("mouseup.jstree",a.proxy(function(c){if(a.vakata.dnd.is_drag&&a.vakata.dnd.user_data.jstree&&c.currentTarget===c.target&&a.vakata.dnd.user_data.obj&&a(a.vakata.dnd.user_data.obj).length&&a(a.vakata.dnd.user_data.obj).parents(".jstree:eq(0)")[0]!==c.target){var d,e=a.jstree._reference(c.currentTarget);e.data.dnd.foreign?(d=e._get_settings().dnd.drag_check.call(this,{o:b,r:e.get_container(),is_root:!0}),(d===!0||d.inside===!0||d.before===!0||d.after===!0)&&e._get_settings().dnd.drag_finish.call(this,{o:b,r:e.get_container(),is_root:!0})):e.move_node(b,e.get_container(),"last",c[e._get_settings().dnd.copy_modifier+"Key"])}},this)).bind("mouseleave.jstree",a.proxy(function(b){return b.relatedTarget&&b.relatedTarget.id&&"jstree-marker-line"===b.relatedTarget.id?!1:void(a.vakata.dnd.is_drag&&a.vakata.dnd.user_data.jstree&&(this.data.dnd.i1&&clearInterval(this.data.dnd.i1),this.data.dnd.i2&&clearInterval(this.data.dnd.i2),this.data.dnd.to1&&clearTimeout(this.data.dnd.to1),this.data.dnd.to2&&clearTimeout(this.data.dnd.to2),a.vakata.dnd.helper.children("ins").hasClass("jstree-ok")&&a.vakata.dnd.helper.children("ins").attr("class","jstree-invalid")))},this)).bind("mousemove.jstree",a.proxy(function(b){if(a.vakata.dnd.is_drag&&a.vakata.dnd.user_data.jstree){var c=this.get_container()[0];b.pageX+24>this.data.dnd.cof.left+this.data.dnd.cw?(this.data.dnd.i1&&clearInterval(this.data.dnd.i1),this.data.dnd.i1=setInterval(a.proxy(function(){this.scrollLeft+=a.vakata.dnd.scroll_spd},c),100)):b.pageX-24<this.data.dnd.cof.left?(this.data.dnd.i1&&clearInterval(this.data.dnd.i1),this.data.dnd.i1=setInterval(a.proxy(function(){this.scrollLeft-=a.vakata.dnd.scroll_spd},c),100)):this.data.dnd.i1&&clearInterval(this.data.dnd.i1),b.pageY+24>this.data.dnd.cof.top+this.data.dnd.ch?(this.data.dnd.i2&&clearInterval(this.data.dnd.i2),this.data.dnd.i2=setInterval(a.proxy(function(){this.scrollTop+=a.vakata.dnd.scroll_spd},c),100)):b.pageY-24<this.data.dnd.cof.top?(this.data.dnd.i2&&clearInterval(this.data.dnd.i2),this.data.dnd.i2=setInterval(a.proxy(function(){this.scrollTop-=a.vakata.dnd.scroll_spd},c),100)):this.data.dnd.i2&&clearInterval(this.data.dnd.i2)}},this)).bind("scroll.jstree",a.proxy(function(){a.vakata.dnd.is_drag&&a.vakata.dnd.user_data.jstree&&d&&e&&(d.hide(),e.hide())},this)).delegate("a","mousedown.jstree",a.proxy(function(a){return 1===a.which?(this.start_drag(a.currentTarget,a),!1):void 0},this)).delegate("a","mouseenter.jstree",a.proxy(function(b){a.vakata.dnd.is_drag&&a.vakata.dnd.user_data.jstree&&this.dnd_enter(b.currentTarget)},this)).delegate("a","mousemove.jstree",a.proxy(function(b){a.vakata.dnd.is_drag&&a.vakata.dnd.user_data.jstree&&(c&&c.length&&c.children("a")[0]===b.currentTarget||this.dnd_enter(b.currentTarget),"undefined"==typeof this.data.dnd.off.top&&(this.data.dnd.off=a(b.target).offset()),this.data.dnd.w=(b.pageY-(this.data.dnd.off.top||0))%this.data.core.li_height,this.data.dnd.w<0&&(this.data.dnd.w+=this.data.core.li_height),this.dnd_show())},this)).delegate("a","mouseleave.jstree",a.proxy(function(b){if(a.vakata.dnd.is_drag&&a.vakata.dnd.user_data.jstree){if(b.relatedTarget&&b.relatedTarget.id&&"jstree-marker-line"===b.relatedTarget.id)return!1;d&&d.hide(),e&&e.hide(),this.data.dnd.mto=setTimeout(function(a){return function(){a.dnd_leave(b)}}(this),0)}},this)).delegate("a","mouseup.jstree",a.proxy(function(b){a.vakata.dnd.is_drag&&a.vakata.dnd.user_data.jstree&&this.dnd_finish(b)},this)),a(document).bind("drag_stop.vakata",a.proxy(function(){this.data.dnd.to1&&clearTimeout(this.data.dnd.to1),this.data.dnd.to2&&clearTimeout(this.data.dnd.to2),this.data.dnd.i1&&clearInterval(this.data.dnd.i1),this.data.dnd.i2&&clearInterval(this.data.dnd.i2),this.data.dnd.after=!1,this.data.dnd.before=!1,this.data.dnd.inside=!1,this.data.dnd.off=!1,this.data.dnd.prepared=!1,this.data.dnd.w=!1,this.data.dnd.to1=!1,this.data.dnd.to2=!1,this.data.dnd.i1=!1,this.data.dnd.i2=!1,this.data.dnd.active=!1,this.data.dnd.foreign=!1,d&&d.css({top:"-2000px"}),e&&e.css({top:"-2000px"})},this)).bind("drag_start.vakata",a.proxy(function(b,c){if(c.data.jstree){var d=a(c.event.target);d.closest(".jstree").hasClass("jstree-"+this.get_index())&&this.dnd_enter(d)}},this));var f=this._get_settings().dnd;f.drag_target&&a(document).delegate(f.drag_target,"mousedown.jstree-"+this.get_index(),a.proxy(function(c){b=c.target,a.vakata.dnd.drag_start(c,{jstree:!0,obj:c.target},"<ins class='jstree-icon'></ins>"+a(c.target).text()),this.data.themes&&(d&&d.attr("class","jstree-"+this.data.themes.theme),e&&e.attr("class","jstree-"+this.data.themes.theme),a.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme)),a.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");var f=this.get_container();this.data.dnd.cof=f.offset(),this.data.dnd.cw=parseInt(f.width(),10),this.data.dnd.ch=parseInt(f.height(),10),this.data.dnd.foreign=!0,c.preventDefault()},this)),f.drop_target&&a(document).delegate(f.drop_target,"mouseenter.jstree-"+this.get_index(),a.proxy(function(c){this.data.dnd.active&&this._get_settings().dnd.drop_check.call(this,{o:b,r:a(c.target),e:c})&&a.vakata.dnd.helper.children("ins").attr("class","jstree-ok")},this)).delegate(f.drop_target,"mouseleave.jstree-"+this.get_index(),a.proxy(function(){this.data.dnd.active&&a.vakata.dnd.helper.children("ins").attr("class","jstree-invalid")},this)).delegate(f.drop_target,"mouseup.jstree-"+this.get_index(),a.proxy(function(c){this.data.dnd.active&&a.vakata.dnd.helper.children("ins").hasClass("jstree-ok")&&this._get_settings().dnd.drop_finish.call(this,{o:b,r:a(c.target),e:c})},this))},defaults:{copy_modifier:"ctrl",check_timeout:100,open_timeout:500,drop_target:".jstree-drop",drop_check:function(){return!0},drop_finish:a.noop,drag_target:".jstree-draggable",drag_finish:a.noop,drag_check:function(){return{after:!1,before:!1,inside:!0}}},_fn:{dnd_prepare:function(){if(c&&c.length){if(this.data.dnd.off=c.offset(),this._get_settings().core.rtl&&(this.data.dnd.off.right=this.data.dnd.off.left+c.width()),this.data.dnd.foreign){var a=this._get_settings().dnd.drag_check.call(this,{o:b,r:c});return this.data.dnd.after=a.after,this.data.dnd.before=a.before,this.data.dnd.inside=a.inside,this.data.dnd.prepared=!0,this.dnd_show()}return this.prepare_move(b,c,"before"),this.data.dnd.before=this.check_move(),this.prepare_move(b,c,"after"),this.data.dnd.after=this.check_move(),this._is_loaded(c)?(this.prepare_move(b,c,"inside"),this.data.dnd.inside=this.check_move()):this.data.dnd.inside=!1,this.data.dnd.prepared=!0,this.dnd_show()}},dnd_show:function(){if(this.data.dnd.prepared){var b,c=["before","inside","after"],f=!1,g=this._get_settings().core.rtl;switch(c=this.data.dnd.w<this.data.core.li_height/3?["before","inside","after"]:this.data.dnd.w<=2*this.data.core.li_height/3?this.data.dnd.w<this.data.core.li_height/2?["inside","before","after"]:["inside","after","before"]:["after","inside","before"],a.each(c,a.proxy(function(b,c){return this.data.dnd[c]?(a.vakata.dnd.helper.children("ins").attr("class","jstree-ok"),f=c,!1):void 0},this)),f===!1&&a.vakata.dnd.helper.children("ins").attr("class","jstree-invalid"),b=g?this.data.dnd.off.right-18:this.data.dnd.off.left+10,f){case"before":d.css({left:b+"px",top:this.data.dnd.off.top-6+"px"}).show(),e&&e.css({left:b+8+"px",top:this.data.dnd.off.top-1+"px"}).show();
break;case"after":d.css({left:b+"px",top:this.data.dnd.off.top+this.data.core.li_height-6+"px"}).show(),e&&e.css({left:b+8+"px",top:this.data.dnd.off.top+this.data.core.li_height-1+"px"}).show();break;case"inside":d.css({left:b+(g?-4:4)+"px",top:this.data.dnd.off.top+this.data.core.li_height/2-5+"px"}).show(),e&&e.hide();break;default:d.hide(),e&&e.hide()}return j=f,f}},dnd_open:function(){this.data.dnd.to2=!1,this.open_node(c,a.proxy(this.dnd_prepare,this),!0)},dnd_finish:function(a){this.data.dnd.foreign?(this.data.dnd.after||this.data.dnd.before||this.data.dnd.inside)&&this._get_settings().dnd.drag_finish.call(this,{o:b,r:c,p:j}):(this.dnd_prepare(),this.move_node(b,c,j,a[this._get_settings().dnd.copy_modifier+"Key"])),b=!1,c=!1,d.hide(),e&&e.hide()},dnd_enter:function(b){this.data.dnd.mto&&(clearTimeout(this.data.dnd.mto),this.data.dnd.mto=!1);var d=this._get_settings().dnd;this.data.dnd.prepared=!1,c=this._get_node(b),d.check_timeout?(this.data.dnd.to1&&clearTimeout(this.data.dnd.to1),this.data.dnd.to1=setTimeout(a.proxy(this.dnd_prepare,this),d.check_timeout)):this.dnd_prepare(),d.open_timeout?(this.data.dnd.to2&&clearTimeout(this.data.dnd.to2),c&&c.length&&c.hasClass("jstree-closed")&&(this.data.dnd.to2=setTimeout(a.proxy(this.dnd_open,this),d.open_timeout))):c&&c.length&&c.hasClass("jstree-closed")&&this.dnd_open()},dnd_leave:function(b){this.data.dnd.after=!1,this.data.dnd.before=!1,this.data.dnd.inside=!1,a.vakata.dnd.helper.children("ins").attr("class","jstree-invalid"),d.hide(),e&&e.hide(),c&&c[0]===b.target.parentNode&&(this.data.dnd.to1&&(clearTimeout(this.data.dnd.to1),this.data.dnd.to1=!1),this.data.dnd.to2&&(clearTimeout(this.data.dnd.to2),this.data.dnd.to2=!1))},start_drag:function(c,f){b=this._get_node(c),this.data.ui&&this.is_selected(b)&&(b=this._get_node(null,!0));var g=b.length>1?this._get_string("multiple_selection"):this.get_text(b),h=this.get_container();this._get_settings().core.html_titles||(g=g.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")),a.vakata.dnd.drag_start(f,{jstree:!0,obj:b},"<ins class='jstree-icon'></ins>"+g),this.data.themes&&(d&&d.attr("class","jstree-"+this.data.themes.theme),e&&e.attr("class","jstree-"+this.data.themes.theme),a.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme)),this.data.dnd.cof=h.offset(),this.data.dnd.cw=parseInt(h.width(),10),this.data.dnd.ch=parseInt(h.height(),10),this.data.dnd.active=!0}}}),a(function(){var b="#vakata-dragged ins { display:block; text-decoration:none; width:16px; height:16px; margin:0 0 0 0; padding:0; position:absolute; top:4px; left:4px;  -moz-border-radius:4px; border-radius:4px; -webkit-border-radius:4px; } #vakata-dragged .jstree-ok { background:green; } #vakata-dragged .jstree-invalid { background:red; } #jstree-marker { padding:0; margin:0; font-size:12px; overflow:hidden; height:12px; width:8px; position:absolute; top:-30px; z-index:10001; background-repeat:no-repeat; display:none; background-color:transparent; text-shadow:1px 1px 1px white; color:black; line-height:10px; } #jstree-marker-line { padding:0; margin:0; line-height:0%; font-size:1px; overflow:hidden; height:1px; width:100px; position:absolute; top:-30px; z-index:10000; background-repeat:no-repeat; display:none; background-color:#456c43;  cursor:pointer; border:1px solid #eeeeee; border-left:0; -moz-box-shadow: 0px 0px 2px #666; -webkit-box-shadow: 0px 0px 2px #666; box-shadow: 0px 0px 2px #666;  -moz-border-radius:1px; border-radius:1px; -webkit-border-radius:1px; }";a.vakata.css.add_sheet({str:b,title:"jstree"}),d=a("<div />").attr({id:"jstree-marker"}).hide().html("&raquo;").bind("mouseleave mouseenter",function(a){return d.hide(),e.hide(),a.preventDefault(),a.stopImmediatePropagation(),!1}).appendTo("body"),e=a("<div />").attr({id:"jstree-marker-line"}).hide().bind("mouseup",function(a){return c&&c.length?(c.children("a").trigger(a),a.preventDefault(),a.stopImmediatePropagation(),!1):void 0}).bind("mouseleave",function(b){var f=a(b.relatedTarget);return(f.is(".jstree")||0===f.closest(".jstree").length)&&c&&c.length?(c.children("a").trigger(b),d.hide(),e.hide(),b.preventDefault(),b.stopImmediatePropagation(),!1):void 0}).appendTo("body"),a(document).bind("drag_start.vakata",function(a,b){b.data.jstree&&(d.show(),e&&e.show())}),a(document).bind("drag_stop.vakata",function(a,b){b.data.jstree&&(d.hide(),e&&e.hide())})})}(jQuery),function(a){a.jstree.plugin("checkbox",{__init:function(){this.data.checkbox.noui=this._get_settings().checkbox.override_ui,this.data.ui&&this.data.checkbox.noui&&(this.select_node=this.deselect_node=this.deselect_all=a.noop,this.get_selected=this.get_checked),this.get_container().bind("open_node.jstree create_node.jstree clean_node.jstree refresh.jstree",a.proxy(function(a,b){this._prepare_checkboxes(b.rslt.obj)},this)).bind("loaded.jstree",a.proxy(function(){this._prepare_checkboxes()},this)).delegate(this.data.ui&&this.data.checkbox.noui?"a":"ins.jstree-checkbox","click.jstree",a.proxy(function(a){return a.preventDefault(),this._get_node(a.target).hasClass("jstree-checked")?this.uncheck_node(a.target):this.check_node(a.target),this.data.ui&&this.data.checkbox.noui?(this.save_selected(),void(this.data.cookies&&this.save_cookie("select_node"))):(a.stopImmediatePropagation(),!1)},this))},defaults:{override_ui:!1,two_state:!1,real_checkboxes:!1,checked_parent_open:!0,real_checkboxes_names:function(a){return["check_"+(a[0].id||Math.ceil(1e4*Math.random())),1]}},__destroy:function(){this.get_container().find("input.jstree-real-checkbox").removeClass("jstree-real-checkbox").end().find("ins.jstree-checkbox").remove()},_fn:{_checkbox_notify:function(a,b){b.checked&&this.check_node(a,!1)},_prepare_checkboxes:function(b){if(b=b&&-1!=b?this._get_node(b):this.get_container().find("> ul > li"),b!==!1){var c,d,e=this,f=this._get_settings().checkbox.two_state,g=this._get_settings().checkbox.real_checkboxes,h=this._get_settings().checkbox.real_checkboxes_names;b.each(function(){d=a(this),c=d.is("li")&&(d.hasClass("jstree-checked")||g&&d.children(":checked").length)?"jstree-checked":"jstree-unchecked",d.find("li").andSelf().each(function(){var b,d=a(this);d.children("a"+(e.data.languages?"":":eq(0)")).not(":has(.jstree-checkbox)").prepend("<ins class='jstree-checkbox'>&#160;</ins>").parent().not(".jstree-checked, .jstree-unchecked").addClass(f?"jstree-unchecked":c),g&&(d.children(":checkbox").length?d.children(":checkbox").addClass("jstree-real-checkbox"):(b=h.call(e,d),d.prepend("<input type='checkbox' class='jstree-real-checkbox' id='"+b[0]+"' name='"+b[0]+"' value='"+b[1]+"' />"))),f?(d.hasClass("jstree-checked")||d.children(":checked").length)&&d.addClass("jstree-checked").children(":checkbox").prop("checked",!0):("jstree-checked"===c||d.hasClass("jstree-checked")||d.children(":checked").length)&&d.find("li").andSelf().addClass("jstree-checked").children(":checkbox").prop("checked",!0)})}),f||b.find(".jstree-checked").parent().parent().each(function(){e._repair_state(this)})}},change_state:function(b,c){b=this._get_node(b);var d=!1,e=this._get_settings().checkbox.real_checkboxes;if(!b||-1===b)return!1;if(c=c===!1||c===!0?c:b.hasClass("jstree-checked"),this._get_settings().checkbox.two_state)c?(b.removeClass("jstree-checked").addClass("jstree-unchecked"),e&&b.children(":checkbox").prop("checked",!1)):(b.removeClass("jstree-unchecked").addClass("jstree-checked"),e&&b.children(":checkbox").prop("checked",!0));else{if(c){if(d=b.find("li").andSelf(),!d.filter(".jstree-checked, .jstree-undetermined").length)return!1;d.removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked"),e&&d.children(":checkbox").prop("checked",!1)}else{if(d=b.find("li").andSelf(),!d.filter(".jstree-unchecked, .jstree-undetermined").length)return!1;d.removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked"),e&&d.children(":checkbox").prop("checked",!0),this.data.ui&&(this.data.ui.last_selected=b),this.data.checkbox.last_selected=b}b.parentsUntil(".jstree","li").each(function(){var b=a(this);if(c){if(b.children("ul").children("li.jstree-checked, li.jstree-undetermined").length)return b.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined"),e&&b.parentsUntil(".jstree","li").andSelf().children(":checkbox").prop("checked",!1),!1;b.removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked"),e&&b.children(":checkbox").prop("checked",!1)}else{if(b.children("ul").children("li.jstree-unchecked, li.jstree-undetermined").length)return b.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined"),e&&b.parentsUntil(".jstree","li").andSelf().children(":checkbox").prop("checked",!1),!1;b.removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked"),e&&b.children(":checkbox").prop("checked",!0)}})}return this.data.ui&&this.data.checkbox.noui&&(this.data.ui.selected=this.get_checked()),this.__callback(b),!0},check_node:function(a){if(this.change_state(a,!1)){if(a=this._get_node(a),this._get_settings().checkbox.checked_parent_open){var b=this;a.parents(".jstree-closed").each(function(){b.open_node(this,!1,!0)})}this.__callback({obj:a})}},uncheck_node:function(a){this.change_state(a,!0)&&this.__callback({obj:this._get_node(a)})},check_all:function(){var a=this,b=this._get_settings().checkbox.two_state?this.get_container_ul().find("li"):this.get_container_ul().children("li");b.each(function(){a.change_state(this,!1)}),this.__callback()},uncheck_all:function(){var a=this,b=this._get_settings().checkbox.two_state?this.get_container_ul().find("li"):this.get_container_ul().children("li");b.each(function(){a.change_state(this,!0)}),this.__callback()},is_checked:function(a){return a=this._get_node(a),a.length?a.is(".jstree-checked"):!1},get_checked:function(a,b){return a=a&&-1!==a?this._get_node(a):this.get_container(),a.find(b||this._get_settings().checkbox.two_state?".jstree-checked":"> ul > .jstree-checked, .jstree-undetermined > ul > .jstree-checked")},get_unchecked:function(a,b){return a=a&&-1!==a?this._get_node(a):this.get_container(),a.find(b||this._get_settings().checkbox.two_state?".jstree-unchecked":"> ul > .jstree-unchecked, .jstree-undetermined > ul > .jstree-unchecked")},show_checkboxes:function(){this.get_container().children("ul").removeClass("jstree-no-checkboxes")},hide_checkboxes:function(){this.get_container().children("ul").addClass("jstree-no-checkboxes")},_repair_state:function(a){if(a=this._get_node(a),a.length){if(this._get_settings().checkbox.two_state)return void a.find("li").andSelf().not(".jstree-checked").removeClass("jstree-undetermined").addClass("jstree-unchecked").children(":checkbox").prop("checked",!0);var b=this._get_settings().checkbox.real_checkboxes,c=a.find("> ul > .jstree-checked").length,d=a.find("> ul > .jstree-undetermined").length,e=a.find("> ul > li").length;0===e?a.hasClass("jstree-undetermined")&&this.change_state(a,!1):0===c&&0===d?this.change_state(a,!0):c===e?this.change_state(a,!1):(a.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined"),b&&a.parentsUntil(".jstree","li").andSelf().children(":checkbox").prop("checked",!1))}},reselect:function(){if(this.data.ui&&this.data.checkbox.noui){var b=this,c=this.data.ui.to_select;c=a.map(a.makeArray(c),function(a){return"#"+a.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}),this.deselect_all(),a.each(c,function(a,c){b.check_node(c)}),this.__callback()}else this.__call_old()},save_loaded:function(){var a=this;this.data.core.to_load=[],this.get_container_ul().find("li.jstree-closed.jstree-undetermined").each(function(){this.id&&a.data.core.to_load.push("#"+this.id)})}}}),a(function(){var b=".jstree .jstree-real-checkbox { display:none; } ";a.vakata.css.add_sheet({str:b,title:"jstree"})})}(jQuery),function(a){a.vakata.xslt=function(b,c,d){var e,f,g,h=!1;if(h===!1&&window.ActiveXObject)try{h=new ActiveXObject("Msxml2.XSLTemplate"),f=new ActiveXObject("Msxml2.DOMDocument"),f.loadXML(b),g=new ActiveXObject("Msxml2.FreeThreadedDOMDocument"),g.loadXML(c),h.stylesheet=g,e=h.createProcessor(),e.input=f,e.transform(),h=e.output}catch(i){}b=a.parseXML(b),c=a.parseXML(c),h===!1&&"undefined"!=typeof XSLTProcessor&&(e=new XSLTProcessor,e.importStylesheet(c),h=e.transformToFragment(b,document),h=a("<div />").append(h).html()),h===!1&&"undefined"!=typeof b.transformNode&&(h=b.transformNode(c)),d.call(null,h)};var b={nest:'<?xml version="1.0" encoding="utf-8" ?><xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" ><xsl:output method="html" encoding="utf-8" omit-xml-declaration="yes" standalone="no" indent="no" media-type="text/html" /><xsl:template match="/">	<xsl:call-template name="nodes">		<xsl:with-param name="node" select="/root" />	</xsl:call-template></xsl:template><xsl:template name="nodes">	<xsl:param name="node" />	<ul>	<xsl:for-each select="$node/item">		<xsl:variable name="children" select="count(./item) &gt; 0" />		<li>			<xsl:attribute name="class">				<xsl:if test="position() = last()">jstree-last </xsl:if>				<xsl:choose>					<xsl:when test="@state = \'open\'">jstree-open </xsl:when>					<xsl:when test="$children or @hasChildren or @state = \'closed\'">jstree-closed </xsl:when>					<xsl:otherwise>jstree-leaf </xsl:otherwise>				</xsl:choose>				<xsl:value-of select="@class" />			</xsl:attribute>			<xsl:for-each select="@*">				<xsl:if test="name() != \'class\' and name() != \'state\' and name() != \'hasChildren\'">					<xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>				</xsl:if>			</xsl:for-each>	<ins class="jstree-icon"><xsl:text>&#xa0;</xsl:text></ins>			<xsl:for-each select="content/name">				<a>				<xsl:attribute name="href">					<xsl:choose>					<xsl:when test="@href"><xsl:value-of select="@href" /></xsl:when>					<xsl:otherwise>#</xsl:otherwise>					</xsl:choose>				</xsl:attribute>				<xsl:attribute name="class"><xsl:value-of select="@lang" /> <xsl:value-of select="@class" /></xsl:attribute>				<xsl:attribute name="style"><xsl:value-of select="@style" /></xsl:attribute>				<xsl:for-each select="@*">					<xsl:if test="name() != \'style\' and name() != \'class\' and name() != \'href\'">						<xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>					</xsl:if>				</xsl:for-each>					<ins>						<xsl:attribute name="class">jstree-icon 							<xsl:if test="string-length(attribute::icon) > 0 and not(contains(@icon,\'/\'))"><xsl:value-of select="@icon" /></xsl:if>						</xsl:attribute>						<xsl:if test="string-length(attribute::icon) > 0 and contains(@icon,\'/\')"><xsl:attribute name="style">background:url(<xsl:value-of select="@icon" />) center center no-repeat;</xsl:attribute></xsl:if>						<xsl:text>&#xa0;</xsl:text>					</ins>					<xsl:copy-of select="./child::node()" />				</a>			</xsl:for-each>			<xsl:if test="$children or @hasChildren"><xsl:call-template name="nodes"><xsl:with-param name="node" select="current()" /></xsl:call-template></xsl:if>		</li>	</xsl:for-each>	</ul></xsl:template></xsl:stylesheet>',flat:'<?xml version="1.0" encoding="utf-8" ?><xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" ><xsl:output method="html" encoding="utf-8" omit-xml-declaration="yes" standalone="no" indent="no" media-type="text/xml" /><xsl:template match="/">	<ul>	<xsl:for-each select="//item[not(@parent_id) or @parent_id=0 or not(@parent_id = //item/@id)]">		<xsl:call-template name="nodes">			<xsl:with-param name="node" select="." />			<xsl:with-param name="is_last" select="number(position() = last())" />		</xsl:call-template>	</xsl:for-each>	</ul></xsl:template><xsl:template name="nodes">	<xsl:param name="node" />	<xsl:param name="is_last" />	<xsl:variable name="children" select="count(//item[@parent_id=$node/attribute::id]) &gt; 0" />	<li>	<xsl:attribute name="class">		<xsl:if test="$is_last = true()">jstree-last </xsl:if>		<xsl:choose>			<xsl:when test="@state = \'open\'">jstree-open </xsl:when>			<xsl:when test="$children or @hasChildren or @state = \'closed\'">jstree-closed </xsl:when>			<xsl:otherwise>jstree-leaf </xsl:otherwise>		</xsl:choose>		<xsl:value-of select="@class" />	</xsl:attribute>	<xsl:for-each select="@*">		<xsl:if test="name() != \'parent_id\' and name() != \'hasChildren\' and name() != \'class\' and name() != \'state\'">		<xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>		</xsl:if>	</xsl:for-each>	<ins class="jstree-icon"><xsl:text>&#xa0;</xsl:text></ins>	<xsl:for-each select="content/name">		<a>		<xsl:attribute name="href">			<xsl:choose>			<xsl:when test="@href"><xsl:value-of select="@href" /></xsl:when>			<xsl:otherwise>#</xsl:otherwise>			</xsl:choose>		</xsl:attribute>		<xsl:attribute name="class"><xsl:value-of select="@lang" /> <xsl:value-of select="@class" /></xsl:attribute>		<xsl:attribute name="style"><xsl:value-of select="@style" /></xsl:attribute>		<xsl:for-each select="@*">			<xsl:if test="name() != \'style\' and name() != \'class\' and name() != \'href\'">				<xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>			</xsl:if>		</xsl:for-each>			<ins>				<xsl:attribute name="class">jstree-icon 					<xsl:if test="string-length(attribute::icon) > 0 and not(contains(@icon,\'/\'))"><xsl:value-of select="@icon" /></xsl:if>				</xsl:attribute>				<xsl:if test="string-length(attribute::icon) > 0 and contains(@icon,\'/\')"><xsl:attribute name="style">background:url(<xsl:value-of select="@icon" />) center center no-repeat;</xsl:attribute></xsl:if>				<xsl:text>&#xa0;</xsl:text>			</ins>			<xsl:copy-of select="./child::node()" />		</a>	</xsl:for-each>	<xsl:if test="$children">		<ul>		<xsl:for-each select="//item[@parent_id=$node/attribute::id]">			<xsl:call-template name="nodes">				<xsl:with-param name="node" select="." />				<xsl:with-param name="is_last" select="number(position() = last())" />			</xsl:call-template>		</xsl:for-each>		</ul>	</xsl:if>	</li></xsl:template></xsl:stylesheet>'},c=function(a){return a.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};a.jstree.plugin("xml_data",{defaults:{data:!1,ajax:!1,xsl:"flat",clean_node:!1,correct_state:!0,get_skip_empty:!1,get_include_preamble:!0},_fn:{load_node:function(a,b,c){var d=this;this.load_node_xml(a,function(){d.__callback({obj:d._get_node(a)}),b.call(this)},c)},_is_loaded:function(b){var c=this._get_settings().xml_data;return b=this._get_node(b),-1==b||!b||!c.ajax&&!a.isFunction(c.data)||b.is(".jstree-open, .jstree-leaf")||b.children("ul").children("li").size()>0},load_node_xml:function(b,c,d){var e=this.get_settings().xml_data,f=function(){},g=function(){};if(b=this._get_node(b),b&&-1!==b){if(b.data("jstree_is_loading"))return;b.data("jstree_is_loading",!0)}switch(!0){case!e.data&&!e.ajax:throw"Neither data nor ajax settings supplied.";case a.isFunction(e.data):e.data.call(this,b,a.proxy(function(d){this.parse_xml(d,a.proxy(function(d){d&&(d=d.replace(/ ?xmlns="[^"]*"/gi,""),d.length>10?(d=a(d),-1!==b&&b?(b.children("a.jstree-loading").removeClass("jstree-loading"),b.append(d),b.removeData("jstree_is_loading")):this.get_container().children("ul").empty().append(d.children()),e.clean_node&&this.clean_node(b),c&&c.call(this)):b&&-1!==b?(b.children("a.jstree-loading").removeClass("jstree-loading"),b.removeData("jstree_is_loading"),e.correct_state&&(this.correct_state(b),c&&c.call(this))):e.correct_state&&(this.get_container().children("ul").empty(),c&&c.call(this)))},this))},this));break;case!!e.data&&!e.ajax||!!e.data&&!!e.ajax&&(!b||-1===b):b&&-1!=b||this.parse_xml(e.data,a.proxy(function(d){d?(d=d.replace(/ ?xmlns="[^"]*"/gi,""),d.length>10&&(d=a(d),this.get_container().children("ul").empty().append(d.children()),e.clean_node&&this.clean_node(b),c&&c.call(this))):e.correct_state&&(this.get_container().children("ul").empty(),c&&c.call(this))},this));break;case!e.data&&!!e.ajax||!!e.data&&!!e.ajax&&b&&-1!==b:f=function(a,c,f){var g=this.get_settings().xml_data.ajax.error;g&&g.call(this,a,c,f),-1!==b&&b.length?(b.children("a.jstree-loading").removeClass("jstree-loading"),b.removeData("jstree_is_loading"),"success"===c&&e.correct_state&&this.correct_state(b)):"success"===c&&e.correct_state&&this.get_container().children("ul").empty(),d&&d.call(this)},g=function(d,g,h){d=h.responseText;var i=this.get_settings().xml_data.ajax.success;return i&&(d=i.call(this,d,g,h)||d),""===d||d&&d.toString&&""===d.toString().replace(/^[\s\n]+$/,"")?f.call(this,h,g,""):void this.parse_xml(d,a.proxy(function(d){d&&(d=d.replace(/ ?xmlns="[^"]*"/gi,""),d.length>10?(d=a(d),-1!==b&&b?(b.children("a.jstree-loading").removeClass("jstree-loading"),b.append(d),b.removeData("jstree_is_loading")):this.get_container().children("ul").empty().append(d.children()),e.clean_node&&this.clean_node(b),c&&c.call(this)):b&&-1!==b?(b.children("a.jstree-loading").removeClass("jstree-loading"),b.removeData("jstree_is_loading"),e.correct_state&&(this.correct_state(b),c&&c.call(this))):e.correct_state&&(this.get_container().children("ul").empty(),c&&c.call(this)))},this))},e.ajax.context=this,e.ajax.error=f,e.ajax.success=g,e.ajax.dataType||(e.ajax.dataType="xml"),a.isFunction(e.ajax.url)&&(e.ajax.url=e.ajax.url.call(this,b)),a.isFunction(e.ajax.data)&&(e.ajax.data=e.ajax.data.call(this,b)),a.ajax(e.ajax)}},parse_xml:function(c,d){var e=this._get_settings().xml_data;a.vakata.xslt(c,b[e.xsl],d)},get_xml:function(b,d,e,f,g){var h,i,j,k,l,m="",n=this._get_settings(),o=this;return b||(b="flat"),g||(g=0),d=this._get_node(d),d&&-1!==d||(d=this.get_container().find("> ul > li")),e=a.isArray(e)?e:["id","class"],!g&&this.data.types&&-1===a.inArray(n.types.type_attr,e)&&e.push(n.types.type_attr),f=a.isArray(f)?f:[],g||(n.xml_data.get_include_preamble&&(m+='<?xml version="1.0" encoding="UTF-8"?>'),m+="<root>"),d.each(function(){m+="<item",j=a(this),a.each(e,function(a,b){var d=j.attr(b);n.xml_data.get_skip_empty&&"undefined"==typeof d||(m+=" "+b+'="'+c((" "+(d||"")).replace(/ jstree[^ ]*/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,""))+'"')}),j.hasClass("jstree-open")&&(m+=' state="open"'),j.hasClass("jstree-closed")&&(m+=' state="closed"'),"flat"===b&&(m+=' parent_id="'+c(g)+'"'),m+=">",m+="<content>",k=j.children("a"),k.each(function(){h=a(this),l=!1,m+="<name",-1!==a.inArray("languages",n.plugins)&&a.each(n.languages,function(a,b){return h.hasClass(b)?(m+=' lang="'+c(b)+'"',l=b,!1):void 0}),f.length&&a.each(f,function(a,b){var d=h.attr(b);n.xml_data.get_skip_empty&&"undefined"==typeof d||(m+=" "+b+'="'+c((" "+d||"").replace(/ jstree[^ ]*/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,""))+'"')}),h.children("ins").get(0).className.replace(/jstree[^ ]*|$/gi,"").replace(/^\s+$/gi,"").length&&(m+=' icon="'+c(h.children("ins").get(0).className.replace(/jstree[^ ]*|$/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,""))+'"'),h.children("ins").get(0).style.backgroundImage.length&&(m+=' icon="'+c(h.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","").replace(/'/gi,"").replace(/"/gi,""))+'"'),m+=">",m+="<![CDATA["+o.get_text(h,l)+"]]>",m+="</name>"}),m+="</content>",i=j[0].id||!0,j=j.find("> ul > li"),i=j.length?o.get_xml(b,j,e,f,i):"","nest"==b&&(m+=i),m+="</item>","flat"==b&&(m+=i)}),g||(m+="</root>"),m}}})}(jQuery),function(a){a().jquery.split(".")[1]>=8?(a.expr[":"].jstree_contains=a.expr.createPseudo(function(a){return function(b){return(b.textContent||b.innerText||"").toLowerCase().indexOf(a.toLowerCase())>=0}}),a.expr[":"].jstree_title_contains=a.expr.createPseudo(function(a){return function(b){return(b.getAttribute("title")||"").toLowerCase().indexOf(a.toLowerCase())>=0}})):(a.expr[":"].jstree_contains=function(a,b,c){return(a.textContent||a.innerText||"").toLowerCase().indexOf(c[3].toLowerCase())>=0},a.expr[":"].jstree_title_contains=function(a,b,c){return(a.getAttribute("title")||"").toLowerCase().indexOf(c[3].toLowerCase())>=0}),a.jstree.plugin("search",{__init:function(){this.data.search.str="",this.data.search.result=a(),this._get_settings().search.show_only_matches&&this.get_container().bind("search.jstree",function(b,c){a(this).children("ul").find("li").hide().removeClass("jstree-last"),c.rslt.nodes.parentsUntil(".jstree").andSelf().show().filter("ul").each(function(){a(this).children("li:visible").eq(-1).addClass("jstree-last")})}).bind("clear_search.jstree",function(){a(this).children("ul").find("li").css("display","").end().end().jstree("clean_node",-1)})},defaults:{ajax:!1,search_method:"jstree_contains",show_only_matches:!1},_fn:{search:function(b,c){if(""===a.trim(b))return void this.clear_search();var d=this.get_settings().search,e=this,f=function(){},g=function(){};return this.data.search.str=b,!c&&d.ajax!==!1&&this.get_container_ul().find("li.jstree-closed:not(:has(ul)):eq(0)").length>0?(this.search.supress_callback=!0,f=function(){},g=function(a,b,c){var d=this.get_settings().search.ajax.success;d&&(a=d.call(this,a,b,c)||a),this.data.search.to_open=a,this._search_open()},d.ajax.context=this,d.ajax.error=f,d.ajax.success=g,a.isFunction(d.ajax.url)&&(d.ajax.url=d.ajax.url.call(this,b)),a.isFunction(d.ajax.data)&&(d.ajax.data=d.ajax.data.call(this,b)),d.ajax.data||(d.ajax.data={search_string:b}),(!d.ajax.dataType||/^json/.exec(d.ajax.dataType))&&(d.ajax.dataType="json"),void a.ajax(d.ajax)):(this.data.search.result.length&&this.clear_search(),this.data.search.result=this.get_container().find("a"+(this.data.languages?"."+this.get_lang():"")+":"+d.search_method+"("+this.data.search.str+")"),this.data.search.result.addClass("jstree-search").parent().parents(".jstree-closed").each(function(){e.open_node(this,!1,!0)}),void this.__callback({nodes:this.data.search.result,str:b}))},clear_search:function(){this.data.search.result.removeClass("jstree-search"),this.__callback(this.data.search.result),this.data.search.result=a()},_search_open:function(){var b=this,c=!0,d=[],e=[];this.data.search.to_open.length&&(a.each(this.data.search.to_open,function(b,c){return"#"==c?!0:void(a(c).length&&a(c).is(".jstree-closed")?d.push(c):e.push(c))}),d.length&&(this.data.search.to_open=e,a.each(d,function(a,c){b.open_node(c,function(){b._search_open(!0)})}),c=!1)),c&&this.search(this.data.search.str,!0)}}})}(jQuery),function(a){a.vakata.context={hide_on_mouseleave:!1,cnt:a("<div id='vakata-contextmenu' />"),vis:!1,tgt:!1,par:!1,func:!1,data:!1,rtl:!1,show:function(b,c,d,e,f,g,h){a.vakata.context.rtl=!!h;var i,j,k=a.vakata.context.parse(b);k&&(a.vakata.context.vis=!0,a.vakata.context.tgt=c,a.vakata.context.par=g||c||null,a.vakata.context.data=f||null,a.vakata.context.cnt.html(k).css({visibility:"hidden",display:"block",left:0,top:0}),a.vakata.context.hide_on_mouseleave&&a.vakata.context.cnt.one("mouseleave",function(){a.vakata.context.hide()}),i=a.vakata.context.cnt.height(),j=a.vakata.context.cnt.width(),d+j>a(document).width()&&(d=a(document).width()-(j+5),a.vakata.context.cnt.find("li > ul").addClass("right")),e+i>a(document).height()&&(e-=i+c[0].offsetHeight,a.vakata.context.cnt.find("li > ul").addClass("bottom")),a.vakata.context.cnt.css({left:d,top:e}).find("li:has(ul)").bind("mouseenter",function(){var b=a(document).width(),c=a(document).height(),d=a(this).children("ul").show();b!==a(document).width()&&d.toggleClass("right"),c!==a(document).height()&&d.toggleClass("bottom")}).bind("mouseleave",function(){a(this).children("ul").hide()}).end().css({visibility:"visible"}).show(),a(document).triggerHandler("context_show.vakata"))},hide:function(){a.vakata.context.vis=!1,a.vakata.context.cnt.attr("class","").css({visibility:"hidden"}),a(document).triggerHandler("context_hide.vakata")},parse:function(b,c){if(!b)return!1;var d="",e=!1,f=!0;return c||(a.vakata.context.func={}),d+="<ul>",a.each(b,function(b,c){return c?(a.vakata.context.func[b]=c.action,!f&&c.separator_before&&(d+="<li class='vakata-separator vakata-separator-before'></li>"),f=!1,d+="<li class='"+(c._class||"")+(c._disabled?" jstree-contextmenu-disabled ":"")+"'><ins ",c.icon&&-1===c.icon.indexOf("/")&&(d+=" class='"+c.icon+"' "),c.icon&&-1!==c.icon.indexOf("/")&&(d+=" style='background:url("+c.icon+") center center no-repeat;' "),d+=">&#160;</ins><a href='#' rel='"+b+"'>",c.submenu&&(d+="<span style='float:"+(a.vakata.context.rtl?"left":"right")+";'>&raquo;</span>"),d+=c.label+"</a>",c.submenu&&(e=a.vakata.context.parse(c.submenu,!0),e&&(d+=e)),d+="</li>",void(c.separator_after&&(d+="<li class='vakata-separator vakata-separator-after'></li>",f=!0))):!0}),d=d.replace(/<li class\='vakata-separator vakata-separator-after'\><\/li\>$/,""),d+="</ul>",a(document).triggerHandler("context_parse.vakata"),d.length>10?d:!1},exec:function(b){return a.isFunction(a.vakata.context.func[b])?(a.vakata.context.func[b].call(a.vakata.context.data,a.vakata.context.par),!0):!1}},a(function(){var b="#vakata-contextmenu { display:block; visibility:hidden; left:0; top:-200px; position:absolute; margin:0; padding:0; min-width:180px; background:#ebebeb; border:1px solid silver; z-index:10000; *width:180px; } #vakata-contextmenu ul { min-width:180px; *width:180px; } #vakata-contextmenu ul, #vakata-contextmenu li { margin:0; padding:0; list-style-type:none; display:block; } #vakata-contextmenu li { line-height:20px; min-height:20px; position:relative; padding:0px; } #vakata-contextmenu li a { padding:1px 6px; line-height:17px; display:block; text-decoration:none; margin:1px 1px 0 1px; } #vakata-contextmenu li ins { float:left; width:16px; height:16px; text-decoration:none; margin-right:2px; } #vakata-contextmenu li a:hover, #vakata-contextmenu li.vakata-hover > a { background:gray; color:white; } #vakata-contextmenu li ul { display:none; position:absolute; top:-2px; left:100%; background:#ebebeb; border:1px solid gray; } #vakata-contextmenu .right { right:100%; left:auto; } #vakata-contextmenu .bottom { bottom:-1px; top:auto; } #vakata-contextmenu li.vakata-separator { min-height:0; height:1px; line-height:1px; font-size:1px; overflow:hidden; margin:0 2px; background:silver; /* border-top:1px solid #fefefe; */ padding:0; } ";a.vakata.css.add_sheet({str:b,title:"vakata"}),a.vakata.context.cnt.delegate("a","click",function(a){a.preventDefault()}).delegate("a","mouseup",function(){!a(this).parent().hasClass("jstree-contextmenu-disabled")&&a.vakata.context.exec(a(this).attr("rel"))?a.vakata.context.hide():a(this).blur()}).delegate("a","mouseover",function(){a.vakata.context.cnt.find(".vakata-hover").removeClass("vakata-hover")}).appendTo("body"),a(document).bind("mousedown",function(b){a.vakata.context.vis&&!a.contains(a.vakata.context.cnt[0],b.target)&&a.vakata.context.hide()}),"undefined"!=typeof a.hotkeys&&a(document).bind("keydown","up",function(b){if(a.vakata.context.vis){var c=a.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").prevAll("li:not(.vakata-separator)").first();c.length||(c=a.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").last()),c.addClass("vakata-hover"),b.stopImmediatePropagation(),b.preventDefault()}}).bind("keydown","down",function(b){if(a.vakata.context.vis){var c=a.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").nextAll("li:not(.vakata-separator)").first();c.length||(c=a.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").first()),c.addClass("vakata-hover"),b.stopImmediatePropagation(),b.preventDefault()}}).bind("keydown","right",function(b){a.vakata.context.vis&&(a.vakata.context.cnt.find(".vakata-hover").children("ul").show().children("li:not(.vakata-separator)").removeClass("vakata-hover").first().addClass("vakata-hover"),b.stopImmediatePropagation(),b.preventDefault())}).bind("keydown","left",function(b){a.vakata.context.vis&&(a.vakata.context.cnt.find(".vakata-hover").children("ul").hide().children(".vakata-separator").removeClass("vakata-hover"),b.stopImmediatePropagation(),b.preventDefault())
}).bind("keydown","esc",function(b){a.vakata.context.hide(),b.preventDefault()}).bind("keydown","space",function(b){a.vakata.context.cnt.find(".vakata-hover").last().children("a").click(),b.preventDefault()})}),a.jstree.plugin("contextmenu",{__init:function(){this.get_container().delegate("a","contextmenu.jstree",a.proxy(function(b){b.preventDefault(),a(b.currentTarget).hasClass("jstree-loading")||this.show_contextmenu(b.currentTarget,b.pageX,b.pageY)},this)).delegate("a","click.jstree",a.proxy(function(){this.data.contextmenu&&a.vakata.context.hide()},this)).bind("destroy.jstree",a.proxy(function(){this.data.contextmenu&&a.vakata.context.hide()},this)),a(document).bind("context_hide.vakata",a.proxy(function(){this.data.contextmenu=!1},this))},defaults:{select_node:!1,show_at_node:!0,items:{create:{separator_before:!1,separator_after:!0,label:"Create",action:function(a){this.create(a)}},rename:{separator_before:!1,separator_after:!1,label:"Rename",action:function(a){this.rename(a)}},remove:{separator_before:!1,icon:!1,separator_after:!1,label:"Delete",action:function(a){this.is_selected(a)?this.remove():this.remove(a)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(a){this.cut(a)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(a){this.copy(a)}},paste:{separator_before:!1,icon:!1,separator_after:!1,label:"Paste",action:function(a){this.paste(a)}}}}}},_fn:{show_contextmenu:function(b,c,d){b=this._get_node(b);var e=this.get_settings().contextmenu,f=b.children("a:visible:eq(0)"),g=!1,h=!1;e.select_node&&this.data.ui&&!this.is_selected(b)&&(this.deselect_all(),this.select_node(b,!0)),(e.show_at_node||"undefined"==typeof c||"undefined"==typeof d)&&(g=f.offset(),c=g.left,d=g.top+this.data.core.li_height),h=b.data("jstree")&&b.data("jstree").contextmenu?b.data("jstree").contextmenu:e.items,a.isFunction(h)&&(h=h.call(this,b)),this.data.contextmenu=!0,a.vakata.context.show(h,f,c,d,this,b,this._get_settings().core.rtl),this.data.themes&&a.vakata.context.cnt.attr("class","jstree-"+this.data.themes.theme+"-context")}}})}(jQuery),function(b){b.jstree.plugin("types",{__init:function(){var c=this._get_settings().types;this.data.types.attach_to=[],this.get_container().bind("init.jstree",b.proxy(function(){var a=c.types,d=c.type_attr,e="",f=this;b.each(a,function(a,c){return b.each(c,function(a){/^(max_depth|max_children|icon|valid_children)$/.test(a)||f.data.types.attach_to.push(a)}),c.icon?void((c.icon.image||c.icon.position)&&(e+="default"==a?".jstree-"+f.get_index()+" a > .jstree-icon { ":".jstree-"+f.get_index()+" li["+d+'="'+a+'"] > a > .jstree-icon { ',c.icon.image&&(e+=" background-image:url("+c.icon.image+"); "),e+=c.icon.position?" background-position:"+c.icon.position+"; ":" background-position:0 0; ",e+="} ")):!0}),""!==e&&b.vakata.css.add_sheet({str:e,title:"jstree-types"})},this)).bind("before.jstree",b.proxy(function(a,c){var d,e,f=this._get_settings().types.use_data?this._get_node(c.args[0]):!1,g=f&&-1!==f&&f.length?f.data("jstree"):!1;if(g&&g.types&&g.types[c.func]===!1)return a.stopImmediatePropagation(),!1;if(-1!==b.inArray(c.func,this.data.types.attach_to)){if(!c.args[0]||!c.args[0].tagName&&!c.args[0].jquery)return;if(d=this._get_settings().types.types,e=this._get_type(c.args[0]),(d[e]&&"undefined"!=typeof d[e][c.func]||d["default"]&&"undefined"!=typeof d["default"][c.func])&&this._check(c.func,c.args[0])===!1)return a.stopImmediatePropagation(),!1}},this)),a&&this.get_container().bind("load_node.jstree set_type.jstree",b.proxy(function(a,c){var d=c&&c.rslt&&c.rslt.obj&&-1!==c.rslt.obj?this._get_node(c.rslt.obj).parent():this.get_container_ul(),e=!1,f=this._get_settings().types;b.each(f.types,function(a,b){b.icon&&(b.icon.image||b.icon.position)&&(e=d.find("default"===a?"li > a > .jstree-icon":"li["+f.type_attr+"='"+a+"'] > a > .jstree-icon"),b.icon.image&&e.css("backgroundImage","url("+b.icon.image+")"),e.css("backgroundPosition",b.icon.position||"0 0"))})},this))},defaults:{max_children:-1,max_depth:-1,valid_children:"all",use_data:!1,type_attr:"rel",types:{"default":{max_children:-1,max_depth:-1,valid_children:"all"}}},_fn:{_types_notify:function(a,b){b.type&&this._get_settings().types.use_data&&this.set_type(b.type,a)},_get_type:function(a){return a=this._get_node(a),a&&a.length?a.attr(this._get_settings().types.type_attr)||"default":!1},set_type:function(a,b){b=this._get_node(b);var c=b.length&&a?b.attr(this._get_settings().types.type_attr,a):!1;return c&&this.__callback({obj:b,type:a}),c},_check:function(a,c,d){c=this._get_node(c);var e=!1,f=this._get_type(c),g=0,h=this,i=this._get_settings().types,j=!1;if(-1===c){if(!i[a])return;e=i[a]}else{if(f===!1)return;j=i.use_data?c.data("jstree"):!1,j&&j.types&&"undefined"!=typeof j.types[a]?e=j.types[a]:i.types[f]&&"undefined"!=typeof i.types[f][a]?e=i.types[f][a]:i.types["default"]&&"undefined"!=typeof i.types["default"][a]&&(e=i.types["default"][a])}return b.isFunction(e)&&(e=e.call(this,c)),"max_depth"===a&&-1!==c&&d!==!1&&-2!==i.max_depth&&0!==e&&c.children("a:eq(0)").parentsUntil(".jstree","li").each(function(b){return-1!==i.max_depth&&i.max_depth-(b+1)<=0?(e=0,!1):(g=0===b?e:h._check(a,this,!1),-1!==g&&0>=g-(b+1)?(e=0,!1):(g>=0&&(e>g-(b+1)||0>e)&&(e=g-(b+1)),void(i.max_depth>=0&&(i.max_depth-(b+1)<e||0>e)&&(e=i.max_depth-(b+1)))))}),e},check_move:function(){if(!this.__call_old())return!1;var a,c=this._get_move(),d=c.rt._get_settings().types,e=c.rt._check("max_children",c.cr),f=c.rt._check("max_depth",c.cr),g=c.rt._check("valid_children",c.cr),h=0,i=1;if("none"===g)return!1;if(b.isArray(g)&&c.ot&&c.ot._get_type&&(c.o.each(function(){return-1===b.inArray(c.ot._get_type(this),g)?(i=!1,!1):void 0}),i===!1))return!1;if(-2!==d.max_children&&-1!==e&&(h=-1===c.cr?this.get_container().find("> ul > li").not(c.o).length:c.cr.find("> ul > li").not(c.o).length,h+c.o.length>e))return!1;if(-2!==d.max_depth&&-1!==f){if(i=0,0===f)return!1;if("undefined"==typeof c.o.d){for(a=c.o;a.length>0;)a=a.find("> ul > li"),i++;c.o.d=i}if(f-c.o.d<0)return!1}return!0},create_node:function(a,c,d,e,f,g){if(!g&&(f||this._is_loaded(a))){var h,i="string"==typeof c&&c.match(/^before|after$/i)&&-1!==a?this._get_parent(a):this._get_node(a),j=this._get_settings().types,k=this._check("max_children",i),l=this._check("max_depth",i),m=this._check("valid_children",i);if("string"==typeof d&&(d={data:d}),d||(d={}),"none"===m)return!1;if(b.isArray(m))if(d.attr&&d.attr[j.type_attr]){if(-1===b.inArray(d.attr[j.type_attr],m))return!1}else d.attr||(d.attr={}),d.attr[j.type_attr]=m[0];if(-2!==j.max_children&&-1!==k&&(h=-1===i?this.get_container().find("> ul > li").length:i.find("> ul > li").length,h+1>k))return!1;if(-2!==j.max_depth&&-1!==l&&0>l-1)return!1}return this.__call_old(!0,a,c,d,e,f,g)}}})}(jQuery),function(a){a.jstree.plugin("html_data",{__init:function(){this.data.html_data.original_container_html=this.get_container().find(" > ul > li").clone(!0),this.data.html_data.original_container_html.find("li").andSelf().contents().filter(function(){return 3==this.nodeType}).remove()},defaults:{data:!1,ajax:!1,correct_state:!0},_fn:{load_node:function(a,b,c){var d=this;this.load_node_html(a,function(){d.__callback({obj:d._get_node(a)}),b.call(this)},c)},_is_loaded:function(b){return b=this._get_node(b),-1==b||!b||!this._get_settings().html_data.ajax&&!a.isFunction(this._get_settings().html_data.data)||b.is(".jstree-open, .jstree-leaf")||b.children("ul").children("li").size()>0},load_node_html:function(b,c,d){var e,f=this.get_settings().html_data,g=function(){},h=function(){};if(b=this._get_node(b),b&&-1!==b){if(b.data("jstree_is_loading"))return;b.data("jstree_is_loading",!0)}switch(!0){case a.isFunction(f.data):f.data.call(this,b,a.proxy(function(d){d&&""!==d&&d.toString&&""!==d.toString().replace(/^[\s\n]+$/,"")?(d=a(d),d.is("ul")||(d=a("<ul />").append(d)),-1!=b&&b?(b.children("a.jstree-loading").removeClass("jstree-loading"),b.append(d).children("ul").find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),b.removeData("jstree_is_loading")):this.get_container().children("ul").empty().append(d.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),this.clean_node(b),c&&c.call(this)):b&&-1!==b?(b.children("a.jstree-loading").removeClass("jstree-loading"),b.removeData("jstree_is_loading"),f.correct_state&&(this.correct_state(b),c&&c.call(this))):f.correct_state&&(this.get_container().children("ul").empty(),c&&c.call(this))},this));break;case!f.data&&!f.ajax:b&&-1!=b||(this.get_container().children("ul").empty().append(this.data.html_data.original_container_html).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),this.clean_node()),c&&c.call(this);break;case!!f.data&&!f.ajax||!!f.data&&!!f.ajax&&(!b||-1===b):b&&-1!=b||(e=a(f.data),e.is("ul")||(e=a("<ul />").append(e)),this.get_container().children("ul").empty().append(e.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),this.clean_node()),c&&c.call(this);break;case!f.data&&!!f.ajax||!!f.data&&!!f.ajax&&b&&-1!==b:b=this._get_node(b),g=function(a,c,e){var g=this.get_settings().html_data.ajax.error;g&&g.call(this,a,c,e),-1!=b&&b.length?(b.children("a.jstree-loading").removeClass("jstree-loading"),b.removeData("jstree_is_loading"),"success"===c&&f.correct_state&&this.correct_state(b)):"success"===c&&f.correct_state&&this.get_container().children("ul").empty(),d&&d.call(this)},h=function(d,e,h){var i=this.get_settings().html_data.ajax.success;return i&&(d=i.call(this,d,e,h)||d),""===d||d&&d.toString&&""===d.toString().replace(/^[\s\n]+$/,"")?g.call(this,h,e,""):void(d?(d=a(d),d.is("ul")||(d=a("<ul />").append(d)),-1!=b&&b?(b.children("a.jstree-loading").removeClass("jstree-loading"),b.append(d).children("ul").find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),b.removeData("jstree_is_loading")):this.get_container().children("ul").empty().append(d.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),this.clean_node(b),c&&c.call(this)):b&&-1!==b?(b.children("a.jstree-loading").removeClass("jstree-loading"),b.removeData("jstree_is_loading"),f.correct_state&&(this.correct_state(b),c&&c.call(this))):f.correct_state&&(this.get_container().children("ul").empty(),c&&c.call(this)))},f.ajax.context=this,f.ajax.error=g,f.ajax.success=h,f.ajax.dataType||(f.ajax.dataType="html"),a.isFunction(f.ajax.url)&&(f.ajax.url=f.ajax.url.call(this,b)),a.isFunction(f.ajax.data)&&(f.ajax.data=f.ajax.data.call(this,b)),a.ajax(f.ajax)}}}}),a.jstree.defaults.plugins.push("html_data")}(jQuery),function(a){a.jstree.plugin("themeroller",{__init:function(){var b=this._get_settings().themeroller;this.get_container().addClass("ui-widget-content").addClass("jstree-themeroller").delegate("a","mouseenter.jstree",function(c){a(c.currentTarget).hasClass("jstree-loading")||a(this).addClass(b.item_h)}).delegate("a","mouseleave.jstree",function(){a(this).removeClass(b.item_h)}).bind("init.jstree",a.proxy(function(a,b){b.inst.get_container().find("> ul > li > .jstree-loading > ins").addClass("ui-icon-refresh"),this._themeroller(b.inst.get_container().find("> ul > li"))},this)).bind("open_node.jstree create_node.jstree",a.proxy(function(a,b){this._themeroller(b.rslt.obj)},this)).bind("loaded.jstree refresh.jstree",a.proxy(function(){this._themeroller()},this)).bind("close_node.jstree",a.proxy(function(a,b){this._themeroller(b.rslt.obj)},this)).bind("delete_node.jstree",a.proxy(function(a,b){this._themeroller(b.rslt.parent)},this)).bind("correct_state.jstree",a.proxy(function(a,c){c.rslt.obj.children("ins.jstree-icon").removeClass(b.opened+" "+b.closed+" ui-icon").end().find("> a > ins.ui-icon").filter(function(){return-1===this.className.toString().replace(b.item_clsd,"").replace(b.item_open,"").replace(b.item_leaf,"").indexOf("ui-icon-")}).removeClass(b.item_open+" "+b.item_clsd).addClass(b.item_leaf||"jstree-no-icon")},this)).bind("select_node.jstree",a.proxy(function(a,c){c.rslt.obj.children("a").addClass(b.item_a)},this)).bind("deselect_node.jstree deselect_all.jstree",a.proxy(function(){this.get_container().find("a."+b.item_a).removeClass(b.item_a).end().find("a.jstree-clicked").addClass(b.item_a)},this)).bind("dehover_node.jstree",a.proxy(function(a,c){c.rslt.obj.children("a").removeClass(b.item_h)},this)).bind("hover_node.jstree",a.proxy(function(a,c){this.get_container().find("a."+b.item_h).not(c.rslt.obj).removeClass(b.item_h),c.rslt.obj.children("a").addClass(b.item_h)},this)).bind("move_node.jstree",a.proxy(function(a,b){this._themeroller(b.rslt.o),this._themeroller(b.rslt.op)},this))},__destroy:function(){var b=this._get_settings().themeroller,c=["ui-icon"];a.each(b,function(a,b){b=b.split(" "),b.length&&(c=c.concat(b))}),this.get_container().removeClass("ui-widget-content").find("."+c.join(", .")).removeClass(c.join(" "))},_fn:{_themeroller:function(a){var b=this._get_settings().themeroller;a=a&&-1!=a?this._get_node(a):this.get_container_ul(),a=a&&-1!=a?a.parent():this.get_container_ul(),a.find("li.jstree-closed").children("ins.jstree-icon").removeClass(b.opened).addClass("ui-icon "+b.closed).end().children("a").addClass(b.item).children("ins.jstree-icon").addClass("ui-icon").filter(function(){return-1===this.className.toString().replace(b.item_clsd,"").replace(b.item_open,"").replace(b.item_leaf,"").indexOf("ui-icon-")}).removeClass(b.item_leaf+" "+b.item_open).addClass(b.item_clsd||"jstree-no-icon").end().end().end().end().find("li.jstree-open").children("ins.jstree-icon").removeClass(b.closed).addClass("ui-icon "+b.opened).end().children("a").addClass(b.item).children("ins.jstree-icon").addClass("ui-icon").filter(function(){return-1===this.className.toString().replace(b.item_clsd,"").replace(b.item_open,"").replace(b.item_leaf,"").indexOf("ui-icon-")}).removeClass(b.item_leaf+" "+b.item_clsd).addClass(b.item_open||"jstree-no-icon").end().end().end().end().find("li.jstree-leaf").children("ins.jstree-icon").removeClass(b.closed+" ui-icon "+b.opened).end().children("a").addClass(b.item).children("ins.jstree-icon").addClass("ui-icon").filter(function(){return-1===this.className.toString().replace(b.item_clsd,"").replace(b.item_open,"").replace(b.item_leaf,"").indexOf("ui-icon-")}).removeClass(b.item_clsd+" "+b.item_open).addClass(b.item_leaf||"jstree-no-icon")}},defaults:{opened:"ui-icon-triangle-1-se",closed:"ui-icon-triangle-1-e",item:"ui-state-default",item_h:"ui-state-hover",item_a:"ui-state-active",item_open:"ui-icon-folder-open",item_clsd:"ui-icon-folder-collapsed",item_leaf:"ui-icon-document"}}),a(function(){var b=".jstree-themeroller .ui-icon { overflow:visible; } .jstree-themeroller a { padding:0 2px; } .jstree-themeroller .jstree-no-icon { display:none; }";a.vakata.css.add_sheet({str:b,title:"jstree"})})}(jQuery),function(a){a.jstree.plugin("unique",{__init:function(){this.get_container().bind("before.jstree",a.proxy(function(b,c){var d,e,f=[],g=!0;return"move_node"==c.func&&c.args[4]===!0&&c.args[0].o&&c.args[0].o.length&&(c.args[0].o.children("a").each(function(){f.push(a(this).text().replace(/^\s+/g,""))}),g=this._check_unique(f,c.args[0].np.find("> ul > li").not(c.args[0].o),"move_node")),"create_node"==c.func&&(c.args[4]||this._is_loaded(c.args[0]))&&(d=this._get_node(c.args[0]),!c.args[1]||"before"!==c.args[1]&&"after"!==c.args[1]||(d=this._get_parent(c.args[0]),d&&-1!==d||(d=this.get_container())),f.push("string"==typeof c.args[2]?c.args[2]:c.args[2]&&c.args[2].data?c.args[2].data:this._get_string("new_node")),g=this._check_unique(f,d.find("> ul > li"),"create_node")),"rename_node"==c.func&&(f.push(c.args[1]),e=this._get_node(c.args[0]),d=this._get_parent(e),d&&-1!==d||(d=this.get_container()),g=this._check_unique(f,d.find("> ul > li").not(e),"rename_node")),g?void 0:(b.stopPropagation(),!1)},this))},defaults:{error_callback:a.noop},_fn:{_check_unique:function(b,c,d){var e=[],f=!0;return c.children("a").each(function(){e.push(a(this).text().replace(/^\s+/g,""))}),e.length&&b.length?(a.each(b,function(b,c){return-1!==a.inArray(c,e)?(f=!1,!1):void 0}),f||this._get_settings().unique.error_callback.call(null,b,c,d),f):!0},check_move:function(){if(!this.__call_old())return!1;var b=this._get_move(),c=[];return b.o&&b.o.length?(b.o.children("a").each(function(){c.push(a(this).text().replace(/^\s+/g,""))}),this._check_unique(c,b.np.find("> ul > li").not(b.o),"check_move")):!0}}})}(jQuery),function(d){d.jstree.plugin("wholerow",{__init:function(){if(!this.data.ui)throw"jsTree wholerow: jsTree UI plugin not included.";this.data.wholerow.html=!1,this.data.wholerow.to=!1,this.get_container().bind("init.jstree",d.proxy(function(){this._get_settings().core.animation=0},this)).bind("open_node.jstree create_node.jstree clean_node.jstree loaded.jstree",d.proxy(function(a,b){this._prepare_wholerow_span(b&&b.rslt&&b.rslt.obj?b.rslt.obj:-1)},this)).bind("search.jstree clear_search.jstree reopen.jstree after_open.jstree after_close.jstree create_node.jstree delete_node.jstree clean_node.jstree",d.proxy(function(a,b){this.data.to&&clearTimeout(this.data.to),this.data.to=setTimeout(function(a,b){return function(){a._prepare_wholerow_ul(b)}}(this,b&&b.rslt&&b.rslt.obj?b.rslt.obj:-1),0)},this)).bind("deselect_all.jstree",d.proxy(function(){this.get_container().find(" > .jstree-wholerow .jstree-clicked").removeClass("jstree-clicked "+(this.data.themeroller?this._get_settings().themeroller.item_a:""))},this)).bind("select_node.jstree deselect_node.jstree ",d.proxy(function(a,b){b.rslt.obj.each(function(){var a=b.inst.get_container().find(" > .jstree-wholerow li:visible:eq("+parseInt((d(this).offset().top-b.inst.get_container().offset().top+b.inst.get_container()[0].scrollTop)/b.inst.data.core.li_height,10)+")");a.children("a").attr("class",b.rslt.obj.children("a").attr("class"))})},this)).bind("hover_node.jstree dehover_node.jstree",d.proxy(function(a,b){if(this.get_container().find(" > .jstree-wholerow .jstree-hovered").removeClass("jstree-hovered "+(this.data.themeroller?this._get_settings().themeroller.item_h:"")),"hover_node"===a.type){var c=this.get_container().find(" > .jstree-wholerow li:visible:eq("+parseInt((b.rslt.obj.offset().top-this.get_container().offset().top+this.get_container()[0].scrollTop)/this.data.core.li_height,10)+")");c.children("a").attr("class",b.rslt.obj.children(".jstree-hovered").attr("class"))}},this)).delegate(".jstree-wholerow-span, ins.jstree-icon, li","click.jstree",function(a){var b=d(a.currentTarget);"A"===a.target.tagName||"INS"===a.target.tagName&&b.closest("li").is(".jstree-open, .jstree-closed")||(b.closest("li").children("a:visible:eq(0)").click(),a.stopImmediatePropagation())}).delegate("li","mouseover.jstree",d.proxy(function(a){return a.stopImmediatePropagation(),d(a.currentTarget).children(".jstree-hovered, .jstree-clicked").length?!1:(this.hover_node(a.currentTarget),!1)},this)).delegate("li","mouseleave.jstree",d.proxy(function(a){d(a.currentTarget).children("a").hasClass("jstree-hovered").length||this.dehover_node(a.currentTarget)},this)),(b||a)&&d.vakata.css.add_sheet({str:".jstree-"+this.get_index()+" { position:relative; } ",title:"jstree"})},defaults:{},__destroy:function(){this.get_container().children(".jstree-wholerow").remove(),this.get_container().find(".jstree-wholerow-span").remove()},_fn:{_prepare_wholerow_span:function(a){a=a&&-1!=a?this._get_node(a):this.get_container().find("> ul > li"),a!==!1&&a.each(function(){d(this).find("li").andSelf().each(function(){var a=d(this);return a.children(".jstree-wholerow-span").length?!0:void a.prepend("<span class='jstree-wholerow-span' style='width:"+18*a.parentsUntil(".jstree","li").length+"px;'>&#160;</span>")})})},_prepare_wholerow_ul:function(){var a=this.get_container().children("ul").eq(0),c=a.html();a.addClass("jstree-wholerow-real"),this.data.wholerow.last_html!==c&&(this.data.wholerow.last_html=c,this.get_container().children(".jstree-wholerow").remove(),this.get_container().append(a.clone().removeClass("jstree-wholerow-real").wrapAll("<div class='jstree-wholerow' />").parent().width(a.parent()[0].scrollWidth).css("top",-1*(a.height()+(b?5:0))).find("li[id]").each(function(){this.removeAttribute("id")}).end()))}}}),d(function(){var e=".jstree .jstree-wholerow-real { position:relative; z-index:1; } .jstree .jstree-wholerow-real li { cursor:pointer; } .jstree .jstree-wholerow-real a { border-left-color:transparent !important; border-right-color:transparent !important; } .jstree .jstree-wholerow { position:relative; z-index:0; height:0; } .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li { width:100%; } .jstree .jstree-wholerow, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li, .jstree .jstree-wholerow a { margin:0 !important; padding:0 !important; } .jstree .jstree-wholerow, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li { background:transparent !important; }.jstree .jstree-wholerow ins, .jstree .jstree-wholerow span, .jstree .jstree-wholerow input { display:none !important; }.jstree .jstree-wholerow a, .jstree .jstree-wholerow a:hover { text-indent:-9999px; !important; width:100%; padding:0 !important; border-right-width:0px !important; border-left-width:0px !important; } .jstree .jstree-wholerow-span { position:absolute; left:0; margin:0px; padding:0; height:18px; border-width:0; padding:0; z-index:0; }";c&&(e+=".jstree .jstree-wholerow a { display:block; height:18px; margin:0; padding:0; border:0; } .jstree .jstree-wholerow-real a { border-color:transparent !important; } "),(b||a)&&(e+=".jstree .jstree-wholerow, .jstree .jstree-wholerow li, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow a { margin:0; padding:0; line-height:18px; } .jstree .jstree-wholerow a { display:block; height:18px; line-height:18px; overflow:hidden; } "),d.vakata.css.add_sheet({str:e,title:"jstree"})})}(jQuery),function(a){var b=["getChildren","getChildrenCount","getAttr","getName","getProps"],c=function(b,c){var d=!0;return b=b||{},c=[].concat(c),a.each(c,function(c,e){return a.isFunction(b[e])?void 0:(d=!1,!1)}),d};a.jstree.plugin("model",{__init:function(){if(!this.data.json_data)throw"jsTree model: jsTree json_data plugin not included.";this._get_settings().json_data.data=function(d,e){var f=-1==d?this._get_settings().model.object:d.data("jstree_model");return c(f,b)?void(this._get_settings().model.async?f.getChildren(a.proxy(function(a){this.model_done(a,e)},this)):this.model_done(f.getChildren(),e)):e.call(null,!1)}},defaults:{object:!1,id_prefix:!1,async:!1},_fn:{model_done:function(b,c){var d=[],e=this._get_settings(),f=this;a.isArray(b)||(b=[b]),a.each(b,function(b,c){var g=c.getProps()||{};g.attr=c.getAttr()||{},c.getChildrenCount()&&(g.state="closed"),g.data=c.getName(),a.isArray(g.data)||(g.data=[g.data]),f.data.types&&a.isFunction(c.getType)&&(g.attr[e.types.type_attr]=c.getType()),g.attr.id&&e.model.id_prefix&&(g.attr.id=e.model.id_prefix+g.attr.id),g.metadata||(g.metadata={}),g.metadata.jstree_model=c,d.push(g)}),c.call(null,d)}}})}(jQuery)}}(),function(){var a,b,c;return function(d){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m=b&&b.split("/"),n=s.map,o=n&&n["*"]||{};if(a&&"."===a.charAt(0))if(b){for(m=m.slice(0,m.length-1),a=m.concat(a.split("/")),j=0;j<a.length;j+=1)if(l=a[j],"."===l)a.splice(j,1),j-=1;else if(".."===l){if(1===j&&(".."===a[2]||".."===a[0]))break;j>0&&(a.splice(j-1,2),j-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((m||o)&&n){for(c=a.split("/"),j=c.length;j>0;j-=1){if(d=c.slice(0,j).join("/"),m)for(k=m.length;k>0;k-=1)if(e=n[m.slice(0,k).join("/")],e&&(e=e[d])){f=e,g=j;break}if(f)break;!h&&o&&o[d]&&(h=o[d],i=j)}!f&&h&&(f=h,g=i),f&&(c.splice(0,g,f),a=c.join("/"))}return a}function g(a,b){return function(){return n.apply(d,v.call(arguments,0).concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var b=r[a];delete r[a],t[a]=!0,m.apply(d,b)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,b,c,f){var h,k,l,m,n,s,u=[];if(f=f||a,"function"==typeof c){for(b=!b.length&&c.length?["require","exports","module"]:b,n=0;n<b.length;n+=1)if(m=o(b[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=c.apply(q[a],u),a&&(h&&h.exports!==d&&h.exports!==q[a]?q[a]=h.exports:l===d&&s||(q[a]=l))}else a&&(q[a]=c)},a=b=n=function(a,b,c,e,f){return"string"==typeof a?p[a]?p[a](b):j(o(a,b).f):(a.splice||(s=a,b.splice?(a=b,b=c,c=null):a=d),b=b||function(){},"function"==typeof c&&(c=e,e=f),e?m(d,a,b,c):setTimeout(function(){m(d,a,b,c)},4),n)},n.config=function(a){return s=a,s.deps&&n(s.deps,s.callback),n},c=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},c.amd={jQuery:!0}}(),c("vendor/almond",function(){}),function(){c("jquery",["require"],function(){var a;return a||(a=window.jQuery),a})}.call(this),c("text",["module"],function(a){var c,d,e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],f=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,g=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,h="undefined"!=typeof location&&location.href,i=h&&location.protocol&&location.protocol.replace(/\:/,""),j=h&&location.hostname,k=h&&(location.port||void 0),l=[],m=a.config&&a.config()||{};return c={version:"2.0.3",strip:function(a){if(a){a=a.replace(f,"");var b=a.match(g);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:m.createXhr||function(){var a,b,c;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(b=0;3>b;b+=1){c=e[b];try{a=new ActiveXObject(c)}catch(d){}if(a){e=[c];break}}return a},parseName:function(a){var b=!1,c=a.indexOf("."),d=a.substring(0,c),e=a.substring(c+1,a.length);return c=e.indexOf("!"),-1!==c&&(b=e.substring(c+1,e.length),b="strip"===b,e=e.substring(0,c)),{moduleName:d,ext:e,strip:b}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,b,d,e){var f,g,h,i=c.xdRegExp.exec(a);return i?(f=i[2],g=i[3],g=g.split(":"),h=g[1],g=g[0],!(f&&f!==b||g&&g.toLowerCase()!==d.toLowerCase()||(h||g)&&h!==e)):!0},finishLoad:function(a,b,d,e){d=b?c.strip(d):d,m.isBuild&&(l[a]=d),e(d)},load:function(a,b,d,e){if(e.isBuild&&!e.inlineText)return void d();m.isBuild=e.isBuild;var f=c.parseName(a),g=f.moduleName+"."+f.ext,l=b.toUrl(g),n=m.useXhr||c.useXhr;!h||n(l,i,j,k)?c.get(l,function(b){c.finishLoad(a,f.strip,b,d)},function(a){d.error&&d.error(a)}):b([g],function(a){c.finishLoad(f.moduleName+"."+f.ext,f.strip,a,d)})},write:function(a,b,d){if(l.hasOwnProperty(b)){var e=c.jsEscape(l[b]);d.asModule(a+"!"+b,"define(function () { return '"+e+"';});\n")}},writeFile:function(a,b,d,e,f){var g=c.parseName(b),h=g.moduleName+"."+g.ext,i=d.toUrl(g.moduleName+"."+g.ext)+".js";c.load(h,d,function(){var b=function(a){return e(i,a)};b.asModule=function(a,b){return e.asModule(a,i,b)},c.write(a,h,b,f)},f)}},"node"===m.env||!m.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(d=b.nodeRequire("fs"),c.get=function(a,b){var c=d.readFileSync(a,"utf8");0===c.indexOf("")&&(c=c.substring(1)),b(c)}):"xhr"===m.env||!m.env&&c.createXhr()?c.get=function(a,b,d){var e=c.createXhr();e.open("GET",a,!0),m.onXhr&&m.onXhr(e,a),e.onreadystatechange=function(){var c,f;4===e.readyState&&(c=e.status,c>399&&600>c?(f=new Error(a+" HTTP status: "+c),f.xhr=e,d(f)):b(e.responseText))},e.send(null)}:("rhino"===m.env||!m.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java)&&(c.get=function(a,b){var c,d,e="utf-8",f=new java.io.File(a),g=java.lang.System.getProperty("line.separator"),h=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(f),e)),i="";try{for(c=new java.lang.StringBuffer,d=h.readLine(),d&&d.length()&&65279===d.charAt(0)&&(d=d.substring(1)),c.append(d);null!==(d=h.readLine());)c.append(g),c.append(d);i=String(c.toString())}finally{h.close()}b(i)}),c}),c("text!plugin.css",[],function(){return'body{font-size:75%;color:#333;line-height:1.5em}div[data-xmlel]{margin:3px 0}div[data-xmlel]:before{background-color:#444;color:#ccc;content:attr(data-xmlel);font-size:80%;font-weight:bold;margin:0 4px;padding:2px 4px;text-transform:capitalize}div[data-xmlel="article"]:before,div[data-xmlel="front"]:before{display:none}div[data-xmlel="front"],div[data-xmlel="back"]{background-color:#f0f0f0;padding:.5em}div[data-xmlel="journal-meta"]{background-color:#99d1dd;border:1px solid #444;margin:0 0 6px}div[data-xmlel="journal-meta"]:before{content:"Journal Meta";display:block;margin:0 0 5px;padding:2px 5px}div[data-xmlel="journal-id"]{display:inline-block !important;font-size:80%}div[data-xmlel="journal-id"]:before{font-size:inherit;background-color:inherit;color:inherit;content:"JID: "}div[data-xmlel="journal-title-group"]:before{display:none}div[data-xmlel="journal-title"]:before{background:transparent;content:""}div[data-xmlel="journal-title"]{font-weight:bold}div[data-xmlel="journal-title"]:before{color:#333;content:"Journal Title:";font-size:inherit;font-weight:bold}div[data-xmlel="issn"]{display:inline-block !important;font-size:80%}div[data-xmlel="issn"]:before{font-size:inherit;content:"ISSN:";background-color:inherit;color:inherit;display:inline}div[data-xmlel="publisher"]:before{background-color:inherit;font-size:inherit;color:#333;content:"Published:"}div[data-xmlel^="publisher-"]:before{display:none}div[data-xmlel^="publisher-"]{display:inline}div[data-xmlel="publisher-name"]:before{content:"by";font-weight:normal}div[data-xmlel="publisher-loc"]:before{content:"at"}div[data-xmlel="article-meta"]{background-color:#99d1dd;border:1px solid #444}div[data-xmlel="article-meta"]:before{display:block;content:"Article Meta";margin:0;padding:2px 5px}div[data-xmlel="article-id"]{display:inline-block !important;font-size:80%}div[data-xmlel="article-id"]:before{background:none;color:#333;content:"Article ID:";margin-left:0}div[data-xmlel="article-categories"]:before{content:"Article Categories"}div[data-xmlel="contrib-group"]:before{content:"Contributors"}div[data-xmlel="subject"],div[data-xmlel="article-title"]{border:1px dotted 1px dotted #ddf556}div[data-xmlel="subject"]:before,div[data-xmlel="article-title"]:before{background:none;color:#333;content:"Subject:";font-size:inherit;font-weight:bold;margin-left:0}div[data-xmlel="article-title"]:before{content:"Article Title:"}div[data-xmlel="title-group"]:before,div[data-xmlel="contrib"]:before,div[data-xmlel="subj-group"]:before{display:none}div[data-xmlel="name"]:before{display:none}div[data-xmlel="surname"],div[data-xmlel="given-names"],div[data-xmlel="day"],div[data-xmlel="month"],div[data-xmlel="year"]{display:inline}div[data-xmlel="surname"]:before,div[data-xmlel="given-names"]:before,div[data-xmlel="author-comment"]:before,div[data-xmlel="day"]:before,div[data-xmlel="month"]:before,div[data-xmlel="year"]:before,div[data-xmlel="copyright-statement"]:before,div[data-xmlel="copyright-year"]:before,div[data-xmlel="license"]:before{background:none;color:#333;content:"Last Name:";font-size:inherit;font-weight:bold;margin-left:0}div[data-xmlel="given-names"]:before{content:"First Name:";padding-left:10px}div[data-xmlel="aff"]{font-size:80%;padding-left:10px}div[data-xmlel="aff"]:before{display:none}div[data-xmlel="author-comment"]{border-bottom:1px dashed #333;padding-bottom:4px;padding-left:4px}div[data-xmlel="author-comment"]:before{content:"Author Comment:";display:inline;padding:2px 4px 2px 0}div[data-xmlel="author-comment"] .p{display:inline;padding:0}div[pub-type="epub"][data-xmlel="pub-date"]:before{content:"E-Pub"}div[pub-type="ppub"][data-xmlel="pub-date"]:before{content:"Print Publication"}div[data-xmlel="day"]:before{content:"Day:"}div[data-xmlel="month"]:before{content:"Month:"}div[data-xmlel="year"]:before{content:"Year:"}div[pub-type="collection"][data-xmlel="pub-date"]:before{content:"Collection"}div[data-xmlel="copyright-statement"]:before{content:"Copyright:"}div[data-xmlel="copyright-year"]:before{content:"Copyright Year:"}div[data-xmlel="license"]{padding-left:4px}div[data-xmlel="license"]:before{content:"License:";padding:0}div[data-xmlel="license-p"]{display:inline}div[data-xmlel="license-p"]:before{display:none}div[data-xmlel="permissions"],div[data-xmlel="abstract"],div[data-xmlel="kwd-group"]{border-top:1px dashed #333;padding-top:4px}div[data-xmlel="date"]{padding-left:10px}div[date-type="received"][data-xmlel="date"]:before{content:"Date Received"}div[date-type="rev-recd"][data-xmlel="date"]:before{content:"Date Revisions Received"}div[date-type="accepted"][data-xmlel="date"]:before{content:"Date Accepted"}div[data-xmlel="kwd-group"]:before{content:"Keywords"}div[data-xmlel="permissions"]{padding-top:4px}div[data-xmlel="abstract"]:before{content:"Abstract:"}div[data-xmlel="kwd-group"]:before{content:"Keywords"}div[data-xmlel="kwd"]{display:inline}div[data-xmlel="kwd"]:before{display:none}div[data-xmlel="kwd"]:after{content:","}div[data-xmlel="kwd"]:last-child:after{display:none}div[data-xmlel="body"]{margin-top:20px}div[data-xmlel="body"]:before,div[data-xmlel="sec"]:before,div[data-xmlel="p"]:before,div[data-xmlel="title"]:before{display:none}div[data-xmlel="article"]:before,div[data-xmlel="front"]:before{background:#999;color:#f0f0f0}div[data-xmlel="title"]{background:#99d1dd;color:#444;font-weight:bold;margin-bottom:6px;padding:1px 4px 0}div[data-xmlel="p"]{margin-bottom:10px;padding:0 4px}div[data-xmlel="sec"]{margin-bottom:20px}div[data-xmlel="xref"]{color:#006b94;font-weight:bold}[ref-type="bibr"]{font-size:70%;line-height:12px;vertical-align:top}div[data-xmlel="sup"]{font-size:70%;line-height:12px;vertical-align:super}div[data-xmlel="sub"]{font-size:70%;line-height:12px;vertical-align:bottom}span[data-xmlel="bold"]:before,span[data-xmlel="underline"]:before,span[data-xmlel="monospace"]:before,span[data-xmlel="italic"]:before{display:none}span[data-xmlel="bold"]{display:inline;font-weight:bold}span[data-xmlel="sup"]{display:inline;vertical-align:super;font-size:x-small}span[data-xmlel="sub"]{display:inline;vertical-align:sub;font-size:x-small}span[data-xmlel="monospace"]{display:inline;font-family:monospace}span[data-xmlel="underline"]{display:inline;text-decoration:underline}span[data-xmlel="italic"]{display:inline;font-style:italic}div[data-xmlel="preformat"]{display:inline;font-style:monospace;white-space:pre}div[data-xmlel="list"]{padding-left:10px;display:block;list-style-position:inside;counter-reset:item}div[data-xmlel="list-item"]{clear:both;padding-left:15px}div[data-xmlel="list"]:before,div[data-xmlel="list-item"]:before{display:none}div[data-xmlel="list-item"]:before{display:block;float:left;margin-right:3px}div[data-xmlel="list"] div[data-xmlel="list-item"]{counter-increment:item;display:list-item;list-style-type:disc}div[data-xmlel="list"][list-type="order"] div[data-xmlel="list-item"]:before{color:inherit;content:counter(item,decimal) ". ";background-color:inherit}div[data-xmlel="list"][list-type="order"] div[data-xmlel="list-item"]{list-style-type:none}th{background:#006b94;color:#f0f0f0;font-size:70%;padding:5px}td{font-size:70%;padding:3px}.mceItemTable,.mceItemTable td,.mceItemTable th,.mceItemTable caption,.mceItemVisualAid{border:1px solid #f0f0f0}div[data-xmlel="table-wrap"]:before,div[data-xmlel="table-wrap-foot"]:before,div[data-xmlel="caption"]:before{display:none}div[data-xmlel="label"]{font-weight:bold;padding:0 4px}div[data-xmlel="table"]{margin-bottom:10px}div[data-xmlel="fig"]:before{display:none}div[data-xmlel="fig"]{padding-bottom:30px}div[data-xmlel="ref"] div[data-xmlel="label"],div[data-xmlel="ref"] div[data-xmlel="mixed-citation"],div[data-xmlel="ref"] div[data-xmlel="pub-id"]{display:inline}div[data-xmlel="back"]:before,div[data-xmlel="ack"]:before,div[data-xmlel="ref-list"]:before,div[data-xmlel="ref"]:before,div[data-xmlel="label"]:before,div[data-xmlel="mixed-citation"]:before{display:none}div[data-xmlel="ref-list"]{margin-bottom:20px}div[data-xmlel="ref"]{border-bottom:1px dashed #333;padding:5px 0}div[data-xmlel="ref"] div[data-xmlel="label"]{font-weight:bold;margin-left:0;margin-right:6px}div[data-xmlel="pub-id"]:before{background:none;color:#333;content:"Pub ID:";font-size:inherit;font-weight:bold;margin-left:0}div[data-xmlel="p"] span[data-xmlel="bold"]:first-child{margin-right:6px}div[data-xmlel="journal-title"]:hover,div[data-xmlel="journal-id"]:hover,div[data-xmlel="issn"]:hover,div[data-xmlel^="publisher-"]:hover,div[data-xmlel="article-id"]:hover,div[data-xmlel="subject"]:hover,div[data-xmlel="article-title"]:hover,div[data-xmlel="surname"]:hover,div[data-xmlel="given-names"]:hover,div[data-xmlel="day"]:hover,div[data-xmlel="month"]:hover,div[data-xmlel="year"]:hover,div[data-xmlel="aff"]:hover,div[data-xmlel="volume"]:hover,div[data-xmlel="issue"]:hover,div[data-xmlel="author-comment"]:hover .p,div[data-xmlel="copyright-statement"]:hover,div[data-xmlel="copyright-year"]:hover,div[data-xmlel="license"]:hover div[data-xmlel="license-p"],div[data-xmlel="abstract"]:hover .p,div[data-xmlel="kwd"]:hover{outline:1px dotted #ddf556}div[data-xmlel="sec"] div[data-xmlel="p"]:hover,div[data-xmlel="mixed-citation"]:hover,div[data-xmlel="label"]:hover{background:#f0f0f0;outline:1px dotted #589dac}div[data-xmlel="mixed-citation"] div[data-xmlel="pub-id"]:hover{background:#ccc}div[data-xmlel="sec"] div[data-xmlel="p"] span[data-xmlel="xref"]:hover{background:#006b94;color:#f0f0f0}\n/*# sourceMappingURL=plugin.css.map */\n'
}),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},b=function(a,b){return function(){return a.apply(b,arguments)}};c("textorum/helper",["require"],function(){var c,d,e,f;return f=function(b,c){return c===b||null!=b[c]||a.call(b,c)>=0},d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},c=function(){function a(){this.isNodeWhitespace=b(this.isNodeWhitespace,this),this.getNamespacePrefix=b(this.getNamespacePrefix,this)}return a.prototype.ELEMENT_NODE=1,a.prototype.ATTRIBUTE_NODE=2,a.prototype.TEXT_NODE=3,a.prototype.CDATA_SECTION_NODE=4,a.prototype.ENTITY_REFERENCE_NODE=5,a.prototype.ENTITY_NODE=6,a.prototype.PROCESSING_INSTRUCTION_NODE=7,a.prototype.COMMENT_NODE=8,a.prototype.DOCUMENT_NODE=9,a.prototype.DOCUMENT_TYPE_NODE=10,a.prototype.DOCUMENT_FRAGMENT_NODE=11,a.prototype.NOTATION_NODE=12,a.prototype.clone=function(a){var b,c,d;if(null==a||"object"!=typeof a)return a;if(a instanceof RegExp)return b="",null!=a.global&&(b+="g"),null!=a.ignoreCase&&(b+="i"),null!=a.multiline&&(b+="m"),null!=a.sticky&&(b+="y"),new RegExp(a.source,b);if(a instanceof Date)return new Date(a.getTime());d=new a.constructor;for(c in a)d[c]=clone(a[c]);return d},a.prototype.getFirstChildElement=function(a,b){for(a=a.firstChild;a&&a.nodeType!==this.ELEMENT_NODE;)a=a.nextSibling;return a&&b&&(b=b.toLowerCase(),a.tagName&&a.tagName.toLowerCase()!==b&&(a=this.getNextSiblingElement(a,b))),a},a.prototype.followPath=function(a,b){for(var c,d,e,f,g,h,i,j,k;a.length;){for(h=a.shift(),d=0,k=b.childNodes,i=0,j=k.length;j>i;i++)if(c=k[i],c.nodeType===this.ELEMENT_NODE&&(f=this.getQname(c.nodeName).local===h.local,g=null==c.namespaceURI||c.namespaceURI===h.nsuri,e=d===h.index,f&&g)){if(e){b=c;break}d+=1}if(b!==c)return!1}return b},a.prototype.followTextorumPath=function(a,b){for(var c,d,e,f,g,h,i,j,k,l,m,n,o,p;j=a.shift();){for(e=0,d=[],o=b.childNodes,k=0,m=o.length;m>k;k++)c=o[k],d.push(c);for(;c=d.shift();)if(c.nodeType===this.ELEMENT_NODE)if(null!=c.hasAttribute&&c.hasAttribute("data-xmlel")){if(h=c.attributes["data-xmlel"].value.toLowerCase()===j.local.toLowerCase(),i=null==j.nsuri,i=i||null==c.hasAttribute["data-nsuribk"],i=i||c.attributes["data-nsuribk"].value===j.nsuri,g=e===j.index,h&&i){if(g){b=c;break}e+=1}}else for(p=c.childNodes,l=0,n=p.length;n>l;l++)f=p[l],d.push(f);if(b!==c)break}return b},a.prototype.pathForNode=function(a,b){for(var c,d,e,f,g;null!=a.ownerElement;)a=a.ownerElement;for(e=[];d=a.parentNode&&d!==b;){if(c=0,a.previousSibling)for(g=a.previousSibling;g;)g.nodeType===this.ELEMENT_NODE&&g.nodeName===a.nodeName&&(c+=1),g=g.previousSibling;f=this.getQname(a.nodeName),e.unshift({local:f.local,nsuri:a.namespaceURI,index:c}),a=d}return e},a.prototype.getChildNodes=function(a){var b,c,d,e,f,g,h,i,j,k;if(a.hasAttribute&&a.hasAttribute("data-xmlel")){for(c=[],e=[],j=a.childNodes,f=0,h=j.length;h>f;f++)b=j[f],e.push(b);for(;b=e.shift();)if(b.hasAttribute&&b.hasAttribute("data-xmlel"))c.push(b);else if(b.childNodes&&b.childNodes.length)for(k=b.childNodes,g=0,i=k.length;i>g;g++)d=k[g],e.unshift(d);return c}return a.childNodes},a.prototype.getNextSiblingElement=function(a,b){for(a=a.nextSibling;a&&a.nodeType!==this.ELEMENT_NODE;)a=a.nextSibling;if(b)for(b=b.toLowerCase();a&&a.tagName&&a.tagName.toLowerCase()!==b;)a=a.nextSibling;return a},a.prototype.depth=function(a){var b,c;for(b=0;a.parentElement&&a!==c;)c=a,b+=1,a=a.parentElement;return b},a.prototype.getChildByName=function(a,b,c){var d,e,g,h,i,j;for(j=a.childNodes,h=0,i=j.length;i>h;h++)if(d=j[h],e=f(b,this.getLocalName(d)),g=null==d.namespaceURI||d.namespaceURI===c,e&&g)return d;return null},a.prototype.getChildrenByName=function(a,b,c){var d,e,g,h,i,j,k;for(e=[],k=a.childNodes,i=0,j=k.length;j>i;i++)d=k[i],g=f(b,this.getLocalName(d)),h=null==d.namespaceURI||d.namespaceURI===c,g&&h&&e.push(d);return e},a.prototype.getQname=function(a){var b,c,d,e;return a=""+a,b=a.indexOf(":"),e=0>b?["",a]:a.split(":"),d=e[0],c=e[1],"xmlns"===a&&(d="xmlns",c=""),{prefix:d,local:c}},a.prototype.getNamespacePrefix=function(a){return null==a?"":this.getQname(a).prefix},a.prototype.escapeHtml=function(a){return String(a).replace(/[&<>"'\/]/g,function(a){return d[a]})},a.prototype.getNodeAttr=function(a,b){var c,d,e;if(c=this.getNodeAttributes(a),void 0!==(null!=(e=c[b])?e.value:void 0))return c[b].value;if(void 0!==c[b])return c[b];for(d=c.length;d--;)if(c[d].name===b)return c[d].value;return void 0},a.prototype.getNodeAttributes=function(a){var b,c,d,e,f,g;if(null!=a.hasAttribute&&a.hasAttribute("data-xmlel")){for(e=a.attributes.length-1,d=[],c=g=0;e>=0?e>=g:g>=e;c=e>=0?++g:--g)switch(b=a.attributes[c],b.name){case"data-xmlel":case"data-nsbk":case"data-nsuribk":continue;case"data-clsbk":f=document.createAttribute("class"),f.value=b.value,d[c]=f;break;case"class":continue;default:if("tmp_tree_"===b.value.substr(0,9))continue;d[c]=b}return d}return null!=a.attributes?a.attributes:[]},a.prototype.getNodeType=function(a){switch(!0){case null!=(null!=a?a.nodeType:void 0):return a.nodeType;case"string"==typeof a:return Node.TEXT_NODE;default:return void 0}},a.prototype.isNodeWhitespace=function(a){return this.getNodeType(a)===Node.TEXT_NODE&&""===this.textContent(a).replace(/^\s+|\s+$/gm,"")?!0:!1},a.prototype.getLocalName=function(a){return void 0===a?"":void 0!==a._localNameCache?a._localNameCache:"string"==typeof a?this.getQname(a).local:null!=a.hasAttribute&&a.hasAttribute("data-xmlel")?a._localNameCache=a.attributes["data-xmlel"].value:void 0!==a.localName?a._localNameCache=a.localName:void 0!==a.local?a._localNameCache=a.local:void 0!==a.nodeName?a._localNameCache=this.getQname(a.nodeName).local:this.getQname(a).local},a.prototype.testNameIs=function(a){return function(b){return e.getLocalName(b)===a}},a.prototype.textContent=function(a){var b,c,d,e,f;if(a.textContent)return a.textContent;if("string"==typeof a)return a;for(c="",f=a.childNodes,d=0,e=f.length;e>d;d++)switch(b=f[d],b.nodeType){case this.ELEMENT_NODE:case this.ENTITY_REFERENCE_NODE:c+=this.textContent(b);break;case this.ATTRIBUTE_NODE:case this.TEXT_NODE:case this.CDATA_SECTION_NODE:c+=b.nodeValue}return c},a.prototype.getXHR=function(a,b){var c,d,e,f;return c=null,null!=(null!=(e=window.tinymce)&&null!=(f=e.util)?f.XHR:void 0)?(tinymce.util.XHR.send({url:a,content_type:b,async:!1,success:function(a,b){return c=b}}),c):(d=new XMLHttpRequest,d.open("GET",a,!1),d.send(""),d)},a.prototype.trailingslashit=function(a){if(!a||!a.length)return a;switch(a[a.length-1]){case"/":return a;default:return a+"/"}},a.prototype.getXML=function(a){var b,c,d,e;return c=null,null!=(null!=(d=window.tinymce)&&null!=(e=d.util)?e.XHR:void 0)?(tinymce.util.XHR.send({url:a,content_type:"text/xml",async:!1,success:function(a,b){return c=b.responseXML}}),c):(b=new XMLHttpRequest,b.open("GET",a,!1),b.send(""),c=b.responseXML)},a.prototype.parseXML=function(a){var b,c,d;if(!a||"string"!=typeof a)return a;try{window.DOMParser?(c=new DOMParser,d=c.parseFromString(a,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(a))}catch(e){b=e,d=void 0}return d},a.prototype.parseJSON=function(a){var b,c,d,e;return((null!=(b=window.jQuery)?b.parseJSON:void 0)||(null!=(c=window.tinymce)&&null!=(d=c.util)&&null!=(e=d.JSON)?e.parse:void 0))(a)},a.prototype.hasDomError=function(a){var b;return b="http://www.mozilla.org/newlayout/xml/parsererror.xml",!a||!a.documentElement||a.documentElement.namespaceURI===b||a.getElementsByTagName("parsererror").length>0},a.prototype.depthFirstIterativePreorder=function(a,b){var c,d,e;for(d=a,c=0;null!==d;)if(e=b.startTag?b.startTag(d,c):"function"==typeof b?b.call(d,c,d):!0,d.hasChildNodes()&&e!==!1)c+=1,d=d.firstChild;else{for(;null===d.nextSibling&&null!==d.parentNode;)if(d=d.parentNode,c-=1,b.endTag&&b.endTag(d,c),d===a)return;d=d.nextSibling}},a}(),e=new c})}.call(this),function(){c("textorum/tinymce/loader",["require","../helper"],function(a){var b,c,d,e,f,g,h,i;return c=a("../helper"),f=void 0,g=void 0,d=function(a,b,d){var e,h;return null==a&&(a=""),null==b&&(b=null),null==d&&(d=null),f=new XSLTProcessor,a=c.trailingslashit(a),e=c.getXML(a+"xsl/xml2cke.xsl"),f.importStylesheet(e),f.setParameter(null,"inlineelements",b),f.setParameter(null,"fixedelements",d),g=new XSLTProcessor,h=c.getXML(a+"xsl/cke2xml.xsl"),g.importStylesheet(h)},i=function(a){var b;try{return(new XMLSerializer).serializeToString(a)}catch(c){if(b=c,"NS_ERROR_XPC_BAD_CONVERT_JS"===b.name)return"";throw b}},e=function(a){var b,d,e,g,h;if(b=!1,g=c.parseXML(a),c.hasDomError(g)){if(a="<textorum>"+a+"</textorum>",e=c.parseXML(a),c.hasDomError(e))return i(g);b=!0,g=e}return d=f.transformToDocument(g),h=(new XMLSerializer).serializeToString(d),b&&(h=h.replace(/<\/?textorum[^>]*>/g,"")),h},h=function(a){var b,d,e,f,h;if(b=!1,f=c.parseXML(a),c.hasDomError(f)){if(a='<div data-xmlel="textorum">'+a+"</div>",d=c.parseXML(a),c.hasDomError(d))return i(f);b=!0,f=d}return e=g.transformToDocument(f),h=(new XMLSerializer).serializeToString(e).replace(/\/\/TEXTORUM\/\/DOCTYPE-SYSTEM\/\//,"http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd").replace(/^(<!DOCTYPE[^>]*>\s*<[^>]*?)[ ]?xmlns:xml="http:\/\/www.w3.org\/XML\/1998\/namespace"/g,"$1").replace(/^<\?xml[^>]*>/,""),b&&(h=h.replace(/^.*<textorum>/,"").replace(/<\/textorum>.*$/,"")),h},b=function(a,b,c,e){return f||d(b,c,e),a.onBeforeSetContent.add(function(b,c){return"raw"!==c.format?(c.content=a.plugins.textorum.applyFilters("before_loadFromText",c.content),c.content=a.plugins.textorum.applyFilters("after_loadFromText",c.content)):void 0}),a.onPostProcess.add(function(b,c){return c.set&&"raw"===!c.format&&(c.content=a.plugins.textorum.applyFilters("before_loadFromText",c.content),c.content=a.plugins.textorum.applyFilters("after_loadFromText",c.content)),c.get?(c.content=a.plugins.textorum.applyFilters("before_saveFromText",c.content),c.content=a.plugins.textorum.applyFilters("after_saveFromText",c.content)):void 0})},{bindHandler:b}})}.call(this),function(){var a={}.hasOwnProperty;c("textorum/tinymce/element",["require","../helper"],function(b){var c,d,e,f;return e=b("../helper"),f=window.tinymce,c=window.jQuery,d=function(){function b(a){this.editor=a,this.editor.addCommand("addSchemaTag",this.addTag,this),this.editor.addCommand("editSchemaTag",this.editTag,this),this.editor.addCommand("removeSchemaTag",this.removeTag,this)}return b.prototype.namespaceIdx=0,b.prototype.addTag=function(a,b){var c;return c=b.key,this.editor.plugins.textorum.schema.defs[c]?this.editWindow(b):void console.log("error","no such tag in schema: "+c)},b.prototype.editTag=function(a,b){return this.editWindow({},b)},b.prototype.removeTag=function(){},b.prototype.editorNodeFromListNode=function(a){return a=c(a),a.length?c(this.editor.dom.select("#"+a.attr("name"))):a},b.prototype.nameWithPrefix=function(a,b,c){var d,e;return b.ns&&(e=this.editor.plugins.textorum.nsmap[b.ns],void 0===e&&(e="txtns"+this.namespaceIdx,this.editor.plugins.textorum.nsmap[b.ns]=e,this.namespaceIdx+=1,this.editor.dom.select("body")[0].firstElementChild.setAttribute("xmlns:"+e,b.ns),c.length&&(d=c[0].getAttributeNS(b.ns,a),d&&(c[0].removeAttributeNS(b.ns,a),c.attr(""+e+":"+a,d)))),e)?""+e+":"+a:a},b.prototype.attrListElement=function(a,b,d){var e,f,g,h,i,j,k,l,m,n,o;if(h=a,a=this.nameWithPrefix(a,b,d),e=d.attr(a),i=c(document.createElement("li")),(b.required||null!=e)&&i.addClass("open textorum-open"),i.addClass("attr textorum-attr textorum-attr-"+h.replace(/:/,"--")),i.data("textorum-attribute-name",a),f=c(document.createElement("label")),f.append(document.createTextNode(""+a)),i.append(f),j=void 0,null!=(n=b.value)?n.length:void 0)for(j=c(document.createElement("select")),b.required||(g=c(document.createElement("option")),g.val(""),g.append(document.createTextNode(" -- empty -- ")),j.append(g)),o=b.value,l=0,m=o.length;m>l;l++)k=o[l],g=c(document.createElement("option")),g.val(k),k===e&&g.prop("selected",!0),g.append(document.createTextNode(k)),j.append(g);else void 0!==b.data?(j=c(document.createElement("input")),j.prop("type","text"),null!=e&&j.val(e)):null!=b.$&&(j=c(document.createElement("textarea")),null!=e&&j.append(document.createTextNode(e)));return void 0!==j&&(j.addClass("attrinput textorum-attrinput"),j.name="attr-"+a,i.append(j)),i},b.prototype.editWindow=function(b,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r;j=this.editorNodeFromListNode(d),i=!1,d&&j.length||(i=!0),m=c(j).attr("data-xmlel")||b.key,k=null!=(r=this.editor.plugins.textorum.schema.defs[m])?r.attr:void 0,h=c(document.createElement("div")),h.addClass("attributewindow textorum-attributewindow"),f=c(document.createElement("ul")),f.addClass("required-attributes textorum-required-attributes"),g=c(document.createElement("ul")),g.addClass("textorum-optional-attributes"),g.on("click","li.textorum-attr label",function(){var a;return a=c(this),a.parents("li").toggleClass("open textorum-open")});for(e in k)a.call(k,e)&&(k[e].required?f.append(this.attrListElement(e,k[e],j)):g.append(this.attrListElement(e,k[e],j)));if(g.children().length||f.children().length)return f.children().length&&(l=c(document.createElement("h2")),l.append(document.createTextNode("Required Attributes")),h.append(l,f)),g.children().length&&(l=c(document.createElement("h2")),l.append(document.createTextNode("Optional Attributes")),h.append(l,g)),q=this.editor.windowManager,o=this.editor,p=q.open({inline:!0,resizable:!0,title:"Edit "+m,content:h,buttons:[{text:"Ok",click:function(){var a,d;if(i&&(console.log("creating node"),console.log("params",b),j=c(document.createElement(o.plugins.textorum.translateElement(m))),j.attr("data-xmlel",m),j.addClass(m),a=c(document.createElement("br")),a.attr("data-mce-bogus",1),a.appendTo(j)),h.find("li.textorum-attr").each(function(){var a;return a=c(this),a.hasClass("textorum-open")?(console.log("setting",a.data("textorum-attribute-name"),"to",a.find(".attrinput").val()),j.attr(a.data("textorum-attribute-name"),a.find(".attrinput").val())):(console.log("removing",a.data("textorum-attribute-name")),j.removeAttr(a.data("textorum-attribute-name")))}),i)switch(d=c(o.dom.select("#"+b.id)),console.log("inserting",j,b.action,d),b.action){case"before":j.insertBefore(d);break;case"after":j.insertAfter(d);break;case"inside":j.appendTo(d)}return o.undoManager.add(),o.execCommand("mceRepaint"),o.selection.select(a[0]),o.nodeChanged(),o.plugins.textorum.updateTree(),o.focus(),q.close(null,p.id)}},{text:"Cancel",click:function(a){return console.log("Cancel button clicked:",a,p),q.close(null,p.id)}}]});if(console.log("no attributes"),i)switch(console.log("creating node"),j=c(document.createElement(this.editor.plugins.textorum.translateElement(m))),j.attr("data-xmlel",m),j.addClass(m),n=c(this.editor.dom.select("#"+b.id)),console.log("inserting",j,b.action,n),b.action){case"before":j.insertBefore(n);break;case"after":j.insertAfter(n);break;case"inside":j.appendTo(n)}return this.editor.undoManager.add(),this.editor.execCommand("mceRepaint"),this.editor.plugins.textorum.updateTree(),this.editor.focus()},b}()})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty;c("textorum/tinymce/tree",["require","../helper","./element"],function(c){var d,e,f,g,h,i,j;return g=c("../helper"),e=c("./element"),h=window.tinymce,window.textorum||(window.textorum={}),d=window.jQuery,(j=window.textorum).w||(j.w={}),i=window.textorum.w,f=function(){function c(b,c,f){this.treeSelector=b,this.editor=c,this.attributeFilterCallback=a(this.attributeFilterCallback,this),this.navigateTreeCallback=a(this.navigateTreeCallback,this),this.updateTreeCallback=a(this.updateTreeCallback,this),this.selectNodeCallback=a(this.selectNodeCallback,this),this.contextMenuItemsCallback=a(this.contextMenuItemsCallback,this),this._submenuItemsForAction=a(this._submenuItemsForAction,this),this._submenuActionGenerator=a(this._submenuActionGenerator,this),this.depthWalkCallback=a(this.depthWalkCallback,this),this.treeIDPrefix="tmp_tree_",this.ignoreNavigation=!1,this.jsTree=d(this.treeSelector),this.jsTree.jstree(this._jstreeOptions()),null!=f&&(this.makeNodeTitle=f),this.previousNode=null,this.elementHandler=new e(this.editor)}return c.prototype._jstreeOptions=function(a,b){var c;return null==b&&(b=[]),null==a&&(a={data:{data:"Document",attr:{id:"root"},state:"open"}}),c={json_data:{data:a},ui:{select_limit:1},core:{animation:0,html_titles:!0,initially_open:b},contextmenu:{select_node:!0,show_at_node:!0,items:this.contextMenuItemsCallback},plugins:["json_data","ui","themes","contextmenu"],themes:{url:"[dummy]"}}},c.prototype.depthWalkCallback=function(a,b){var c,d,e,f,i;if(null==b.getAttribute)return!1;for(d=b.getAttribute("id"),d||(b.setAttribute("id",h.DOM.uniqueId(this.treeIDPrefix)),d=b.getAttribute("id"));a<this.holder.length-1;)this.holder.shift();return b.getAttribute("data-xmlel")||"br"!==b.localName?(e=b.getAttribute("data-xmlel")||"["+b.localName+"]",this.makeNodeTitle&&(c=this.makeNodeTitle(b,e),c&&(e=g.escapeHtml(c.replace("%TITLE%",e)))),(f=this.holder[0]).children||(f.children=[]),(i=this.holder[0]).state||(i.state="closed"),this.holder[0].children.push({data:e,attr:{id:"jstree_node_"+d,name:d,"class":b.getAttribute("class"),"data-xmlel":b.getAttribute("data-xmlel")}}),a<=this.holder.length-1&&this.holder.unshift(this.holder[0].children[this.holder[0].children.length-1]),!0):!1},c.prototype._submenuActionGenerator=function(a,b){var c=this;return function(e){var f;return f={x:parseInt(d("#tree_popup").css("left")),y:parseInt(d("#tree_popup").css("top"))},c.editor.currentBookmark=c.editor.selection.getBookmark(1),c.editor.execCommand("addSchemaTag",!0,{id:d(e).attr("name"),key:b,pos:f,action:a})}},c.prototype._submenuItemsForAction=function(a,b){var c=this;return function(e){var f,g,h,i,j,k,l,m,n;if(c.editor.plugins.textorum.validator){n=c.editor.plugins.textorum.validator,m=[],l=d(c.editor.dom.select("#"+b.attr("name")));for(j in a){switch(f=a[j],g=d(document.createElement(c.editor.plugins.textorum.translateElement(j))),g.attr("data-xmlel",j),g.addClass(j),e){case"before":g.insertBefore(l),k=n.validatePartialOpportunistic(l.parents()[0],!0,1);break;case"after":g.insertAfter(l),k=n.validatePartialOpportunistic(l.parents()[0],!0,1);break;case"inside":g.appendTo(l),k=n.validatePartialOpportunistic(l[0],!0,1)}g.remove(),k&&(m[j]=f)}}else{m={};for(j in a)f=a[j],m[j]=f}i={},h=!1;for(j in m)h=!0,i[""+e+"-"+j]={label:j,_class:"tag",action:c._submenuActionGenerator(e,j)};return h||(i.no_tags={label:"No tags available.",icon:"img/cross.png",action:function(){}}),i}},c.prototype.contextMenuItemsCallback=function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this;return g=this.editor.plugins.textorum.schema,a.attr("data-xmlel")?(d=this.editor.dom.select("#"+a.attr("name")),k=null!=(m=g.defs)&&null!=(n=m[a.attr("data-xmlel")])?n.contains:void 0,f=a.parents("li:first"),h=f&&f.attr("data-xmlel")?null!=(o=g.defs)&&null!=(p=o[f.attr("data-xmlel")])?p.contains:void 0:{},j=this._submenuItemsForAction(k,a),i=this._submenuItemsForAction(h,a),c=function(){var c,d,e,f;e=null!=(c=g.defs)&&null!=(d=c[a.attr("data-xmlel")])?d.attr:void 0,f=[];for(l in e)b.call(e,l)&&f.push(l);return f}().length?!1:!0,e={before:{label:"Insert Tag Before",_class:"submenu insert-tag",submenu:i("before")},after:{label:"Insert Tag After",_class:"submenu insert-tag",submenu:i("after")},inside:{label:"Insert Tag Inside",_class:"submenu insert-tag",separator_after:!0,submenu:j("inside")},edit:{label:"Edit Attributes",_class:"edit-tag",_disabled:c,action:function(a){return q.editor.execCommand("editSchemaTag",!0,a)}},"delete":{label:"Remove Tag and Contents",_class:"remove-tag",action:function(a){return q.editor.execCommand("removeSchemaTag",!0,a)}}},f.attr("data-xmlel")||(delete e["delete"],delete e.before,delete e.after,delete e.around),e):{}},c.prototype.makeNodeTitle=function(a,b){var c,e,f,g,h,i,j;return c=!0,h=function(){switch(b){case"ref":return d(a).children('[data-xmlel="label"]').text()||!1;case"article":return d(a).children('[data-xmlel="front"]').find('[data-xmlel="article-title"]').map(function(a,b){return d(b).text()}).get().join(", ");case"title":case"article-id":return d(a).text();case"journal-id":case"issn":case"publisher":return d(a).text();case"kwd":return d(a).text();case"kwd-group":return d(a).children('[data-xmlel="kwd"]').map(function(a,b){return d(b).text()}).get().join(", ");case"body":return i=d(a).children('[data-xmlel="sec"]').length,""+i+" section"+(1===i?"":"s");case"sec":case"ack":return d(a).children('[data-xmlel="title"]').text();case"ref-list":return i=d(a).children('[data-xmlel="ref"]').length,d(a).children('[data-xmlel="title"]').text()+(" - "+i+" reference")+(1===i?"":"s");case"p":return d(a).text().substr(0,20)+"...";case"table-wrap":case"fig":return f=d(a),g=f.children('[data-xmlel="label"]').text(),e=f.children('[data-xmlel="caption"]').text(),e.length>15&&(e=e.substr(0,15)+"..."),g.length>0&&e.length>0&&(g+=" "),j=[g,e].join(""),j.length>0&&(c=!1,j+=" [%TITLE%]"),j}}(),c&&h&&-1===h.indexOf("%TITLE%")&&(h="%TITLE%: "+h),h},c.prototype.selectNodeCallback=function(a,b){var c,e,f,g;if(!this.ignoreNavigation)return e=b.rslt.obj,c=e.attr("name"),c?(e=this.editor.dom.select("#"+c),f=e[0],this.editor.getWin().scrollTo(0,this.editor.dom.getPos(f).y-10),c===this.previousNode?(this.editor.selection.select(f),this.editor.nodeChanged()):(d(e).children('[data-mce-bogus="1"],br').length||(g=d(document.createElement("br")),g.attr("data-mce-bogus",1),g.prependTo(e)),this.editor.selection.setCursorLocation(f,0),this.editor.nodeChanged(),d(e).effect("highlight",{},350)),this.editor.focus(),this.previousNode=c):void 0},c.prototype.updateTreeCallback=function(){var a,b,c,e;return a=this.editor.dom.getRoot(),e=this.jsTree.jstree("get_instance"),b=this.jsTree.find(".jstree-open").map(function(a,b){return d(b).parentsUntil(".jstree",".jstree-closed").length?null:b.getAttribute("id")}).get(),c={data:"Document",state:"open",children:[]},this.holder=[],this.holder.unshift(c),g.depthFirstIterativePreorder(a,this.depthWalkCallback),this.jsTree.jstree(this._jstreeOptions([c.children],b)).on("select_node.jstree",this.selectNodeCallback).on("click.jstree","li.jstree-leaf > ins",function(a){return d(a.currentTarget).siblings("a").click()})},c.prototype.navigateTreeCallback=function(a){var b,c;return this.ignoreNavigation=!0,c=this.jsTree.jstree("get_instance"),a.getAttribute&&c.open_node?(b=c._get_node("[name='"+a.getAttribute("id")+"']"),b&&(c.open_node(b),c.deselect_all(),c.select_node(b),d(b[0]).scrollintoview({direction:"vertical"})),this.ignoreNavigation=!1,null):null},c.prototype.attributeFilterCallback=function(a,b){var c,d,e;for(c=a.length,d=this.treeIDPrefix.length,e=[];c--;)e.push(a[c].attr("id").substr(0,d)===this.treeIDPrefix?a[c].attr(b,null):void 0);return e},c}(),{TextorumTree:f}})}.call(this),function(){c("stream",["require"],function(){var a;return a=function(){},{Stream:a}})}.call(this),c("sax",["require","exports","module","stream"],function(a,b){!function(b){function c(a,d){if(!(this instanceof c))return new c(a,d);var f=this;e(f),f.q=f.c="",f.bufferCheckPosition=b.MAX_BUFFER_LENGTH,f.opt=d||{},f.opt.lowercase=f.opt.lowercase||f.opt.lowercasetags,f.looseCase=f.opt.lowercase?"toLowerCase":"toUpperCase",f.tags=[],f.closed=f.closedRoot=f.sawRoot=!1,f.tag=f.error=null,f.strict=!!a,f.noscript=!(!a&&!f.opt.noscript),f.state=Q.BEGIN,f.ENTITIES=Object.create(b.ENTITIES),f.attribList=[],f.opt.xmlns&&(f.ns=Object.create(N)),f.trackPosition=f.opt.position!==!1,f.trackPosition&&(f.position=f.line=f.column=0),l(f,"onready")}function d(a){for(var c=Math.max(b.MAX_BUFFER_LENGTH,10),d=0,e=0,f=z.length;f>e;e++){var g=a[z[e]].length;if(g>c)switch(z[e]){case"textNode":n(a);break;case"cdata":m(a,"oncdata",a.cdata),a.cdata="";break;case"script":m(a,"onscript",a.script),a.script="";break;default:p(a,"Max buffer length exceeded: "+z[e])}d=Math.max(d,g)}a.bufferCheckPosition=b.MAX_BUFFER_LENGTH-d+a.position}function e(a){for(var b=0,c=z.length;c>b;b++)a[z[b]]=""}function f(a,b){return new g(a,b)}function g(a,b){if(!(this instanceof g))return new g(a,b);A.apply(this),this._parser=new c(a,b),this.writable=!0,this.readable=!0;var d=this;this._parser.onend=function(){d.emit("end")},this._parser.onerror=function(a){d.emit("error",a),d._parser.error=null},C.forEach(function(a){Object.defineProperty(d,"on"+a,{get:function(){return d._parser["on"+a]},set:function(b){return b?void d.on(a,b):(d.removeAllListeners(a),d._parser["on"+a]=b)},enumerable:!0,configurable:!1})})}function h(a){return a.split("").reduce(function(a,b){return a[b]=!0,a},{})}function i(a){return"[object RegExp]"===Object.prototype.toString.call(a)}function j(a,b){return i(a)?!!b.match(a):a[b]}function k(a,b){return!j(a,b)}function l(a,b,c){a[b]&&a[b](c)}function m(a,b,c){a.textNode&&n(a),l(a,b,c)}function n(a){a.textNode=o(a.opt,a.textNode),a.textNode&&l(a,"ontext",a.textNode),a.textNode=""}function o(a,b){return a.trim&&(b=b.trim()),a.normalize&&(b=b.replace(/\s+/g," ")),b}function p(a,b){return n(a),a.trackPosition&&(b+="\nLine: "+a.line+"\nColumn: "+a.column+"\nChar: "+a.c),b=new Error(b),a.error=b,l(a,"onerror",b),a}function q(a){return a.closedRoot||r(a,"Unclosed root tag"),a.state!==Q.TEXT&&p(a,"Unexpected end"),n(a),a.c="",a.closed=!0,l(a,"onend"),c.call(a,a.strict,a.opt),a}function r(a,b){if("object"!=typeof a||!(a instanceof c))throw new Error("bad call to strictFail");a.strict&&p(a,b)}function s(a){a.strict||(a.tagName=a.tagName[a.looseCase]());var b=a.tags[a.tags.length-1]||a,c=a.tag={name:a.tagName,attributes:{}};a.opt.xmlns&&(c.ns=b.ns),a.attribList.length=0}function t(a){var b=a.indexOf(":"),c=0>b?["",a]:a.split(":"),d=c[0],e=c[1];return"xmlns"===a&&(d="xmlns",e=""),{prefix:d,local:e}}function u(a){if(a.strict||(a.attribName=a.attribName[a.looseCase]()),-1!==a.attribList.indexOf(a.attribName)||a.tag.attributes.hasOwnProperty(a.attribName))return a.attribName=a.attribValue="";if(a.opt.xmlns){var b=t(a.attribName),c=b.prefix,d=b.local;if("xmlns"===c)if("xml"===d&&a.attribValue!==L)r(a,"xml: prefix must be bound to "+L+"\nActual: "+a.attribValue);else if("xmlns"===d&&a.attribValue!==M)r(a,"xmlns: prefix must be bound to "+M+"\nActual: "+a.attribValue);else{var e=a.tag,f=a.tags[a.tags.length-1]||a;e.ns===f.ns&&(e.ns=Object.create(f.ns)),e.ns[d]=a.attribValue}a.attribList.push([a.attribName,a.attribValue])}else a.tag.attributes[a.attribName]=a.attribValue,m(a,"onattribute",{name:a.attribName,value:a.attribValue});a.attribName=a.attribValue=""}function v(a,b){if(a.opt.xmlns){var c=a.tag,d=t(a.tagName);c.prefix=d.prefix,c.local=d.local,c.uri=c.ns[d.prefix]||"",c.prefix&&!c.uri&&(r(a,"Unbound namespace prefix: "+JSON.stringify(a.tagName)),c.uri=c.prefix);var e=a.tags[a.tags.length-1]||a;c.ns&&e.ns!==c.ns&&Object.keys(c.ns).forEach(function(b){m(a,"onopennamespace",{prefix:b,uri:c.ns[b]})});for(var f=0,g=a.attribList.length;g>f;f++){var h=a.attribList[f],i=h[0],j=h[1],k=t(i),l=k.prefix,n=k.local,o=""==l?"":c.ns[l]||"",p={name:i,value:j,prefix:l,local:n,uri:o};l&&"xmlns"!=l&&!o&&(r(a,"Unbound namespace prefix: "+JSON.stringify(l)),p.uri=l),a.tag.attributes[i]=p,m(a,"onattribute",p)}a.attribList.length=0}a.tag.isSelfClosing=!!b,a.sawRoot=!0,a.tags.push(a.tag),m(a,"onopentag",a.tag),b||(a.state=a.noscript||"script"!==a.tagName.toLowerCase()?Q.TEXT:Q.SCRIPT,a.tag=null,a.tagName=""),a.attribName=a.attribValue="",a.attribList.length=0}function w(a){if(!a.tagName)return r(a,"Weird empty close tag."),a.textNode+="</>",void(a.state=Q.TEXT);if(a.script){if("script"!==a.tagName)return a.script+="</"+a.tagName+">",a.tagName="",void(a.state=Q.SCRIPT);m(a,"onscript",a.script),a.script=""}var b=a.tags.length,c=a.tagName;a.strict||(c=c[a.looseCase]());for(var d=c;b--;){var e=a.tags[b];if(e.name===d)break;r(a,"Unexpected close tag")}if(0>b)return r(a,"Unmatched closing tag: "+a.tagName),a.textNode+="</"+a.tagName+">",void(a.state=Q.TEXT);a.tagName=c;for(var f=a.tags.length;f-->b;){var g=a.tag=a.tags.pop();a.tagName=a.tag.name,m(a,"onclosetag",a.tagName);var h={};for(var i in g.ns)h[i]=g.ns[i];var j=a.tags[a.tags.length-1]||a;a.opt.xmlns&&g.ns!==j.ns&&Object.keys(g.ns).forEach(function(b){var c=g.ns[b];m(a,"onclosenamespace",{prefix:b,uri:c})})}0===b&&(a.closedRoot=!0),a.tagName=a.attribValue=a.attribName="",a.attribList.length=0,a.state=Q.TEXT}function x(a){var b,c=a.entity,d=c.toLowerCase(),e="";return a.ENTITIES[c]?a.ENTITIES[c]:a.ENTITIES[d]?a.ENTITIES[d]:(c=d,"#"===c.charAt(0)&&("x"===c.charAt(1)?(c=c.slice(2),b=parseInt(c,16),e=b.toString(16)):(c=c.slice(1),b=parseInt(c,10),e=b.toString(10))),c=c.replace(/^0+/,""),e.toLowerCase()!==c?(r(a,"Invalid character entity"),"&"+a.entity+";"):String.fromCharCode(b))}function y(a){var b=this;if(this.error)throw this.error;if(b.closed)return p(b,"Cannot write after close. Assign an onready handler.");if(null===a)return q(b);for(var c=0,e="";b.c=e=a.charAt(c++);)switch(b.trackPosition&&(b.position++,"\n"===e?(b.line++,b.column=0):b.column++),b.state){case Q.BEGIN:"<"===e?(b.state=Q.OPEN_WAKA,b.startTagPosition=b.position):k(D,e)&&(r(b,"Non-whitespace before first tag."),b.textNode=e,b.state=Q.TEXT);continue;case Q.TEXT:if(b.sawRoot&&!b.closedRoot){for(var f=c-1;e&&"<"!==e&&"&"!==e;)e=a.charAt(c++),e&&b.trackPosition&&(b.position++,"\n"===e?(b.line++,b.column=0):b.column++);b.textNode+=a.substring(f,c-1)}"<"===e?(b.state=Q.OPEN_WAKA,b.startTagPosition=b.position):(!k(D,e)||b.sawRoot&&!b.closedRoot||r(b,"Text data outside of root node."),"&"===e?b.state=Q.TEXT_ENTITY:b.textNode+=e);continue;case Q.SCRIPT:"<"===e?b.state=Q.SCRIPT_ENDING:b.script+=e;continue;case Q.SCRIPT_ENDING:"/"===e?b.state=Q.CLOSE_TAG:(b.script+="<"+e,b.state=Q.SCRIPT);continue;case Q.OPEN_WAKA:if("!"===e)b.state=Q.SGML_DECL,b.sgmlDecl="";else if(j(D,e));else if(j(O,e))b.state=Q.OPEN_TAG,b.tagName=e;else if("/"===e)b.state=Q.CLOSE_TAG,b.tagName="";else if("?"===e)b.state=Q.PROC_INST,b.procInstName=b.procInstBody="";else{if(r(b,"Unencoded <"),b.startTagPosition+1<b.position){var g=b.position-b.startTagPosition;e=new Array(g).join(" ")+e}b.textNode+="<"+e,b.state=Q.TEXT}continue;case Q.SGML_DECL:(b.sgmlDecl+e).toUpperCase()===J?(m(b,"onopencdata"),b.state=Q.CDATA,b.sgmlDecl="",b.cdata=""):b.sgmlDecl+e==="--"?(b.state=Q.COMMENT,b.comment="",b.sgmlDecl=""):(b.sgmlDecl+e).toUpperCase()===K?(b.state=Q.DOCTYPE,(b.doctype||b.sawRoot)&&r(b,"Inappropriately located doctype declaration"),b.doctype="",b.sgmlDecl=""):">"===e?(m(b,"onsgmldeclaration",b.sgmlDecl),b.sgmlDecl="",b.state=Q.TEXT):j(G,e)?(b.state=Q.SGML_DECL_QUOTED,b.sgmlDecl+=e):b.sgmlDecl+=e;continue;case Q.SGML_DECL_QUOTED:e===b.q&&(b.state=Q.SGML_DECL,b.q=""),b.sgmlDecl+=e;continue;case Q.DOCTYPE:">"===e?(b.state=Q.TEXT,m(b,"ondoctype",b.doctype),b.doctype=!0):(b.doctype+=e,"["===e?b.state=Q.DOCTYPE_DTD:j(G,e)&&(b.state=Q.DOCTYPE_QUOTED,b.q=e));continue;case Q.DOCTYPE_QUOTED:b.doctype+=e,e===b.q&&(b.q="",b.state=Q.DOCTYPE);continue;case Q.DOCTYPE_DTD:b.doctype+=e,"]"===e?b.state=Q.DOCTYPE:j(G,e)&&(b.state=Q.DOCTYPE_DTD_QUOTED,b.q=e);continue;case Q.DOCTYPE_DTD_QUOTED:b.doctype+=e,e===b.q&&(b.state=Q.DOCTYPE_DTD,b.q="");continue;case Q.COMMENT:"-"===e?b.state=Q.COMMENT_ENDING:b.comment+=e;continue;case Q.COMMENT_ENDING:"-"===e?(b.state=Q.COMMENT_ENDED,b.comment=o(b.opt,b.comment),b.comment&&m(b,"oncomment",b.comment),b.comment=""):(b.comment+="-"+e,b.state=Q.COMMENT);continue;case Q.COMMENT_ENDED:">"!==e?(r(b,"Malformed comment"),b.comment+="--"+e,b.state=Q.COMMENT):b.state=Q.TEXT;continue;case Q.CDATA:"]"===e?b.state=Q.CDATA_ENDING:b.cdata+=e;continue;case Q.CDATA_ENDING:"]"===e?b.state=Q.CDATA_ENDING_2:(b.cdata+="]"+e,b.state=Q.CDATA);continue;case Q.CDATA_ENDING_2:">"===e?(b.cdata&&m(b,"oncdata",b.cdata),m(b,"onclosecdata"),b.cdata="",b.state=Q.TEXT):"]"===e?b.cdata+="]":(b.cdata+="]]"+e,b.state=Q.CDATA);continue;case Q.PROC_INST:"?"===e?b.state=Q.PROC_INST_ENDING:j(D,e)?b.state=Q.PROC_INST_BODY:b.procInstName+=e;
continue;case Q.PROC_INST_BODY:if(!b.procInstBody&&j(D,e))continue;"?"===e?b.state=Q.PROC_INST_ENDING:b.procInstBody+=e;continue;case Q.PROC_INST_ENDING:">"===e?(m(b,"onprocessinginstruction",{name:b.procInstName,body:b.procInstBody}),b.procInstName=b.procInstBody="",b.state=Q.TEXT):(b.procInstBody+="?"+e,b.state=Q.PROC_INST_BODY);continue;case Q.OPEN_TAG:j(P,e)?b.tagName+=e:(s(b),">"===e?v(b):"/"===e?b.state=Q.OPEN_TAG_SLASH:(k(D,e)&&r(b,"Invalid character in tag name"),b.state=Q.ATTRIB));continue;case Q.OPEN_TAG_SLASH:">"===e?(v(b,!0),w(b)):(r(b,"Forward-slash in opening tag not followed by >"),b.state=Q.ATTRIB);continue;case Q.ATTRIB:if(j(D,e))continue;">"===e?v(b):"/"===e?b.state=Q.OPEN_TAG_SLASH:j(O,e)?(b.attribName=e,b.attribValue="",b.state=Q.ATTRIB_NAME):r(b,"Invalid attribute name");continue;case Q.ATTRIB_NAME:"="===e?b.state=Q.ATTRIB_VALUE:">"===e?(r(b,"Attribute without value"),b.attribValue=b.attribName,u(b),v(b)):j(D,e)?b.state=Q.ATTRIB_NAME_SAW_WHITE:j(P,e)?b.attribName+=e:r(b,"Invalid attribute name");continue;case Q.ATTRIB_NAME_SAW_WHITE:if("="===e)b.state=Q.ATTRIB_VALUE;else{if(j(D,e))continue;r(b,"Attribute without value"),b.tag.attributes[b.attribName]="",b.attribValue="",m(b,"onattribute",{name:b.attribName,value:""}),b.attribName="",">"===e?v(b):j(O,e)?(b.attribName=e,b.state=Q.ATTRIB_NAME):(r(b,"Invalid attribute name"),b.state=Q.ATTRIB)}continue;case Q.ATTRIB_VALUE:if(j(D,e))continue;j(G,e)?(b.q=e,b.state=Q.ATTRIB_VALUE_QUOTED):(r(b,"Unquoted attribute value"),b.state=Q.ATTRIB_VALUE_UNQUOTED,b.attribValue=e);continue;case Q.ATTRIB_VALUE_QUOTED:if(e!==b.q){"&"===e?b.state=Q.ATTRIB_VALUE_ENTITY_Q:b.attribValue+=e;continue}u(b),b.q="",b.state=Q.ATTRIB;continue;case Q.ATTRIB_VALUE_UNQUOTED:if(k(I,e)){"&"===e?b.state=Q.ATTRIB_VALUE_ENTITY_U:b.attribValue+=e;continue}u(b),">"===e?v(b):b.state=Q.ATTRIB;continue;case Q.CLOSE_TAG:if(b.tagName)">"===e?w(b):j(P,e)?b.tagName+=e:b.script?(b.script+="</"+b.tagName,b.tagName="",b.state=Q.SCRIPT):(k(D,e)&&r(b,"Invalid tagname in closing tag"),b.state=Q.CLOSE_TAG_SAW_WHITE);else{if(j(D,e))continue;k(O,e)?b.script?(b.script+="</"+e,b.state=Q.SCRIPT):r(b,"Invalid tagname in closing tag."):b.tagName=e}continue;case Q.CLOSE_TAG_SAW_WHITE:if(j(D,e))continue;">"===e?w(b):r(b,"Invalid characters in closing tag");continue;case Q.TEXT_ENTITY:case Q.ATTRIB_VALUE_ENTITY_Q:case Q.ATTRIB_VALUE_ENTITY_U:switch(b.state){case Q.TEXT_ENTITY:var h=Q.TEXT,i="textNode";break;case Q.ATTRIB_VALUE_ENTITY_Q:var h=Q.ATTRIB_VALUE_QUOTED,i="attribValue";break;case Q.ATTRIB_VALUE_ENTITY_U:var h=Q.ATTRIB_VALUE_UNQUOTED,i="attribValue"}";"===e?(b[i]+=x(b),b.entity="",b.state=h):j(H,e)?b.entity+=e:(r(b,"Invalid character entity"),b[i]+="&"+b.entity+e,b.entity="",b.state=h);continue;default:throw new Error(b,"Unknown state: "+b.state)}return b.position>=b.bufferCheckPosition&&d(b),b}b.parser=function(a,b){return new c(a,b)},b.SAXParser=c,b.SAXStream=g,b.createStream=f,b.MAX_BUFFER_LENGTH=65536;var z=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];b.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(a){function b(){this.__proto__=a}return b.prototype=a,new b}),Object.getPrototypeOf||(Object.getPrototypeOf=function(a){return a.__proto__}),Object.keys||(Object.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}),c.prototype={end:function(){q(this)},write:y,resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{var A=a("stream").Stream}catch(B){var A=function(){}}var C=b.EVENTS.filter(function(a){return"error"!==a&&"end"!==a});g.prototype=Object.create(A.prototype,{constructor:{value:g}}),g.prototype.write=function(a){return this._parser.write(a.toString()),this.emit("data",a),!0},g.prototype.end=function(a){return a&&a.length&&this._parser.write(a.toString()),this._parser.end(),!0},g.prototype.on=function(a,b){var c=this;return c._parser["on"+a]||-1===C.indexOf(a)||(c._parser["on"+a]=function(){var b=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);b.splice(0,0,a),c.emit.apply(c,b)}),A.prototype.on.call(c,a,b)};var D="\r\n	 ",E="0124356789",F="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",G="'\"",H=E+F+"#",I=D+">",J="[CDATA[",K="DOCTYPE",L="http://www.w3.org/XML/1998/namespace",M="http://www.w3.org/2000/xmlns/",N={xml:L,xmlns:M};D=h(D),E=h(E),F=h(F);var O=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,P=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;G=h(G),H=h(H),I=h(I);var Q=0;b.STATE={BEGIN:Q++,TEXT:Q++,TEXT_ENTITY:Q++,OPEN_WAKA:Q++,SGML_DECL:Q++,SGML_DECL_QUOTED:Q++,DOCTYPE:Q++,DOCTYPE_QUOTED:Q++,DOCTYPE_DTD:Q++,DOCTYPE_DTD_QUOTED:Q++,COMMENT_STARTING:Q++,COMMENT:Q++,COMMENT_ENDING:Q++,COMMENT_ENDED:Q++,CDATA:Q++,CDATA_ENDING:Q++,CDATA_ENDING_2:Q++,PROC_INST:Q++,PROC_INST_BODY:Q++,PROC_INST_ENDING:Q++,OPEN_TAG:Q++,OPEN_TAG_SLASH:Q++,ATTRIB:Q++,ATTRIB_NAME:Q++,ATTRIB_NAME_SAW_WHITE:Q++,ATTRIB_VALUE:Q++,ATTRIB_VALUE_QUOTED:Q++,ATTRIB_VALUE_UNQUOTED:Q++,ATTRIB_VALUE_ENTITY_Q:Q++,ATTRIB_VALUE_ENTITY_U:Q++,CLOSE_TAG:Q++,CLOSE_TAG_SAW_WHITE:Q++,SCRIPT:Q++,SCRIPT_ENDING:Q++},b.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(b.ENTITIES).forEach(function(a){var c=b.ENTITIES[a],d="number"==typeof c?String.fromCharCode(c):c;b.ENTITIES[a]=d});for(var Q in b.STATE)b.STATE[b.STATE[Q]]=Q;Q=b.STATE}("undefined"==typeof b?sax={}:b)}),function(){var a=[].slice,b={}.hasOwnProperty,d=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},e=function(a,b){return function(){return a.apply(b,arguments)}},f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};c("textorum/relaxng/objects",["require","../helper"],function(b){var c,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T;return J=b("../helper"),j=!1,P=!1,Q=0,K={},M={internSuccess:0,internCheck:0,attributeShutDown:0,startTagOpenDeriv:0},O=function(a){var b;return b=P,P=a,b},N=function(a){var b;return b=j,j=a,b},R=function(){var b,c,d,e,f;if(e=arguments[0],d=2<=arguments.length?a.call(arguments,1):[],j){for(b=J.depth(e)+0,c="",f=0;b>f;)c+="| ",f+=1;return c.length&&d.unshift(c),console.log.apply(console,d)}},I=function(a,b){var c,d,e;return a instanceof A?a:a?(d=J.getChildNodes(a),e=function(){switch(J.getLocalName(a)){case"element":return new m(d[0],d[1]);case"define":return new l(J.getNodeAttr(a,"name"),d[0]);case"notAllowed":return H.notAllowed("not allowed by pattern",a);case"empty":return H.empty(void 0,a);case"text":return new E;case"data":return new k(J.getNodeAttr(a,"datatypeLibrary"),J.getNodeAttr(a,"type"),d);case"value":return new F(J.getNodeAttr(a,"dataTypeLibrary"),J.getNodeAttr(a,"type"),J.getNodeAttr(a,"ns"),d[0]);case"list":return new t(d[0]);case"attribute":return c=P?new n(""+c):new h(d[0],d[1]);case"ref":return new D(J.getNodeAttr(a,"name"),b);case"oneOrMore":return new z(d[0]);case"choice":return new i(d[0],d[1]);case"group":return new r(d[0],d[1]);case"interleave":return new s(d[0],d[1]);case"anyName":return new g(d[0]);case"nsName":return new y(J.getNodeAttr(a,"ns"),d[0]);case"name":return new v(J.getNodeAttr(a,"ns"),d[0]);case"choice":return new i(d[0],d[1]);case"except":return I(d[0]);case"param":return new Param(J.getNodeAttr(a,"name"),d[0]);default:throw new C("can't parse pattern for "+J.getLocalName(a))}}()):H.notAllowed("trying to load empty pattern")},B=function(){function a(){this.choiceMap={},M.empty=new n,M.notallowed=new x}return a.prototype.notAllowed=function(a,b,c,d){return void 0!==a?new x(a,b,c,d):M.notallowed},a.prototype.empty=function(a,b){return M.empty},a.prototype.noteChoices=function(a){var b,c;return null!=a._notedChoices?a._notedChoices:a instanceof i?(b=this.noteChoices(a.pattern1),c=this.noteChoices(a.pattern2),a._notedChoices=b.concat(c),a._notedChoices):(this.choiceMap[a.uniqueIndex]=a,[a])},a.prototype.removeChoices=function(a){var b,c;return a instanceof i?(b=this.removeChoices(a.pattern1),c=this.removeChoices(a.pattern2),b.uniqueIndex===a.pattern1.uniqueIndex&&c.uniqueIndex===a.pattern2.uniqueIndex?a:b instanceof x?c:c instanceof x?b:this.internChoice(b,c)):void 0!==this.choiceMap[a.uniqueIndex]?this.notAllowed():a},a.prototype.choice=function(a,b){if(a.uniqueIndex===b.uniqueIndex)return a;if(a instanceof x)return b;if(b instanceof x)return a;if(a instanceof n&&b instanceof n)return a;if(!(a instanceof i)&&b.containsChoice(a))return b;if(!(b instanceof i)&&a.containsChoice(b))return a;if(this.noteChoices(a),b=this.removeChoices(b),this.choiceMap={},b instanceof x)return a;if(a instanceof c&&b instanceof c){if(a.pattern1.uniqueIndex===b.pattern1.uniqueIndex)return this.after(a.pattern1,this.choice(a.pattern2,b.pattern2));if(a.pattern1 instanceof x)return b;if(b.pattern1 instanceof x)return a;if(a.pattern2.uniqueIndex===b.pattern2.uniqueIndex)return this.after(this.choice(a.pattern1,b.pattern1),a.pattern2)}return this.internChoice(a,b)},a.prototype.internChoice=function(a,b){var c;return a instanceof D&&a.dereference(),b instanceof D&&b.dereference(),c=a.uniqueIndex<b.uniqueIndex?"Choice,choices,"+a.uniqueIndex+","+b.uniqueIndex:"Choice,choices,"+b.uniqueIndex+","+a.uniqueIndex,M.internCheck+=1,void 0===M[c]?M[c]=new i(a,b):M.internSuccess+=1,M[c]},a.prototype.group=function(a,b){var c;return a instanceof x?a:b instanceof x?b:b instanceof n?a:a instanceof n?b:(c="Group,choices,"+a.uniqueIndex+","+b.uniqueIndex,M.internCheck+=1,void 0===M[c]?M[c]=new r(a,b):M.internSuccess+=1,M[c])},a.prototype.interleave=function(a,b){var c,d,e;return a instanceof x?a:b instanceof x?b:b instanceof n?a:a instanceof n?b:(e=["Interleave"],c=[a.uniqueIndex,b.uniqueIndex].sort(),e.push("choices"),e.push(c),d=e.join("|"),M.internCheck+=1,void 0===M[d]?M[d]=new s(a,b):M.internSuccess+=1,M[d])},a.prototype.after=function(a,b){var d,e,f;return a instanceof x?a:b instanceof x?b:(f=["After"],d=[a.uniqueIndex,b.uniqueIndex],f.push("choices"),f.push(d),e=f.join("|"),M.internCheck+=1,void 0===M[e]?M[e]=new c(a,b):M.internSuccess+=1,M[e])},a.prototype.oneOrMore=function(a){var b;return a instanceof x||a instanceof n||a instanceof z?a:(b="OneOrMore,"+a.uniqueIndex,M.internCheck+=1,void 0===M[b]?M[b]=new z(a):M.internSuccess+=1,M[b])},a}(),C=function(a){function b(a,c,d,e){return this.pattern=null!=c?c:null,this.node=null!=d?d:null,this.parser=null!=e?e:null,b.__super__.constructor.call(this,a)}return d(b,a),b}(Error),o=function(){function a(a,b){this.func=a,this.arg2=b,this.apply=e(this.apply,this)}return a.prototype.apply=function(a,b){return this.func.apply(a,[b,this.arg2])},a}(),L=function(){function a(a,b){this.func=a,this.arg1=b,this.apply=e(this.apply,this)}return a.prototype.apply=function(a,b){return this.func.apply(a,[this.arg1,b])},a}(),G=function(a,b){if(b instanceof c)return H.after(b.pattern1,a.apply(this,b.pattern2));if(b instanceof i)return H.choice(G(a,b.pattern1),G(a,b.pattern2));if(b instanceof x)return b;throw new C(""+b+" is not an After, Choice, or NotAllowed",b)},A=function(){function a(){var a;this instanceof n?this.uniqueIndex="empty":(this.uniqueIndex=Q++,K[a=this.constructor.name]||(K[a]=0),K[this.constructor.name]++)}return a.prototype.choiceLeaves=function(){return[this.uniqueIndex]},a.prototype.pruneChoiceLeaf=function(){return this},a.prototype.containsChoice=function(a){return this.uniqueIndex===a.uniqueIndex},a.prototype.startTagOpenDeriv=function(a){return void 0===a._memoizedStartTagOpenDeriv&&(a._memoizedStartTagOpenDeriv={}),void 0===a._memoizedStartTagOpenDeriv[this.uniqueIndex]&&(a._memoizedStartTagOpenDeriv[this.uniqueIndex]=this._startTagOpenDeriv(a),M.startTagOpenDeriv+=1),a._memoizedStartTagOpenDeriv[this.uniqueIndex]},a.prototype._startTagOpenDeriv=function(a){return H.notAllowed("expected "+this,this,a)},a.prototype.startTagCloseDeriv=function(a){return void 0===a._memoizedstartTagCloseDeriv&&(a._memoizedstartTagCloseDeriv={}),void 0===a._memoizedstartTagCloseDeriv[this.uniqueIndex]&&(a._memoizedstartTagCloseDeriv[this.uniqueIndex]=this._startTagCloseDeriv(a)),a._memoizedstartTagCloseDeriv[this.uniqueIndex]},a.prototype._startTagCloseDeriv=function(){return this},a.prototype.endTagDeriv=function(a){return void 0===a._memoizedendTagDeriv&&(a._memoizedendTagDeriv={}),void 0===a._memoizedendTagDeriv[this.uniqueIndex]&&(a._memoizedendTagDeriv[this.uniqueIndex]=this._endTagDeriv(a)),a._memoizedendTagDeriv[this.uniqueIndex]},a.prototype._endTagDeriv=function(a){return this instanceof x?this:H.notAllowed("invalid pattern: "+this,this,a)},a.prototype.attDeriv=function(a){return"xml"===J.getNamespacePrefix(a.name)?this:H.notAllowed("unknown attribute "+a.name+" (value "+a.value+")",this,a)},a.prototype.topLevelAfterSecondOperandChoice=function(){return null!=this.pattern1&&null!=this.pattern2?H.choice(this.pattern1.topLevelAfterSecondOperandChoice(),this.pattern2.topLevelAfterSecondOperandChoice()):null!=this.pattern?this.pattern.topLevelAfterSecondOperandChoice():this},a.prototype.childDeriv=function(a,b){var c,d,e,f,g,h;if(null==b&&(b=!1),R(a,"starting childDeriv",a,this),J.getNodeType(a)===Node.TEXT_NODE)return this.textDeriv(a);if(e=this.startTagOpenDeriv(a),e instanceof x)return e;if(!P)for(h=J.getNodeAttributes(a),f=0,g=h.length;g>f;f++)if(c=h[f],e=e.attDeriv(c),e instanceof x)return e;return e=e.startTagCloseDeriv(a),e instanceof x?e:b?(b!==!0&&(b-=1),e=e.childrenDeriv(J.getChildNodes(a),b),e instanceof x?e:e.endTagDeriv(a)):(d=e.endTagDeriv(a),d instanceof x?e.topLevelAfterSecondOperandChoice():d)},a.prototype.childrenDeriv=function(a,b){var c,d,e,f,g,h,i;if(a.length||this.childrenDeriv([""]),1===a.length&&J.isNodeWhitespace(a[0]))return f=this.childDeriv(a[0],b),H.choice(this,f);for(g=this,h=0,i=a.length;i>h;h++){switch(c=a[h],J.getNodeType(c)){case Node.TEXT_NODE:if(""===J.textContent(c).replace(/^\s+|\s+$/gm,""))continue;break;case Node.COMMENT_NODE:continue;case Node.ELEMENT_NODE:d=c}if(e=g.childDeriv(c,b),e instanceof x)return e;g=e}return g},a.prototype.textDeriv=function(a){return H.notAllowed(""+this,this,a)},a.prototype.toString=function(){return void 0===this._toStringCache&&(this._toStringCache=this._toString()),this._toStringCache},a.prototype._toString=function(){return"<UNDEFINED PATTERN>"},a.prototype.valueMatch=function(a){var b;return this.nullable()&&J.isNodeWhitespace(a)?H.empty():(b=this.textDeriv(a),b.nullable()?H.empty():x("value mismatch: "+a+" does not match "+this+": "+b,this,a))},a.prototype.nullable=function(){return this._nullable()},a.prototype._nullable=function(){return!1},a.prototype.contains=function(a){throw new C("Cannot call 'contains("+a+")' on pattern '"+this.toString()+"'")},a.prototype.dereference=function(){return this},a}(),w=function(a){function b(){return S=b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.contains=function(a){throw new C("Checking contains("+a+") on undefined NameClass")},b}(A),g=function(a){function b(a){b.__super__.constructor.call(this),this.except=I(a)}return d(b,a),b.prototype.contains=function(a){return this.except instanceof x?!0:!this.except.contains(a)},b.prototype._toString=function(){return this.except instanceof x?"*":"* - "+this.except},b}(w),v=function(a){function b(a,c){b.__super__.constructor.call(this),this.ns=a,this.name=c}return d(b,a),b.prototype.contains=function(a){return this.name===a.localName||this.name===J.getLocalName(a)},b.prototype._toString=function(){return this.ns?""+this.ns+":"+this.name:""+this.name},b}(w),y=function(a){function b(a,c){b.__super__.constructor.call(this),this.ns=a,this.except=I(c)}return d(b,a),b.prototype.contains=function(a){return this.except instanceof x||this.except.contains(a),!0},b.prototype._toString=function(){return this.except instanceof x?""+this.ns+":*":""+this.ns+":* - "+this.except+"]"},b}(w),c=function(a){function b(a,c){this.pattern1=a,this.pattern2=c,b.__super__.constructor.call(this)}return d(b,a),b.prototype._startTagOpenDeriv=function(a){var b;return b=new o(H.after,this.pattern2),G(b,this.pattern1.startTagOpenDeriv(a))},b.prototype._startTagCloseDeriv=function(a){return H.after(this.pattern1.startTagCloseDeriv(a),this.pattern2)},b.prototype._endTagDeriv=function(a){return this.pattern1.nullable()?this.pattern2:new u("missing "+this.pattern1+" before close",this,a)},b.prototype.topLevelAfterSecondOperandChoice=function(){return this.pattern2},b.prototype.attDeriv=function(a){var b;return this.pattern2 instanceof x?this.pattern2:(b=this.pattern1.attDeriv(a),b.uniqueIndex===this.pattern1.uniqueIndex?this:H.after(b,this.pattern2))},b.prototype.textDeriv=function(a){return H.after(this.pattern1.textDeriv(a),this.pattern2)},b.prototype._toString=function(){return"\n [:first: -- "+this.pattern1+" \n -- :then: "+this.pattern2+"]"},b}(A),n=function(a){function b(a,c,d){this.message=a,this.pattern=c,this.childNode=d,b.__super__.constructor.call(this)}return d(b,a),b.prototype.textDeriv=function(){return this},b.prototype._toString=function(){return this.message?""+this.message:"empty"},b.prototype._nullable=function(){return!0},b}(A),x=function(a){function b(a,c,d,e){return this.message=a,this.pattern=c,this.childNode=d,this.priority=null!=e?e:10,b.__super__.constructor.call(this),this}return d(b,a),b.prototype._toString=function(){return this.message?"notAllowed { "+this.message+" }":"notAllowed"},b}(A),u=function(a){function b(a,c,d,e){this.message=a,this.pattern=c,this.childNode=d,this.priority=null!=e?e:10,b.__super__.constructor.call(this,this.message,this.pattern,this.childNode,this.priority)}return d(b,a),b.prototype._toString=function(){return this.message?"missingContent { "+this.message+" }":"missingContent"},b}(x),E=function(a){function b(){return T=b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype._toString=function(){return"text"},b.prototype.textDeriv=function(){return this},b.prototype._nullable=function(){return!0},b}(n),i=function(a){function b(a,c){this.pattern1=I(a),this.pattern2=I(c),b.__super__.constructor.call(this)}return d(b,a),b.prototype.choiceLeaves=function(){var a,b,c,d,e;for(b=this.pattern1.choiceLeaves(),c=this.pattern2.choiceLeaves(),d=0,e=c.length;e>d;d++)a=c[d],f.call(b,a)<0&&b.push(a);return b},b.prototype.pruneChoiceLeaf=function(a){return this.pattern1.uniqueIndex===a?this.pattern2.pruneChoiceLeaf(a):this.pattern2.uniqueIndex===a?this.pattern1.pruneChoiceLeaf(a):this},b.prototype.containsChoice=function(a){return this.pattern1.uniqueIndex===a.uniqueIndex?!0:this.pattern2.unqiueIndex===a.uniqueIndex?!0:this.pattern1 instanceof b&&this.pattern1.containsChoice(a)?!0:this.pattern2 instanceof b&&this.pattern2.containsChoice(a)?!0:!1},b.prototype._startTagOpenDeriv=function(a){var b,c;return b=this.pattern1.startTagOpenDeriv(a),c=this.pattern2.startTagOpenDeriv(a),H.choice(b,c)},b.prototype._startTagCloseDeriv=function(a){return H.choice(this.pattern1.startTagCloseDeriv(a),this.pattern2.startTagCloseDeriv(a))},b.prototype._endTagDeriv=function(a){var b,c;return this.pattern1 instanceof h?this.pattern2 instanceof h?H.notAllowed():this.pattern2.endTagDeriv(a):this.pattern2 instanceof h?this.pattern1.endTagDeriv(a):(b=this.pattern1.endTagDeriv(a),c=this.pattern2.endTagDeriv(a),b.uniqueIndex===this.pattern1.uniqueIndex&&c.uniqueIndex===this.pattern2.uniqueIndex?this:H.choice(b,c))},b.prototype.attDeriv=function(a){return H.choice(this.pattern1.attDeriv(a),this.pattern2.attDeriv(a))},b.prototype.textDeriv=function(a){return H.choice(this.pattern1.textDeriv(a),this.pattern2.textDeriv(a))},b.prototype._toString=function(){return"("+this.pattern1+" | "+this.pattern2+")"},b.prototype.contains=function(a){return this.pattern1.contains(a)||this.pattern2.contains(a)},b.prototype._nullable=function(){return this.pattern1.nullable()||this.pattern2.nullable()},b}(A),s=function(a){function b(a,c){this.pattern1=I(a),this.pattern2=I(c),b.__super__.constructor.call(this)}return d(b,a),b.prototype._startTagOpenDeriv=function(a){var b,c,d,e;return b=new o(H.interleave,this.pattern2),d=G(b,this.pattern1.startTagOpenDeriv(a)),c=new L(H.interleave,this.pattern1),e=G(c,this.pattern2.startTagOpenDeriv(a)),H.choice(d,e)},b.prototype._endTagDeriv=function(a){var b,c;return b=this.pattern1.endTagDeriv(a),c=this.pattern2.endTagDeriv(a),b.uniqueIndex===this.pattern1.uniqueIndex&&c.uniqueIndex===this.pattern2.uniqueIndex?this:H.interleave(b,c)},b.prototype._startTagCloseDeriv=function(a){return H.interleave(this.pattern1.startTagCloseDeriv(a),this.pattern2.startTagCloseDeriv(a))},b.prototype.attDeriv=function(a){var b,c;return b=H.interleave(this.pattern1.attDeriv(a),this.pattern2),c=H.interleave(this.pattern1,this.pattern2.attDeriv(a)),H.choice(b,c)},b.prototype._toString=function(){return"("+this.pattern1+" & "+this.pattern2+")"},b.prototype._nullable=function(){return this.pattern1.nullable()&&this.pattern2.nullable()},b}(A),r=function(a){function b(a,c){this.pattern1=I(a),this.pattern2=I(c),b.__super__.constructor.call(this)}return d(b,a),b.prototype._startTagOpenDeriv=function(a){var b,c;return b=new o(H.group,this.pattern2),c=G(b,this.pattern1.startTagOpenDeriv(a)),this.pattern1.nullable()?H.choice(c,this.pattern2.startTagOpenDeriv(a)):c},b.prototype._endTagDeriv=function(a){var b,c;return this.pattern1 instanceof h||this.pattern2 instanceof h?H.notAllowed():(b=this.pattern1.endTagDeriv(a),c=this.pattern2.endTagDeriv(a),b.uniqueIndex===this.pattern1.uniqueIndex&&c.uniqueIndex===this.pattern2.uniqueIndex?this:H.group(b,c))},b.prototype._startTagCloseDeriv=function(a){return H.group(this.pattern1.startTagCloseDeriv(a),this.pattern2.startTagCloseDeriv(a))},b.prototype.attDeriv=function(a){var b,c,d,e;return d=this.pattern1.attDeriv(a),e=this.pattern2.attDeriv(a),d.uniqueIndex===this.pattern1.uniqueIndex&&e.uniqueIndex===this.pattern2.uniqueIndex?this:(b=H.group(d,this.pattern2),c=H.group(this.pattern1,e),H.choice(b,c))},b.prototype.textDeriv=function(a){var b;return b=H.group(this.pattern1.textDeriv(a),this.pattern2),this.pattern1.nullable()?H.choice(b,this.pattern2.textDeriv(a)):b},b.prototype._toString=function(){return""+this.pattern1+", "+this.pattern2},b.prototype._nullable=function(){return this.pattern1.nullable()&&this.pattern2.nullable()},b}(A),z=function(a){function b(a){this.pattern=I(a),b.__super__.constructor.call(this)}return d(b,a),b.prototype._startTagOpenDeriv=function(a){var b,c;return c=this.pattern.startTagOpenDeriv(a),b=new o(H.group,H.choice(this,H.empty("empty | "+this,this))),G(b,c)},b.prototype._endTagDeriv=function(a){var b;return b=this.pattern.endTagDeriv(a),b.uniqueIndex===this.pattern.uniqueIndex?this:H.oneOrMore(b)},b.prototype._startTagCloseDeriv=function(a){return H.oneOrMore(this.pattern.startTagCloseDeriv(a))},b.prototype.attDeriv=function(a){return H.group(this.pattern.attDeriv(a),H.choice(this,H.empty(""+this)))},b.prototype.textDeriv=function(a){return H.group(this.pattern.textDeriv(a),H.choice(this,H.empty(""+this)))},b.prototype._toString=function(){return""+this.pattern+"+"},b.prototype._nullable=function(){return this.pattern.nullable()},b}(A),t=function(a){function b(a){this.pattern=I(a),b.__super__.constructor.call(this)}return d(b,a),b.prototype.textDeriv=function(){return H.empty("skipping List validation")},b.prototype._toString=function(){return"list { "+this.pattern+" }"},b}(A),k=function(a){function b(a,c,d){var e,f,g;for(this.dataType=a,this.type=c,this.params=[],this.except=H.notAllowed(),f=0,g=d.length;g>f;f++)e=d[f],"param"===e.local?this.params.push(I(e)):"except"===e.local&&(this.except=I(e));b.__super__.constructor.call(this)}return d(b,a),b.prototype.textDeriv=function(){return H.empty("Skipping Data validation")},b.prototype._toString=function(){var a;return a="",this.dataType&&(a+=""+this.dataType+":"),a+=""+this.type,this.paramList&&(a+=" { "+this.paramList+" }"),this.except instanceof x||(a+=" - "+this.except),a},b}(A),F=function(a){function b(a,c,d,e){this.dataType=a,this.type=c,this.ns=d,this.string=e,b.__super__.constructor.call(this)}return d(b,a),b.prototype.textDeriv=function(){return H.empty("skipping Value validation")},b.prototype._toString=function(){var a;return a="",void 0!==this.dataType&&(a+=""+this.dataType+":"),void 0!==this.type&&(a+=""+this.type+" "),a+='"'+this.string+'"'},b}(A),h=function(a){function b(a,c,d){this.defaultValue=null!=d?d:null,this.nameClass=a,this.pattern=I(c),b.__super__.constructor.call(this)}return d(b,a),b.prototype._startTagCloseDeriv=function(a){return M.attributeShutDown+=1,H.notAllowed()},b.prototype.matchAttrName=function(){},b.prototype.attDeriv=function(a){var b,c;return b=this.nameClass.contains(a.name),b instanceof x?b:(c=this.pattern.valueMatch(a.value),c instanceof x?c:H.empty("good attribute: "+this,this,a))},b.prototype._toString=function(){return"attribute "+this.nameClass+" { "+this.pattern+" }"},b}(A),p=function(a){function b(a,c){this.name=a,this.pattern=c,b.__super__.constructor.call(this,this.name,this.pattern)}return d(b,a),b.prototype._toString=function(){return"(GOOD) element "+this.name},b}(n),q=function(a){function b(a,c,d){this.name=a,this.pattern=c,this.childNodes=d,b.__super__.constructor.call(this,a,c)}return d(b,a),b.prototype._toString=function(){return"(GOOD) element "+this.name+" (with "+(("undefined"!=typeof childNodes&&null!==childNodes?childNodes.length:void 0)+0)+" children)"},b}(p),m=function(a){function b(a,c){this.name=I(a),this.pattern=I(c),b.__super__.constructor.call(this)}return d(b,a),b.prototype._startTagOpenDeriv=function(a){var b;return b=this.name.contains(a),b?H.after(this.pattern,H.empty()):H.notAllowed("expecting "+this.name,this.name,a,5+J.depth(a))},b.prototype._toString=function(){return"element "+this.name+" { "+this.pattern+" }"},b}(A),D=function(a){function b(a,c){this.refname=a,this.defines=c,b.__super__.constructor.call(this),this.dereference()}return d(b,a),b.prototype._startTagOpenDeriv=function(a){return this.dereference(),null!=this.pattern?this.pattern.startTagOpenDeriv(a):H.notAllowed("cannot find reference '"+this.refname+"'",this,a)},b.prototype._endTagDeriv=function(a){return this.dereference(),null!=this.pattern?this.pattern.endTagDeriv(a):H.notAllowed("cannot find reference '"+this.refname+"'",this,a)},b.prototype.attDeriv=function(a){return this.dereference(),null!=this.pattern?this.pattern.attDeriv(a):H.notAllowed("cannot find reference '"+this.refname+"'",this,node)},b.prototype._toString=function(){return this.refname},b.prototype.dereference=function(){return null!=this.pattern?this.pattern:(this.defines&&null!=this.defines[this.refname]&&(this.pattern=this.defines[this.refname],this.pattern.dereferenced_from=this.refname,this.uniqueIndex=this.pattern.uniqueIndex),this.pattern)},b}(A),l=function(a){function b(a,c){this.name=a,this.pattern=I(c),this.pattern.defined_from=this.name,this.uniqueIndex=this.pattern.uniqueIndex,b.__super__.constructor.call(this)}return d(b,a),b.prototype._startTagOpenDeriv=function(a){return this.pattern.startTagOpenDeriv(a)},b.prototype._endTagDeriv=function(a){return this.pattern.endTagDeriv(a)},b.prototype.attDeriv=function(a){return this.pattern.attDeriv(a)},b.prototype._toString=function(){return""+this.name+" = "+this.pattern},b}(A),H=new B,{getPattern:I,setDebug:N,setSkipAttributes:O,AnyName:g,Attribute:h,Choice:i,Data:k,Define:l,Empty:n,Element:m,Group:r,GoodElement:p,GoodParentElement:q,Interleave:s,List:t,MissingContent:u,Name:v,NameClass:w,NotAllowed:x,NsName:y,OneOrMore:z,Pattern:A,Ref:D,Text:E,Value:F,patternIntern:M,uniqueIndex:Q,indexCount:K}})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};c("textorum/relaxng/parse",["require","sax","../helper","./objects"],function(b){var c,d,e,f,g,h,i;return g=b("sax"),e=b("../helper"),f=b("./objects"),i="http://relaxng.org/ns/structure/1.0",h="http://relaxng.org/ns/compatibility/annotations/1.0",c=f.RNGException,d=function(){function b(){this.onend=a(this.onend,this),this.onclosenamespace=a(this.onclosenamespace,this),this.onopennamespace=a(this.onopennamespace,this),this.ontext=a(this.ontext,this),this.handleChildren=a(this.handleChildren,this),this.nodeIsParent=a(this.nodeIsParent,this),this.onclosetag=a(this.onclosetag,this),this.onopentag=a(this.onopentag,this),this.onerror=a(this.onerror,this);var b,c,d,e,f;for(this.nodeStack=[],this.grammarStack=[],this.rngStack=[],this.defines={},this.start=null,this.debug=!1,this.currentPrefixMapping={},this.errors=[],c={xmlns:!0,trim:!1,normalize:!1,position:!0},this.parser=g.parser(!0,c),f=g.EVENTS,d=0,e=f.length;e>d;d++)b=f[d],this["on"+b]&&(this.parser["on"+b]=this["on"+b])}return b.prototype.onerror=function(a){return this.errors.push(a),console.log("error",a.message),this.parser.resume()},b.prototype.onopentag=function(a){return this.nodeStack.push(a),a.uri===i?(this.grammarStack.push(a),this.nodeIsParent(a)?this.rngStack.push(a):void 0):void 0},b.prototype.onclosetag=function(){var a,b,c;if(c=this.nodeStack.pop(),c===this.rngStack[this.rngStack.length-1]){for(b=this.rngStack.pop(),a=[];this.grammarStack[this.grammarStack.length-1]!==b&&this.grammarStack;)a.unshift(this.grammarStack.pop());
return this.grammarStack.pop(),b.childNodes=a,this.handleChildren(b)}},b.prototype.nodeIsParent=function(a){switch(e.getLocalName(a)){case"grammar":case"start":case"define":case"element":case"data":case"value":case"list":return!0;case"attribute":case"ref":case"oneOrMore":case"choice":case"group":case"interleave":return!0;case"param":return!0;case"except":return!0;case"anyName":case"nsName":case"name":case"choice":return!0;default:return!1}},b.prototype.handleChildren=function(a){switch(e.getLocalName(a)){case"grammar":return 0;case"start":if(this.start)throw new c("Found a second start");return this.start=a.childNodes[0];case"define":return this.defines[e.getNodeAttr(a,"name")]=f.getPattern(a,this.defines);default:return this.grammarStack.push(f.getPattern(a,this.defines))}},b.prototype.ontext=function(a){var b;return b=a.replace(/^\s+|\s+$/g,""),b?this.grammarStack.push(a):void 0},b.prototype.onopennamespace=function(a){return this.currentPrefixMapping[a.prefix]=a.uri},b.prototype.onclosenamespace=function(a){return this.currentPrefixMapping[a.prefix]=void 0},b.prototype.onend=function(){return this.debug?(console.log("defines are",this.defines),console.log("start is",this.start)):void 0},b.prototype.getObjects=function(){return f},b.prototype.process=function(a,b){var c,d,e,g;if(f.setSkipAttributes(b),this.parser.write(a),this.parser.close(),this.errors.length>0){for(g=this.errors,d=0,e=g.length;e>d;d++)c=g[d],console.error("Error parsing RelaxNG schema",c.message);throw new Error("Error parsing RelaxNG schema")}},b}(),{RNGParser:d}})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};c("textorum/tinymce/validator",["require","../helper","../relaxng/parse","../relaxng/objects","jquery"],function(b){var c,d,e,f,g;return f=b("../helper"),d=b("../relaxng/parse").RNGParser,g=b("../relaxng/objects"),c=b("jquery"),e=function(){function b(b,c,e){var g,h;this.validationOutputSelector=b,this.editor=c,this.validElementsForNode=a(this.validElementsForNode,this),g=this.editor.plugins.textorum.schema,g.schemaXML?this.schema=g.schemaXML:(h=g.schemaURI,this.schema=f.getXHR(h).responseText),this.validatorNoAttributes=new d,this.validatorNoAttributes.process(this.schema,!0),this.validatorAttributes=new d,this.validatorAttributes.process(this.schema,!1),this.validationAttributesStart=this.validatorAttributes.start,this.validationNoAttributesStart=this.validatorNoAttributes.start,e&&(this.validatorAttributes.defines[e]&&(this.validationAttributesStart=validatorAttributes.defines[e]),this.validatorNoAttributes.defines[e]&&(this.validationNoAttributesStart=validatorNoAttributes.defines[e])),this.editor.addCommand("validateWithAttributes",this.validateWithAttributes,this),this.editor.addCommand("validateWithoutAttributes",this.validateWithoutAttributes,this),this.editor.addButton("txt_validate_attrs",{cmd:"validateWithAttributes",title:"Full Validation"}),this.editor.addButton("txt_validate_noattrs",{cmd:"validateWithoutAttributes",title:"Validation (Ignoring Attributes)"})}return b.prototype.validatePartialOpportunistic=function(a,b,c){var d,e;return null==b&&(b=!1),null==c&&(c=!1),e=b?this.validatorNoAttributes:this.validatorAttributes,d=this.validatePartialOpportunisticResult(a,b,c),d instanceof e.getObjects().NotAllowed?!1:!0},b.prototype.validatePartialOpportunisticResult=function(a,b,c){var d,e,f,g,h,i,j,k;null==b&&(b=!1),null==c&&(c=!1),j=b?this.validatorNoAttributes:this.validatorAttributes,f=j.getObjects().NotAllowed,j.getObjects().setSkipAttributes(b),h=[],k=j.defines;for(g in k)d=k[g],i=d.startTagOpenDeriv(a),i instanceof f||h.push(d);if(e=h.length,!e)return f;for(i=f;e--;)if(i=h[e].childDeriv(a,c),!(i instanceof f))return i;return i},b.prototype.validateFullEditor=function(a,b){var d,e,h,i;return null==a&&(a=!1),null==b&&(b=!1),d=(new window.DOMParser).parseFromString(this.editor.getContent(),"text/xml"),a?b?h=this.validatePartialOpportunisticResult(d.documentElement,!0):(this.validatorNoAttributes.getObjects().setSkipAttributes(!0),h=this.validationNoAttributesStart.childDeriv(d.documentElement,!0)):b?h=this.validatePartialOpportunisticResult(d.documentElement,!1):(this.validatorAttributes.getObjects().setSkipAttributes(!1),h=this.validationAttributesStart.childDeriv(d.documentElement,!0)),h instanceof g.Empty?c(this.validationOutputSelector).html("<b>No errors detected</b>"):(e=f.pathForNode(h.childNode),i=f.followTextorumPath(e,this.editor.dom.getRoot()),i!==this.editor.dom.getRoot()&&(this.editor.getWin().scrollTo(0,this.editor.dom.getPos(i).y-10),this.editor.selection.setCursorLocation(i,0),this.editor.nodeChanged(),c(i).effect("highlight",{},500),this.editor.focus()),c(this.validationOutputSelector).html("<ul><li><i>Error:</i> "+h+"</li></ul>")),h},b.prototype.validateWithoutAttributes=function(){return this.validateFullEditor(!0)},b.prototype.validateWithAttributes=function(){return this.validateFullEditor(!1)},b.prototype.validElementsForNode=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;switch(null==b&&(b="inside"),null==c&&(c="array"),n=this.editor.plugins.textorum.validator,g=this.editor.dom,j=a.parentNode,b){case"before":e=j;break;case"after":e=j;break;case"inside":e=a}d=null!=(o=this.editor.plugins.textorum.schema.defs)&&null!=(p=o[g.getAttrib(e,"data-xmlel")])?p.contains:void 0,m=[],l={};for(i in d){switch(f=d[i],h=g.create(this.editor.plugins.textorum.translateElement(i),{"data-xmlel":i,"class":i}),b){case"before":j.insertBefore(h,a),k=this.validatePartialOpportunistic(j,!0,1);break;case"after":g.insertAfter(h,a),k=this.validatePartialOpportunistic(j,!0,1);break;case"inside":a.appendChild(h),k=this.validatePartialOpportunistic(a,!0,1)}g.remove(h),k&&(m.push(i),l[i]=f)}return"array"===c?m:l},b}(),{TextorumValidator:e}})}.call(this),function(){var a={}.hasOwnProperty,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};c("textorum/tinymce/plugin",["require","text!../../plugin.css","./loader","../helper","./tree","./validator"],function(c){var d,e,f,g,h,i,j,k,l,m,n,o;return j=c("text!../../plugin.css"),k=c("./loader"),h=c("../helper"),e=c("./tree").TextorumTree,f=c("./validator").TextorumValidator,l=window.tinymce,window.textorum||(window.textorum={}),i={},(m=window.textorum).schema||(m.schema={containedBy:{},defs:{}}),d=window.jQuery,n=function(b,c){var e,f,g,i,j,k,m,n,o,p,q,r,s,t,u,v;if(null==c&&(c=""),!b)return"";n=new XSLTProcessor,k=h.getXML(c+"xsl/rng2js.xsl"),n.importStylesheet(k),r=h.getXHR(c+b,"text/xml"),q=r.responseXML,s=n.transformToDocument(q),m=s.documentElement,o=m.text||m.textContent||m.innerHTML,j=(d.parseJSON||l.util.JSON.parse)(o),j||(j={}),j.schemaURI=b,j.schemaXML=r.responseText,j.containedBy||(j.containedBy={}),j.defs||(j.defs={}),j.$root||(j.$root=[]),u=j.defs;for(g in u){f=u[g],i={},v=f.contains;for(e in v)a.call(v,e)&&(p=v[e],(t=j.containedBy)[e]||(t[e]={}),j.containedBy[e][g]=1)}return j},o=function(a){var b;return b=function(b){var c,d,e;for(c=b.length,e=[];c--;)d=b[c],"http://www.w3.org/XML/1998/namespace"===d.attributes.map["data-textorum-nsurl"]&&(d.attributes.map["data-textorum-nsprefix"]="xml"),a.plugins.textorum.nsmap[d.attributes.map["data-textorum-nsurl"]]=d.attributes.map["data-textorum-nsprefix"],e.push(d.remove());return e}},g={inlineelements:"bold italic monospace underline sub             sup named-content ext-link inline-graphic alt-text lbl long-desc        copyright-statement copyright-holder license license-p disp-quote        attrib inline-formula xref".split(/\s+/),fixedelements:"textorum table thead tbody td tr th".split(/\s+/)},l.create("tinymce.plugins.textorum",{elementMap:g,updateTree:function(){return this.tree.updateTreeCallback()},schema:{},nsmap:{},init:function(a,b){var c;return this.editor=a,c=this,c.url=b,l.adapter&&l.adapter.patchEditor(a),this.schema=n("schema/kipling-jp3.srng",h.trailingslashit(b)),this.tree=new e("#editortree",a),this.validator=new f("#editorvalidation",a),this.helper=h,this.filters={},k.bindHandler(a,b,this.elementMap.inlineelements.join(","),this.elementMap.fixedelements.join(",")),a.onSetContent.add(function(){return c.tree.updateTreeCallback()}),a.onKeyUp.add(function(a,b){var e,f;return c.removePlaceholderTag&&(c.removePlaceholderTag=!1,a.$('[data-mce-bogus="1"]').each(function(a,b){var c;return b=d(b),c=b.contents(),b.replaceWith(c)})),b.which>36&&b.which<41?void 0:!a.currentNode||(e=a.plugins.textorum.schema.defs,f=e[a.currentNode.getAttribute("data-xmlel")],f&&f.$)?void 0:(console.log("no text allowed in",a.currentNode.getAttribute("data-xmlel")),d(a.currentNode).contents().filter(function(){return 3===this.nodeType}).remove())}),a.onChange.add(function(a){return a.isDirty()?c.tree.updateTreeCallback():void 0}),a.onNodeChange.add(function(a,b,d,e,f){var g,h,i,j,k,l,m,n,o;for(c.removePlaceholderTag=!0,h=a.dom.getRoot();!d.hasAttribute("data-xmlel")&&d!==h&&d.parentElement;)d=d.parentElement;for(a.currentNode=d,c.tree.navigateTreeCallback(d,e,f),i=a.plugins.textorum.schema.defs,j=i[a.currentNode.getAttribute("data-xmlel")],m=["bold","italic","underline","sub","sup"],o=[],k=0,l=m.length;l>k;k++)g=m[k],o.push(b.setDisabled(g,!(null!=(null!=j&&null!=(n=j.contains)?n[g]:void 0))));return o}),a.onPreInit.add(function(a){return a.parser.addAttributeFilter("data-textorum-nsurl",o(a)),a.serializer.addAttributeFilter("id",c.tree.attributeFilterCallback)}),a.onInit.add(function(){}),a.on("ResolveName",function(a){var b;return b=a.target,("function"==typeof b.getAttribute?b.getAttribute("data-xmlel"):void 0)?a.name=b.getAttribute("data-xmlel"):void 0})},getInfo:function(){return{longname:"Textorum",author:"NCBI / Crowd Favorite",authorurl:"https://github.com/Annotum/",infourl:"https://github.com/Annotum/textorum/",version:"0.1"}},translateElement:function(a){return b.call(this.elementMap.fixedelements,a)>=0?a:b.call(this.elementMap.inlineelements,a)>=0?"span":"div"},addFilter:function(){var a;return a=0,function(b,c,d){return null==d&&(d=null),null==this.filters[b]&&(this.filters[b]={}),null==d&&(d=++a),this.filters[b][d]=c,d}}(),removeFilter:function(b,c){var d;return null==this.filters[b]?!1:null==this.filters[b][c]?!1:(delete this.filters[b][c],function(){var c,e;c=this.filter[b],e=[];for(d in c)a.call(c,d)&&e.push(d);return e}.call(this).length?void 0:delete this.filters[b])},applyFilters:function(b,c){var d,e;if(null==this.filters[b])return c;e=this.filters[b];for(d in e)a.call(e,d)&&(c=this.filters[b][d](c));return c}}),l.PluginManager.add("textorum",l.plugins.textorum)})}.call(this),function(){{var a=tinymce.DOM;tinymce.dom.Event,tinymce.each}tinymce.create("tinymce.plugins.jQueryInlinePopups",{init:function(a){a.onBeforeRenderUI.add(function(){a.windowManager=new tinymce.InlineWindowManager(a)})},getInfo:function(){return{longname:"jQuery UI Inline Popups",author:"Richard Willis",authorurl:"http://badsyntax.co",infourl:"http://is.gd/j1FuI",version:"0.1b"}}}),tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(a){this.parent(a),this.windows={}},open:function(b,c){if(b=b||{},c=c||{},!b.inline)return this.parent(b,c);var d,e=this,f=a.uniqueId(),g={title:b.title||"",buttons:b.buttons||void 0,width:"auto",height:"auto",modal:!0,resizable:b.resizable||!1,draggable:!0,dialogClass:"ui-dialog-tinymce",zIndex:3e5},h=$("<div />").attr("id","dialog-"+f).hide().appendTo("body"),i={id:f,features:b,element:h};return b.type||(this.bookmark=this.editor.selection.getBookmark(1)),b.content?("confirm"===b.type?g.buttons=[{text:"Ok",click:function(){b.button_func(!0)}},{text:"Cancel",click:function(){b.button_func(!1)}}]:"alert"===b.type&&(g.buttons=[{text:"Ok",click:function(){b.button_func(!0)}}]),h.html($("<div />",{"class":"ui-dialog-tinymce-content",html:b.content}))):d=$("<iframe />",{id:f+"_ifr",frameborder:0}).css({width:b.width,height:b.height+5}).attr("scrollbars","no").appendTo(h),c.mce_inline=!0,c.mce_window_id=f,c.mce_auto_focus=b.auto_focus,this.features=b,this.params=c,this.onOpen.dispatch(this,b,c),h.dialog(g).dialog("option","width",h.innerWidth()).dialog("option","position",h.dialog("option","position")),b.content||d.attr("src",b.url||b.file),e.windows[f]=i,i},resizeBy:function(){},focus:function(){},close:function(a,b){var c,d=this;return b=b||a.frameElement.id.replace(/_ifr$/,""),d.windows[b]?void((c=d.windows[b])&&(a&&a.frameElement&&(a.frameElement.src='javascript:""'),c.element.dialog("destroy").remove(),delete d.windows[b])):void d.parent(a)},setTitle:function(a,b){var c=a.frameElement.id.replace(/_ifr$/,"");$("#dialog-"+c).siblings(".ui-dialog-titlebar").find(".ui-dialog-title").html(b)},alert:function(a,b,c){this._messagePopup("alert","Alert",a,b,c)},confirm:function(a,b,c){this._messagePopup("confirm","Confirm",a,b,c)},_messagePopup:function(b,c,d,e){var f,g=this;f=g.open({title:c,type:b,button_func:function(a){e&&e.call(a||g,a),g.close(null,f.id)},content:a.encode(g.editor.getLang(d,d)),inline:1,width:400,height:130})}}),tinymce.PluginManager.add("jqueryinlinepopups",tinymce.plugins.jQueryInlinePopups)}(),c("jqueryui-popups",function(){}),function(a){function b(){function b(a){"remove"===a&&this.each(function(a,b){var c=e(b);c&&c.remove()}),this.find("span.mceEditor,div.mceEditor").each(function(a,b){var c=tinyMCE.get(b.id.replace(/_parent$/,""));c&&c.remove()})}function d(a){var d,e=this;if(a!==c)b.call(e),e.each(function(b,c){var d;(d=tinyMCE.get(c.id))&&d.setContent(a)});else if(e.length>0&&(d=tinyMCE.get(e[0].id)))return d.getContent()}function e(a){var b=null;return a&&a.id&&f.tinymce&&(b=tinyMCE.get(a.id)),b}function g(a){return!!(a&&a.length&&f.tinymce&&a.is(":tinymce"))}var h={};a.each(["text","html","val"],function(b,f){var i=h[f]=a.fn[f],j="text"===f;a.fn[f]=function(b){var f=this;if(!g(f))return i.apply(f,arguments);if(b!==c)return d.call(f.filter(":tinymce"),b),i.apply(f.not(":tinymce"),arguments),f;var h="",k=arguments;return(j?f:f.eq(0)).each(function(b,c){var d=e(c);h+=d?j?d.getContent().replace(/<(?:"[^"]*"|'[^']*'|[^'">])*>/g,""):d.getContent({save:!0}):i.apply(a(c),k)}),h}}),a.each(["append","prepend"],function(b,d){var f=h[d]=a.fn[d],i="prepend"===d;a.fn[d]=function(a){var b=this;return g(b)?a!==c?(b.filter(":tinymce").each(function(b,c){var d=e(c);d&&d.setContent(i?a+d.getContent():d.getContent()+a)}),f.apply(b.not(":tinymce"),arguments),b):void 0:f.apply(b,arguments)}}),a.each(["remove","replaceWith","replaceAll","empty"],function(c,d){var e=h[d]=a.fn[d];a.fn[d]=function(){return b.call(this,d),e.apply(this,arguments)}}),h.attr=a.fn.attr,a.fn.attr=function(b,f){var i=this,j=arguments;if(!b||"value"!==b||!g(i))return f!==c?h.attr.apply(i,j):h.attr.apply(i,j);if(f!==c)return d.call(i.filter(":tinymce"),f),h.attr.apply(i.not(":tinymce"),j),i;var k=i[0],l=e(k);return l?l.getContent({save:!0}):h.attr.apply(a(k),j)}}var c,d,e=[],f=window;a.fn.tinymce=function(c){function g(){var d=[],e=0;b&&(b(),b=null),l.each(function(a,b){var f,g=b.id,h=c.oninit;g||(b.id=g=tinymce.DOM.uniqueId()),f=new tinymce.Editor(g,c),d.push(f),f.onInit.add(function(){var a,b=h;l.css("visibility",""),h&&++e==d.length&&(tinymce.is(b,"string")&&(a=-1===b.indexOf(".")?null:tinymce.resolve(b.replace(/\.\w+$/,"")),b=tinymce.resolve(b)),b.apply(a||tinymce,d))})}),a.each(d,function(a,b){b.render()})}var h,i,j,k,l=this,m="",n="";return l.length?c?(l.css("visibility","hidden"),f.tinymce||d||!(h=c.script_url)?1===d?e.push(g):g():(d=1,i=h.substring(0,h.lastIndexOf("/")),/_(src|dev)\.js/g.test(h)&&(n="_src"),j=h.lastIndexOf("?"),-1!=j&&(m=h.substring(j+1)),f.tinyMCEPreInit=f.tinyMCEPreInit||{base:i,suffix:n,query:m},-1!=h.indexOf("gzip")&&(k=c.language||"en",h=h+(/\?/.test(h)?"&":"?")+"js=true&core=true&suffix="+escape(n)+"&themes="+escape(c.theme)+"&plugins="+escape(c.plugins)+"&languages="+k,f.tinyMCE_GZ||(tinyMCE_GZ={start:function(){function b(a){tinymce.ScriptLoader.markDone(tinyMCE.baseURI.toAbsolute(a))}tinymce.suffix=n,b("langs/"+k+".js"),b("themes/"+c.theme+"/editor_template"+n+".js"),b("themes/"+c.theme+"/langs/"+k+".js"),a.each(c.plugins.split(","),function(a,c){c&&(b("plugins/"+c+"/editor_plugin"+n+".js"),b("plugins/"+c+"/langs/"+k+".js"))})},end:function(){}})),a.ajax({type:"GET",url:h,dataType:"script",cache:!0,success:function(){tinymce.dom.Event.domLoaded=1,d=2,c.script_loaded&&c.script_loaded(),g(),a.each(e,function(a,b){b()})}})),l):tinyMCE.get(l[0].id):l},a.extend(a.expr[":"],{tinymce:function(a){return!!(a.id&&"tinyMCE"in window&&tinyMCE.get(a.id))}})}(jQuery),c("tinymce-jquery",function(){}),function(a,b){var c,d=(b.is,/^(href|src|style)$/i);if(!a&&window.console)return console.log("Load jQuery first!");b.$=a,b.adapter={patchEditor:function(b){function e(a,b){var c=this;return b&&c.removeAttr("data-mce-style"),h.css.apply(c,arguments)}function f(a,e){var f=this;return d.test(a)?e!==c?(f.each(function(c,d){b.dom.setAttrib(d,a,e)}),f):f.attr("data-mce-"+a):h.attr.apply(f,arguments)}function g(a){return a.css!==e&&(a.css=e,a.attr=f,a.tinymce=b,a.pushStack=function(){return g(h.pushStack.apply(this,arguments))}),a}var h=a.fn;b.$=function(c,d){var e=b.getDoc();return g(a(c||e,e||d))}}},b.extend=a.extend,b.extend(b,{map:a.map,grep:function(b,c){return a.grep(b,c||function(){return 1})},inArray:function(b,c){return a.inArray(c,b||[])}});var e={"tinymce.dom.DOMUtils":{select:function(b,c){var d=this;return a.find(b,d.get(c)||d.get(d.settings.root_element)||d.doc,[])},is:function(b,c){return a(this.get(b)).is(c)}}};b.onCreate=function(a,c,d){b.extend(d,e[c])}}(window.jQuery,tinymce),c("tinymce-jquery-adapter",function(){}),b(["textorum/tinymce/plugin"]),b("textorum/tinymce/plugin")}();